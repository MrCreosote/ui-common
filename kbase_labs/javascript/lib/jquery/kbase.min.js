(function(e,t){function r(e,t){function n(){}n.prototype=t.prototype;var r=new n;r.constructor=e;e.prototype=r}var n={};e.kbWidget=function(i,s,o){if(n[i]!=t){return}var u=function(t){this.$elem=t;this.options=e.extend(true,{},o.options);return this};n[i]=u;if(o==t){o=s;s=t}if(s){r(u,n[s])}var a=e.extend(true,{},o);for(var f in a){if(e.isFunction(a[f])){u.prototype[f]=function(e,t){var r=function(){throw"No parent method defined! Play by the rules!"};var i=function(){throw"No parent method defined! Play by the rules!"};if(s){var r=function(){return n[s].prototype[e].apply(this,arguments)};var i=function(e){return n[s].prototype[e].apply(this,Array.prototype.slice.apply(arguments,[1]))}}return function(){var e=this._super;var n=this._superMethod;this._super=r;this._superMethod=i;var s=t.apply(this,arguments);this._super=e;this._superMethod=n;return s}}(f,a[f])}else{u.prototype[f]=a[f]}}if(s){u.prototype.options=e.extend(true,{},n[s].prototype.options,u.prototype.options)}e.fn[i]=function(n,r){if(this.data(i)==t){this.data(i,new u(this))}if(u.prototype[n]){return u.prototype[n].apply(this.data(i),Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){var r=arguments;$w=this.data(i);if(!$w._init){$w=u.prototype.init.apply($w,arguments)}$w._init=true;return $w}else{e.error("Method "+n+" does not exist on "+i)}return this};u.prototype[i]=function(){return e.fn[i].apply(this.$elem,arguments)};return e.fn[i]};e.kbWidget("kbaseWidget",{options:{},element:function(){return this},dbg:function(e){if(window.console)console.log(e)},init:function(t){var n=e.extend(true,{},this.options);this.options=e.extend(false,{},n,t);return this},alert:function(e){if(e==t){e=this.data("msg")}this.data("msg",e);return this},popper:function(){alert("pop, pop")},data:function(e,n){if(this.options._storage==t){this.options._storage={}}if(arguments.length==2){this.options._storage[e]=n}if(e!=t){return this.options._storage[e]}else{return this.options._storage}},_rewireIds:function(n,r){if(r==t){r=n}if(n.attr("id")){r.data(n.attr("id"),n);n.removeAttr("id")}e.each(n.find("[id]"),function(t){r.data(e(this).attr("id"),e(this));e(this).removeAttr("id")});return n},sortCaseInsensitively:function(e,t){if(e.toLowerCase()<t.toLowerCase()){return-1}else if(e.toLowerCase()>t.toLowerCase()){return 1}else{return 0}},trigger:function(){this.$elem.trigger.apply(this.$elem,arguments)},on:function(){this.$elem.on.apply(this.$elem,arguments)}})})(jQuery);(function(e,t){e.kbWidget("kbaseAuthenticatedWidget","kbaseWidget",{version:"1.0.0",options:{},init:function(e){this._super(e);if(e.$loginbox){this.$loginbox=e.$loginbox}else{throw"Cannot create authenticated widget w/o login box!"}return this},sessionId:function(){return this.$loginbox.sessionId()}})})(jQuery);(function(e,t){e.kbWidget("kbaseAccordion","kbaseWidget",{version:"1.0.0",options:{fontSize:"100%"},init:function(t){this._super(t);if(this.options.client){this.client=this.options.client}this.appendUI(e(this.$elem));return this},appendUI:function(n,r){if(r==t){r=this.options.elements}var i=this.options.fontSize;var s=e("<div></div>").addClass("accordion").css("font-size",i).attr("id","accordion");e.each(r,e.proxy(function(n,r){s.append(e("<div></div>").addClass("accordion-group").append(e("<div></div>").addClass("accordion-heading").append(e("<i></i>").css("margin-right","3px").css("margin-left","1px").addClass("icon-chevron-right").addClass("pull-left").css("height","22px").css("line-height","22px").css("color","gray")).append(e("<a></a>").addClass("accordion-toggle").css("padding","0px").attr("href","#").attr("title",r.title).css("height","22px").css("line-height","22px").append(r.title).bind("click",function(n){n.preventDefault();var r=e(this).closest(".accordion").find(".in");var i=e(this).parent().next();if(r!=t){r.collapse("hide");var s=r.parent().first().find("i");s.removeClass("icon-chevron-down");s.addClass("icon-chevron-right")}if(i.get(0)!=r.get(0)){i.collapse("show");var s=e(this).parent().find("i");s.removeClass("icon-chevron-right");s.addClass("icon-chevron-down")}}))).append(e("<div></div>").addClass("accordion-body").append(e("<div></div>").addClass("accordion-inner").append(r.body))))},this));this._rewireIds(s,this);n.append(s);s.find(".accordion-body").collapse("hide")}})})(jQuery);(function(e,t){e.kbWidget("kbaseBox","kbaseWidget",{version:"1.0.0",options:{canCollapse:true,controls:[],bannerColor:"lightgray",boxColor:"lightgray"},init:function(t){this._super(t);this._controls={};this.appendUI(e(this.$elem));return this},setBannerColor:function(e){this.data("banner").css("background-color",e)},startThinking:function(){this.data("banner").addClass("progress progress-striped active")},stopThinking:function(){this.data("banner").removeClass("progress progress-striped active")},appendUI:function(t){var n=this.options.canCollapse;var r=e("<div></div>").append(e("<div></div>").css("text-align","left").css("font-size","70%").css("color","gray").append(this.options.precontent)).append(e("<div></div>").css("border","1px solid "+this.options.boxColor).css("padding","2px").append(e("<div></div>").attr("id","banner").css("width","100%").css("height","24px").css("margin-bottom","0px").css("box-shadow","none").css("background-color",this.options.bannerColor).css("border-radius","0px").append(e("<h5></h5>").addClass("text-left").css("text-align","left").css("text-shadow","none").css("color","black").css("font-size","14px").addClass("bar").css("padding","2px").css("margin","0px").css("position","relative").css("width","100%").bind("click",function(t){t.preventDefault();t.stopPropagation();if(n){e(this).parent().parent().children().last().collapse("toggle")}}).append(e("<span></span>").attr("id","title")).append(e("<div></div>").addClass("btn-group").attr("id","control-buttons").css("right","0px").css("top","0px").css("position","absolute").append("foo, bar, baz")))).append(e("<div></div>").attr("id","content"))).append(e("<div></div>").css("text-align","right").css("font-size","70%").css("color","gray").append(this.options.postcontent));this._rewireIds(r,this);this.setControls(this.options.controls);this.setTitle(this.options.title);this.setContent(this.options.content);t.append(r);return this},setTitle:function(e){this.data("title").empty();this.data("title").append(e)},setContent:function(e){this.data("content").empty();this.data("content").append(e)},controls:function(e){if(e){return this._controls[e]}else{return this._controls}},setControls:function(n){this.data("control-buttons").empty();for(control in this._controls){this._controls[control]=t}var r=this;e.each(n,e.proxy(function(t,n){var i="btn btn-mini";if(n.type){i=i+" btn-"+n.type}var s=e("<button></button>").attr("href","#").css("padding-top","1px").css("padding-bottom","1px").attr("class",i).append(e("<i></i>").addClass(n.icon)).bind("click",function(e){e.preventDefault();e.stopPropagation();n.callback.call(this,e,r)});if(n.id){this._controls[n.id]=s}this.data("control-buttons").append(s)},this))}})})(jQuery);(function(e,t){e.kbWidget("kbasePrompt","kbaseWidget",{version:"1.0.0",options:{controls:["cancelButton","okayButton"]},init:function(e){this._super(e);return this},openPrompt:function(){this.dialogModal().modal({keyboard:true})},closePrompt:function(){this.dialogModal().modal("hide")},cancelButton:function(){return{name:"Cancel",callback:function(e,t){t.closePrompt()}}},okayButton:function(){return{name:"Okay",type:"primary",callback:function(e,t){t.closePrompt()}}},dialogModal:function(){if(this.data("dialogModal")!=t){return this.data("dialogModal")}var n=e("<div></div>").attr("class","modal hide fade").attr("tabindex","-1").append(e("<div></div>").attr("class","modal-header").append(e("<button></button>").attr("type","button").attr("class","close").attr("data-dismiss","modal").attr("aria-hidden","true").append("x\n")).append(e("<h3></h3>").attr("id","title"))).append(e("<div></div>").attr("class","modal-body").attr("id","body")).append(e("<div></div>").attr("class","modal-footer").append(e("<div></div>").addClass("row-fluid").addClass("form-horizontal").append(e("<div></div>").addClass("span6").addClass("text-left").attr("id","footer")).append(e("<div></div>").addClass("span6").attr("id","controls").css("white-space","nowrap"))));n.unbind("keypress");n.keypress(function(t){if(t.keyCode==13){t.stopPropagation();t.preventDefault();e("a:last",n).trigger("click")}});this._rewireIds(n,n);if(this.options.title){n.data("title").append(this.options.title)}if(this.options.body){n.data("body").append(this.options.body)}if(this.options.footer){n.data("footer").append(this.options.footer)}var r=this;e.each(this.options.controls,function(t,i){if(typeof i=="string"){i=r[i]()}var s="btn";if(i.type){s=s+" btn-"+i.type}var o=e("<a></a>").attr("href","#").attr("class",s).append(i.name).bind("click",function(e){e.preventDefault();e.stopPropagation();i.callback.call(this,e,r)});if(i.id){o.attr("id",i.id)}n.data("controls").append(o)});this._rewireIds(n,n);this.data("dialogModal",n);var i=t;var s=false;n.on("shown",e.proxy(function(){e.each(n.find("input[type=text],input[type=password],textarea"),function(n,r){if(i==t){i=e(r)}if(e(r).is("input")&&e(r).val()==t){e(r).focus();s=true;return}else if(e(r).is("textarea")&&e(r).text().length==0){e(r).focus();s=true;return}});if(!s&&i!=t){i.focus()}},this));return n}})})(jQuery);(function(e,t){e.kbWidget("kbaseDeletePrompt","kbasePrompt",{version:"1.0.0",options:{controls:["cancelButton","okayButton"]},init:function(t){this._super(t);return e("<div></div>").kbasePrompt({title:"Confirm deletion",body:"Really delete <strong>"+this.options.name+"</strong>?",controls:["cancelButton",{name:"Delete",type:"primary",callback:this.options.callback}]})}})})(jQuery);(function(e,t){e.kbWidget("kbaseErrorPrompt","kbasePrompt",{version:"1.0.0",options:{controls:["cancelButton","okayButton"]},init:function(t){this._super(t);return e("<div></div>").kbasePrompt({title:t.title,body:e("<div></div>").attr("class","alert alert-error").append(e("<div></div>").append(e("<div></div>").addClass("pull-left").append(e("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(e("<div></div>").append(e("<strong></strong>").append(t.message)))),controls:["okayButton"]})}})})(jQuery);(function(e,t){e.kbWidget("kbaseFormBuilder","kbaseWidget",{version:"1.0.0",options:{elements:[],defaultSize:50,defaultRowSize:5,defaultMultiSelectSize:5,dispatch:{text:"buildTextField",textarea:"buildTextArea",password:"buildSecureTextField",checkbox:"buildCheckbox",select:"buildSelectbox",multiselect:"buildSelectbox",radio:"buildRadioButton",string:"buildTextField",secure:"buildSecureTextField","enum":"buildSelectbox","boolean":"buildCheckbox"}},init:function(e){this._super(e);this.$elem.append(this._buildForm(this.options.elements));return this},getFormValues:function(){var e=[];var n=this.data("formValues");var r=this.data("form").get(0);for(key in n){var i=n[key];var s=i.name;var o=i.type;var u=[];if(r[s]=="[object NodeList]"){for(var a=0;a<r[s].length;a++){u.push(r[s][a])}}else{u=[r[s]]}if(o=="checkbox"){if(r[s].checked){e.push([key])}}else if(o=="multiselect"){var f=[key];var l=f;if(i.asArray){l=[];f.push(l)}var c=0;for(var a=0;a<r[s].length;a++){if(r[s][a].selected){c=1;l.push(r[s][a].value)}}if(c){e.push(f)}}else if(o=="radio"){var f=[key];var c=0;for(var a=0;a<r[s].length;a++){if(r[s][a].checked){c=1;f.push(r[s][a].value)}}if(c){e.push(f)}}else{var h=[];for(var a=0;a<u.length;a++){if(i.json){var p=JSON.parse(u[a].value);if(i.asArray){p=[p]}h.push(p)}else{h.push(this.carve(u[a].value,i.split,i.asArray))}}if(h.length>0){if(h.length==1){h=h[0];if(h.length==0){continue}}e.push([key,h])}}}if(this.options.returnArrayStructure!=t){var d=[];var v={};for(var a=0;a<e.length;a++){v[e[a][0]]=e[a][1]}for(var a=0;a<this.options.returnArrayStructure.length;a++){d.push(v[this.options.returnArrayStructure[a]])}e=d}return e},carve:function(n,r,i){r=r==t?[]:typeof r=="string"?[r]:r.slice(0);var s=r.shift();if(s==t){if(i&&typeof n=="string"){n=[n]}return n}var o=new RegExp(" *"+s+" *");if(typeof n=="string"){return this.carve(n.split(o),r,i)}else{r.push(s);jQuery.each(n,e.proxy(function(e,t){n[e]=this.carve(t,r,i)},this))}return n},escapeValue:function(e){e=e.replace(/"/g,'\\"');return'"'+e+'"'},getFormValuesAsString:function(){var e=this.getFormValues();if(this.options.returnArrayStructure!=t){return JSON.stringify(e)}var n=[];for(var r=0;r<e.length;r++){var i=e[r];if(i.length==1){n.push(i[0])}else{for(var s=1;s<i.length;s++){if(this.data("formValues")[i[0]].valOnly){n.push(i[s])}else{if(typeof i[s]=="string"){n.push(i[0]+" "+this.escapeValue(i[s]))}else{n.push(i[0]+" "+this.escapeValue(JSON.stringify(i[s])))}}}}}return n.join(" ")},_buildForm:function(n){var r=e("<form></form>").addClass("form-horizontal").bind("submit",function(e){return false});this.data("form",r);var i=this.data("formValues",{});var s=t;var o={};if(this.options.values!=t){e.each(this.options.values,function(e,t){o[t[0]]=t[1]||1})}e.each(n,e.proxy(function(n,u){if(i[u.key]!=t){var a="FORM ERROR. KEY "+u.key+" IS DOUBLE DEFINED";r=a;return false}i[u.key]=u;if(u.fieldset){if(s==t||s.attr("name")!=u.fieldset){s=e("<fieldset></fieldset>").attr("name",u.fieldset).append(e("<legend></legend>").append(u.fieldset));r.append(s)}}else{s=r}var f=u.label!=t?u.label:u.name;var l=e("<label></label>").addClass("control-label").css("margin-right","10px").append(e("<span></span>").attr("title",u.label||u.name).append(f).attr("title",u.description)).bind("click",function(t){e(this).next().children().first().focus()});var c=l.find("span");if(u.description){c.tooltip()}if(o[u.key]!=t){u.value=u.checked=u.selected=o[u.key]}var h;if(this.options.dispatch[u.type]){h=this[this.options.dispatch[u.type]](u)}else if(u.type==t){var a="FORM ERROR. KEY "+u.key+" HAS NO TYPE";r=a;return false}else{h=this.buildTextField(u)}var p=e("<span></span>");p.css("display","inline-block");p.append(h);var d=e("<button></button>").addClass("btn").attr("title","Add more").append(e("<i></i>").addClass("icon-plus")).bind("click",function(t){p.append(e("<br/>"));p.append(h.clone());t.stopPropagation()});if(u.multi){p.append(d)}r.append(e("<div></div>").addClass("control-group").append(l).append(p))},this));return r},buildTextField:function(t){return e("<input/>").attr("type","text").attr("size",t.size||this.options.defaultSize).attr("value",t.value).attr("name",t.name)},buildTextArea:function(t){return e("<textarea></textarea>").attr("cols",t.size||this.options.defaultSize).attr("rows",t.rows||this.options.defaultRowSize).attr("name",t.name).append(t.value)},buildSecureTextField:function(t){return e("<input/>").attr("type","password").attr("size",t.size||this.options.defaultSize).attr("value",t.value).attr("name",t.name)},buildCheckbox:function(t){var n=e("<input/>").attr("type","checkbox").attr("name",t.name).attr("value",t.value);if(t.checked){n.attr("checked","checked")}return n},buildRadioButton:function(t){var n=e("<span></span>").css("display","inline-block");e.each(t.values,e.proxy(function(r,i){var s=e("<input/>").attr("type","radio").attr("name",t.name).attr("value",i);if(t.checked==i){s.attr("checked","checked")}var o=e("<label></label").append(s).append(t.names[r]||t.values[r]).css("clear","both").css("float","left");n.append(o)},this));return n},buildSelectbox:function(n){var r=e("<select></select>").attr("name",n.name);if(n.type=="multiselect"){r.attr("multiple","multiple").attr("size",n.size||this.options.defaultMultiSelectSize)}if(n.names==t){n.names=[]}e.each(n.values,function(t,i){var s=n.names[t]||n.values[t];var o=e("<option></option>").attr("value",i).append(s);if(typeof n.selected=="string"&&n.selected==i){o.attr("selected","selected")}else if(typeof n.selected=="object"){e.each(n.selected,function(e,t){if(t==i){o.attr("selected","selected")}})}r.append(o)});return r}})})(jQuery);(function(e,t){e.kbWidget("kbaseLogin","kbaseWidget",{version:"1.0.0",options:{style:"button",loginURL:"http://kbase.us/services/authorization/Sessions/Login",possibleFields:["verified","name","opt_in","kbase_sessionid","token","groups","user_id","email","system_admin"],fields:["name","kbase_sessionid","user_id","token"]},get_kbase_cookie:function(n){var r={};var i=e.cookie("kbase_session");if(i==t){return r}var s=i.split("|");for(var o=0;o<s.length;o++){var u=s[o].split("=");u[1]=u[1].replace(/PIPESIGN/g,"|");u[1]=u[1].replace(/EQUALSSIGN/g,"=");r[u[0]]=u[1]}r.success=1;return n==t?r:r[n]},sessionId:function(){return this.get_kbase_cookie("kbase_session_id")},token:function(){return this.get_kbase_cookie("token")},init:function(e){this._super(e);var t=this.get_kbase_cookie();this.$elem.empty();var n="_"+this.options.style+"Style";this.ui=this[n]();if(this.ui){this.$elem.append(this.ui)}if(t.user_id){if(this.registerLogin){this.registerLogin(t)}if(this.options.prior_login_callback){this.options.prior_login_callback.call(this,t)}this.data("_session",t)}return this},registerLoginFunc:function(){return this.registerLogin},specificLogoutFunc:function(){return this.specificLogout},populateLoginInfo:function(e){if(e.success){this.data("_session",e);this._error=t}else{this.data("_session",{});this._error=e.message}},session:function(e,n){if(this.data("_session")==t){this.data("_session",{})}var r=this.data("_session");if(arguments.length==2){r[e]=n}if(arguments.length>0){return r[e]}else{return r}},error:function(e){if(e){this._error=e}return this._error},openDialog:function(){if(this.data("loginDialog")){var n=this.data("loginDialog");e("form",n.dialogModal()).get(0).reset();n.dialogModal().data("user_id").val(this.session("user_id")||this.data("passed_user_id")||this.options.user_id);delete this.options.user_id;this.session("user_id",t);n.dialogModal().trigger("clearMessages");this.data("loginDialog").openPrompt()}},_textStyle:function(){this._createLoginDialog();var t=e("<span></span>").append(e("<a></a>").attr("id","loginlink").attr("href","#").text("Sign In").bind("click",e.proxy(function(e){this.openDialog()},this))).append(e("<div></div>").attr("id","userdisplay").css("display","none").append(e("<div></div>").addClass("pull-left").css("margin-top","2px").append("Signed in as ").append(e("<span></span>").attr("id","loggedinuser_id").css("font-weight","bold")).append(" ")).append(e("<button></button>").attr("id","logoutlink").attr("href","#").addClass("btn btn-mini").css("margin-bottom","5px").css("padding-left","3px").css("padding-right","3px").attr("title","Logout").tooltip({placement:"bottom"}).bind("click",e.proxy(function(e){this.logout()},this)).append(e("<i></i>").addClass("icon-signout"))));this._rewireIds(t,this);this.registerLogin=function(e){if(e.success){this.data("loginlink").hide();this.data("loggedinuser_id").text(e.name);this.data("userdisplay").show();this.data("loginDialog").closePrompt()}else{this.data("loginDialog").dialogModal().trigger("error",e.message)}};this.specificLogout=function(e){this.data("userdisplay").hide();this.data("loginlink").show()};return t},_hiddenStyle:function(){this._createLoginDialog();this.registerLogin=function(e){if(e.success){this.data("loginDialog").closePrompt()}else{this.data("loginDialog").dialogModal().trigger("error",e.message)}};return t},_slimStyle:function(){this.data("loginDialog",t);var n=e("<span></span>").addClass("form-inline").append(e("<span></span>").attr("id","entrance").append(e("<span></span>").addClass("input-prepend input-append").append(e("<span></span>").addClass("add-on").append("username: ").bind("click",function(t){e(this).next().focus()})).append(e("<input/>").attr("type","text").attr("name","user_id").attr("id","user_id").attr("size","20").val(this.options.user_id)).append(e("<span></span>").addClass("add-on").append(" password: ").bind("click",function(t){e(this).next().focus()})).append(e("<input/>").attr("type","password").attr("name","password").attr("id","password").attr("size","20")).append(e("<button></button>").attr("id","loginbutton").addClass("btn btn-primary").append(e("<i></i>").attr("id","loginicon").addClass("icon-lock"))))).append(e("<span></span>").attr("id","userdisplay").attr("style","display : none;").addClass("input-prepend").append(e("<span></span>").addClass("add-on").append("Logged in as ").append(e("<span></span>").attr("id","loggedinuser_id").attr("style","font-weight : bold").append("user_id\n"))).append(e("<button></button>").addClass("btn").attr("id","logoutbutton").append(e("<i></i>").attr("id","logouticon").addClass("icon-signout"))));this._rewireIds(n,this);this.data("password").keypress(e.proxy(function(e){if(e.keyCode==13){this.data("loginbutton").trigger("click");e.stopPropagation()}},this));this.registerLogin=function(t){this.data("loginicon").removeClass().addClass("icon-lock");if(t.success){this.data("entrance").hide();this.data("user_id").val("");this.data("password").val("");this.data("loggedinuser_id").text(t.name);this.data("userdisplay").show()}else{var n=e("<div></div>").kbasePrompt({title:"Login failed",body:e("<div></div>").attr("class","alert alert-error").append(e("<div></div>").append(e("<div></div>").addClass("pull-left").append(e("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(e("<div></div>").append(e("<strong></strong>").append(t.message)))),controls:["okayButton"]});n.openPrompt()}};this.specificLogout=function(e){this.data("userdisplay").hide();this.data("entrance").show()};this.data("loginbutton").bind("click",e.proxy(function(e){this.data("loginicon").removeClass().addClass("icon-refresh");this.login(this.data("user_id").val(),this.data("password").val(),function(e){this.registerLogin(e);if(this.options.login_callback){this.options.login_callback.call(this,e)}})},this));this.data("logoutbutton").bind("click",e.proxy(function(e){this.logout();this.data("user_id").focus()},this));return n},_microStyle:function(){var t=e("<span></span>").append(e("<button></button>").addClass("btn btn-primary").attr("id","loginbutton").append(e("<i></i>").attr("id","loginicon").addClass("icon-lock")));this._rewireIds(t,this);this._createLoginDialog();this.data("loginbutton").bind("click",e.proxy(function(e){this.openDialog()},this));this.registerLogin=function(t){if(t.success){this.data("loginDialog").dialogModal().trigger("clearMessages");this.data("loginDialog").closePrompt();this.data("loginbutton").tooltip({title:"Logged in as "+t.name});this.data("loginicon").removeClass().addClass("icon-user");this.data("loginbutton").bind("click",e.proxy(function(e){this.logout()},this))}else{this.data("loginDialog").dialogModal().trigger("error",t.message)}};this.specificLogout=function(){this.data("loginbutton").tooltip("destroy");this.data("loginicon").removeClass().addClass("icon-lock")};return t},_buttonStyle:function(){var t=e("<div></div>").attr("style","width : 250px; border : 1px solid gray").append(e("<h4></h4>").attr("style","padding : 5px; margin-top : 0px; background-color : lightgray ").addClass("text-center").append("User\n")).append(e("<div></div>").attr("id","entrance").append(e("<p></p>").attr("style","text-align : center").append(e("<button></button>").attr("id","loginbutton").append("Login").addClass("btn btn-primary")))).append(e("<div></div>").attr("id","userdisplay").attr("style","display : none;").append(e("<p></p>").attr("style","text-align : center").append("Logged in as ").append(e("<span></span>").attr("id","loggedinuser_id").attr("style","font-weight : bold").append("user_id\n")).append(e("<button></button>").attr("id","logoutbutton").append("Logout\n").addClass("btn"))));this._rewireIds(t,this);this._createLoginDialog();this.data("loginbutton").bind("click",e.proxy(function(e){this.openDialog()},this));this.data("logoutbutton").bind("click",e.proxy(this.logout,this));this.registerLogin=function(e){if(e.success){this.data("loginDialog").dialogModal().trigger("clearMessages");this.data("entrance").hide();this.data("loggedinuser_id").text(e.name);this.data("userdisplay").show();this.data("loginDialog").closePrompt()}else{this.data("loginDialog").dialogModal().trigger("error",e.message)}};this.specificLogout=function(e){this.data("userdisplay").hide();this.data("entrance").show()};return t},_createLoginDialog:function(){var t=this.$elem;var n=e("<div></div").kbasePrompt({title:"Login to KBase",controls:["cancelButton",{name:"Login",type:"primary",id:"loginbutton",callback:e.proxy(function(e){var t=this.data("loginDialog").dialogModal().data("user_id").val();var n=this.data("loginDialog").dialogModal().data("password").val();this.data("loginDialog").dialogModal().trigger("message",t);this.login(t,n,function(e){if(this.registerLogin){this.registerLogin(e)}if(this.options.login_callback){this.options.login_callback.call(this,e)}})},this)}],body:e("<p></p>").append(e("<form></form>").attr("name","form").attr("id","form").addClass("form-horizontal").append(e("<fieldset></fieldset>").append(e("<div></div>").attr("class","alert alert-error").attr("id","error").attr("style","display : none").append(e("<div></div>").append(e("<div></div>").addClass("pull-left").append(e("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(e("<div></div>").append(e("<strong></strong>").append("Error:\n")).append(e("<span></span>").attr("id","errormsg"))))).append(e("<div></div>").attr("class","alert alert-success").attr("id","pending").attr("style","display : none").append(e("<div></div>").append(e("<div></div>").addClass("pull-left").append(e("<i></i>").addClass("icon-info-sign").attr("style","float: left; margin-right: .3em;"))).append(e("<div></div>").append(e("<strong></strong>").append("Logging in as:\n")).append(e("<span></span>").attr("id","pendinguser"))))).append(e("<div></div>").attr("class","control-group").append(e("<label></label>").addClass("control-label").attr("for","user_id").css("margin-right","10px").append("Username:\n")).append(e("<input/>").attr("type","text").attr("name","user_id").attr("id","user_id").attr("size","20"))).append(e("<div></div>").attr("class","control-group").append(e("<label></label>").addClass("control-label").attr("for","password").css("margin-right","10px").append("Password:\n")).append(e("<input/>").attr("type","password").attr("name","password").attr("id","password").attr("size","20"))))),footer:e("<span></span").append(e("<a></a>").attr("href","https://gologin.kbase.us/ResetPassword").attr("target","_blank").text("Forgot password?")).append(" | ").append(e("<a></a>").attr("href"," https://gologin.kbase.us/OAuth?response_type=code&step=SignUp&redirect_uri="+encodeURIComponent(location.href)).attr("target","_blank").text("Sign up"))});this._rewireIds(n.dialogModal(),n.dialogModal());this.data("loginDialog",n);n.dialogModal().bind("error",function(t,n){e(this).trigger("clearMessages");e(this).data("error").show();e(this).data("errormsg").html(n)});n.dialogModal().bind("message",function(t,n){e(this).trigger("clearMessages");e(this).data("pending").show();e(this).data("pendinguser").html(n)});n.dialogModal().bind("clearMessages",function(t){e(this).data("error").hide();e(this).data("pending").hide()});return n},login:function(n,r,i){var s={user_id:n,status:1};if(n.length==0){s.message="Cannot login w/o user_id";s.status=0;i.call(this,s)}else if(r==t||r.length==0){s.message="Cannot login w/o password";s.status=0;if(i!=t){i.call(this,s)}}else{s.password=r;s.cookie=1;s.fields=this.options.fields.join(",");e.support.cors=true;e.ajax({type:"POST",url:this.options.loginURL,data:s,dataType:"json",crossDomain:true,xhrFields:{withCredentials:true},success:e.proxy(function(t,n,r){if(t.kbase_sessionid){var s=[];var o={success:1};var u=this.options.fields;for(var a=0;a<u.length;a++){var f=t[u[a]];o[u[a]]=f;f=f.replace(/=/g,"EQUALSSIGN");f=f.replace(/\|/g,"PIPESIGN");s.push(u[a]+"="+f)}e.cookie("kbase_session",s.join("|"));this.populateLoginInfo(o);i.call(this,o)}else{e.removeCookie("kbase_session");this.populateLoginInfo({});i.call(this,{status:0,message:t.error_msg})}},this),error:e.proxy(function(e,t,n){if(t=="error"){t="Error connecting to KBase login server"}this.populateLoginInfo({});i.call(this,{status:0,message:t})},this),xhrFields:{withCredentials:true},beforeSend:function(e){e.withCredentials=true}})}},logout:function(){e.removeCookie("kbase_session");if(this.specificLogout){this.specificLogout()}this.populateLoginInfo({});if(this.data("loginDialog")!=t){this.openDialog()}if(this.options.logout_callback){this.options.logout_callback.call(this)}}})})(jQuery);(function(e,t){e.kbWidget("kbaseTable","kbaseWidget",{version:"1.0.0",options:{sortable:false,striped:true,hover:true,bordered:true},init:function(t){this._super(t);this.appendUI(e(this.$elem),this.options.structure);return this},appendUI:function(n,r){n.empty();var i=e("<table></table>").attr("id","table").addClass("table");if(this.options.tblOptions){this.addOptions(i,this.options.tblOptions)}if(this.options.striped){i.addClass("table-striped")}if(this.options.hover){i.addClass("table-hover")}if(this.options.bordered){i.addClass("table-bordered")}if(this.options.caption){i.append(e("<caption></caption>").append(this.options.caption))}if(r.header){var s=e("<thead></thead>").attr("id","thead");var o=e("<tr></tr>").attr("id","headerRow");e.each(r.header,e.proxy(function(n,r){var i=this.nameOfHeader(r);var s=new Date;var u=e("<th></th>").append(i);if(typeof r!="string"){this.addOptions(u,r);if(r.sortable){var a=i+"-sortButton";var f=e("<i></i>").addClass("icon-sort");var l=e("<button></button>").addClass("btn btn-mini").attr("id",a).css("display","none").css("float","right").append(f).data("shouldHide",true);l.bind("click",e.proxy(function(e){var n=this.data("lastSort");if(n!=t&&n.get(0)!=l.get(0)){n.children(":first").removeClass("icon-sort-up");n.children(":first").removeClass("icon-sort-down");n.children(":first").addClass("icon-sort");n.data("shouldHide",true);n.css("display","none")}if(f.hasClass("icon-sort")){f.removeClass("icon-sort");f.addClass("icon-sort-up");l.data("shouldHide",false);this.sortAndLayoutOn(i,1)}else if(f.hasClass("icon-sort-up")){f.removeClass("icon-sort-up");f.addClass("icon-sort-down");l.data("shouldHide",false);this.sortAndLayoutOn(i,-1)}else if(f.hasClass("icon-sort-down")){f.removeClass("icon-sort-down");f.addClass("icon-sort");l.data("shouldHide",true);this.sortAndLayoutOn(t)}this.data("lastSort",l)},this));u.append(l);u.bind("mouseover",e.proxy(function(e){l.css("display","inline")},this));u.bind("mouseout",e.proxy(function(e){if(l.data("shouldHide")){l.css("display","none")}},this))}}o.append(u)},this));s.append(o);i.append(s)}if(r.rows){var u=this.data("tbody",e("<tbody></tbody>"));this.layoutRows(r.rows,r.header);i.append(u)}if(r.footer){var a=e("<tfoot></tfoot>").attr("id","tfoot");for(var f=0;f<r.footer.length;f++){a.append(e("<td></td>").append(r.footer[f]))}i.append(a)}this._rewireIds(i,this);n.append(i);return n},sortAndLayoutOn:function(e,n){var r=this.options.structure.rows;if(e!=t){var i=this.nameOfHeader(e);r=this.options.structure.rows.slice().sort(function(e,t){var r=e[i];var s=t[i];r=typeof r=="string"?r.toLowerCase():r;s=typeof s=="string"?s.toLowerCase():s;if(r<s){return 0-n}else if(r>s){return n}else{return 0}})}this.layoutRows(r,this.options.structure.header)},nameOfHeader:function(e){return typeof e=="string"?e:e.value},layoutRows:function(e,t){this.data("tbody").empty();for(var n=0;n<e.length;n++){this.data("tbody").append(this.createRow(e[n],t))}},addOptions:function(n,r){if(r.style!=t){n.attr("style",r.style)}if(r.class!=t){var i=typeof r.class=="string"?[r.class]:r.class;e.each(i,e.proxy(function(e,t){n.addClass(t)},this))}var s=["mouseover","mouseout","click"];e.each(s,e.proxy(function(e,i){if(r[i]!=t){n.bind(i,r[i])}},this));if(r.colspan){n.attr("colspan",r.colspan)}if(r.rowspan){n.attr("rowspan",r.rowspan)}},createRow:function(n,r){var i=e("<tr></tr>");e.each(r,e.proxy(function(r,s){var o=this.nameOfHeader(s);var u=e("<td></td>");if(n[o]!=t){var a=typeof n[o]=="string"?n[o]:n[o].value;u.append(a);if(typeof n[o]!="string"){this.addOptions(u,n[o])}}if(a!=t){i.append(u)}},this));return i},deletePrompt:function(t){var n=e("<div></div>").kbaseDeletePrompt({name:t,callback:this.deleteRowCallback(t)});n.openPrompt()},deleteRowCallback:function(e){},shouldDeleteRow:function(e){return 1}})})(jQuery);(function(e,n){e.kbWidget("kbaseTabs","kbaseWidget",{version:"1.0.0",options:{tabPosition:"top",canDelete:false,borderColor:"lightgray"},init:function(t){this._super(t);this.data("tabs",{});this.data("nav",{});this.appendUI(e(this.$elem));return this},appendUI:function(t,r){if(r==n){r=this.options.tabs}var i=e("<div></div>").addClass("tabbable");var s=e("<div></div>").addClass("tab-content").attr("id","tabs-content");var o=e("<ul></ul>").addClass("nav nav-tabs").attr("id","tabs-nav");if(this.options.tabPosition=="top"){i.addClass("tabs-above");i.append(o).append(s)}else if(this.options.tabPosition=="bottom"){i.addClass("tabs-below");i.append(s).append(o)}else if(this.options.tabPosition=="left"){i.addClass("tabs-left");i.append(o).append(s)}else if(this.options.tabPosition=="right"){i.addClass("tabs-right");i.append(s).append(o)}this._rewireIds(i,this);t.append(i);if(r){e.each(r,e.proxy(function(e,t){this.addTab(t)},this))}},addTab:function(r){if(r.canDelete==n){r.canDelete=this.options.canDelete}var i=e("<div></div>").addClass("tab-pane fade").append(r.content);if(this.options.border){i.css("border","solid "+this.options.borderColor);i.css("border-width","0px 1px 0px 1px");i.css("padding","3px")}var s=this;var o=e("<li></li>").css("white-space","nowrap").append(e("<a></a>").attr("href","#").text(r.tab).attr("data-tab",r.tab).bind("click",function(t){t.preventDefault();t.stopPropagation();var n=s.data("tabs-nav").find(".active:last a")[0];e.fn.tab.Constructor.prototype.activate.call(e(this),e(this).parent("li"),s.data("tabs-nav"));e.fn.tab.Constructor.prototype.activate.call(e(this),i,i.parent(),function(){e(this).trigger({type:"shown",relatedTarget:n})})}).append(e("<button></button>").addClass("btn btn-mini").append(e("<i></i>").addClass(this.closeIcon())).css("padding","0px").css("width","22px").css("height","22px").css("margin-left","10px").attr("title",this.deleteTabToolTip(r.tab)).tooltip().bind("click",e.proxy(function(e){e.preventDefault();e.stopPropagation();this.deletePrompt(r.tab)},this))));if(!r.canDelete){o.find("button").remove()}this.data("tabs")[r.tab]=i;this.data("nav")[r.tab]=o;this.data("tabs-content").append(i);this.data("tabs-nav").append(o);var u=0;for(t in this.data("tabs")){u++}if(r.show||u==1){this.showTab(r.tab)}},closeIcon:function(){return"icon-remove"},deleteTabToolTip:function(e){return"Remove "+e},showTab:function(e){if(this.shouldShowTab(e)){this.data("nav")[e].find("a").trigger("click")}},shouldShowTab:function(e){return 1},deletePrompt:function(t){var n=e("<div></div>").kbaseDeletePrompt({name:t,callback:this.deleteTabCallback(t)});n.openPrompt()},deleteTabCallback:function(t){return e.proxy(function(e,r){if(r!=n){r.closePrompt()}var i=this.data("tabs")[t];var s=this.data("nav")[t];if(s.hasClass("active")){if(s.next("li").length){s.next().find("a").trigger("click")}else{s.prev("li").find("a").trigger("click")}}if(this.shouldDeleteTab(t)){i.remove();s.remove()}},this)},shouldDeleteTab:function(e){return 1},activeTab:function(){var t=this.data("tabs-nav").find(".active:last a")[0];return e(t).attr("data-tab")}})})(jQuery);(function(e,t){e.kbWidget("kbaseFileBrowser","kbaseWidget",{version:"1.0.0",options:{root:"/",controls:true,externalControls:true,height:"110px",tallHeight:"450px",shouldToggleNavHeight:true,controlButtons:["deleteButton","viewButton","addDirectoryButton","uploadButton","addButton"],name:"File Browser",openFolderIcon:"icon-folder-open-alt",closedFolderIcon:"icon-folder-close-alt",fileIcon:"icon-file"},init:function(e){this._super(e);if(e.client){this.client=e.client}if(e.$loginbox){this.$loginbox=e.$loginbox}this.appendUI(this.$elem);return this},refreshDirectory:function(e){if(this.sessionId()==t){this.$elem.find("ul").first().empty()}if(this.data(e)){this.listDirectory(e,this.data(e))}},sortByName:function(e,t){if(e["name"].toLowerCase()<t["name"].toLowerCase()){return-1}else if(e["name"].toLowerCase()>t["name"].toLowerCase()){return 1}else{return 0}},sessionId:function(){return this.$loginbox.sessionId()},selected:function(e){},displayPath:function(n,r,i){var s=this;r.empty();e.each(i,e.proxy(function(n,i){var o=this.options.fileIcon;var u=function(n){n.preventDefault();s.data("activeDirectory",t);s.data("activeFile",t);s.disableButtons();var r=s.$elem.find(".active");r.removeClass("active");if(e(this).parent().get(0)!=r.get(0)){e(this).parent().addClass("active");s.data("activeFile",i.path);s.enableButtons("f");s.selected(i.path)}};if(i.type=="directory"){o=this.data(i.path)?s.options.openFolderIcon:s.options.closedFolderIcon;u=function(n){n.preventDefault();s.data("activeDirectory",t);s.data("activeFile",t);s.disableButtons();var r=s.$elem.find(".active");r.removeClass("active");if(e(this).next().children().length){if(e(this).parent().get(0)==r.get(0)){e(this).children().first().removeClass(s.options.openFolderIcon);e(this).children().first().addClass(s.options.closedFolderIcon);e(this).next().empty();s.data(i.path,t)}else{s.data("activeDirectory",i.path);e(this).parent().addClass("active");s.enableButtons("d");s.selected(i.path)}}else{e(this).children().first().removeClass(s.options.closedFolderIcon);e(this).children().first().addClass(s.options.openFolderIcon);s.listDirectory(i.path,e(this).next());e(this).parent().addClass("active");s.data("activeDirectory",i.path);s.data(i.path,e(this).next());s.enableButtons("d");s.selected(i.path)}}}r.append(e("<li></li>").append(e("<a></a>").append(e("<i></i>").addClass(o).css("color","gray")).append(" ").append(i.name).attr("href","#").bind("click",u)).data("meta",i.meta).data("able","baker").append(e("<ul></ul>").addClass("nav nav-list")));if(i.type=="directory"&&this.data(i.path)){this.listDirectory(i.path,r.children().last().children().last())}},this))},fileBrowserContainer:function(){var t=this.options.height;var n=e("<ul></ul>").addClass("nav nav-list").css("height",t).css("overflow","auto").attr("id","ul-nav");var r=e("<div></div>").append(n);this.data("file-ul",n);return r},fileBrowserControls:function(){var t=e("<div></div>").addClass("btn-toolbar").addClass("text-right").append(e("<div></div>").addClass("btn-group").attr("id","control-buttons").append(e("<input></input>").attr("type","file").attr("id","fileInput").css("display","none").bind("change",jQuery.proxy(this.handleFileSelect,this))));return t},appendUI:function(t){var n=this.fileBrowserContainer();var r=e("<div></div>").kbaseBox({title:this.options.name,canCollapse:true,content:n});t.append(r.$elem);if(this.options.controls){if(this.options.externalControls){n.parent().parent().append(this.fileBrowserControls())}else{n.append(this.fileBrowserControls())}}this._rewireIds(r.$elem,this);e.each(this.options.controlButtons,e.proxy(function(e,t){this.data("control-buttons").append(this[t]())},this));this._rewireIds(r.$elem,this);this.listDirectory(this.options.root,this.data("file-ul"));this.disableButtons();return this},disableButtons:function(){this.toggleButtons("N")},enableButtons:function(e){this.toggleButtons(e)},toggleButtons:function(n){e.each(this.options.controlButtons,e.proxy(function(e,r){var i=this[r]();if(i==t){return}var s=i.data("require");if(s!=t){if(s=="a"&&n!="N"||s==n){i.removeClass("disabled")}else{i.addClass("disabled")}}},this))},addDirectoryButton:function(){return this.data("addDirectoryButton")!=t?this.data("addDirectoryButton"):e("<a></a>").attr("id","addDirectoryButton").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-plus")).attr("title","Add new directory").tooltip().bind("click",e.proxy(function(e){e.preventDefault();if(!this.addDirectoryButton().hasClass("disabled")){this.addDirectory()}},this))},viewButton:function(){return this.data("viewButton")!=t?this.data("viewButton"):e("<a></a>").attr("id","viewButton").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-search")).attr("title","View selected file").tooltip().bind("click",e.proxy(function(e){e.preventDefault();if(!this.viewButton().hasClass("disabled")){this.openFile(this.data("activeFile"))}},this)).data("require","f")},deleteButton:function(){return this.data("deleteButton")!=t?this.data("deleteButton"):e("<a></a>").attr("id","deleteButton").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-minus")).attr("title","Delete selected item").tooltip().bind("click",e.proxy(function(e){e.preventDefault();if(!this.deleteButton().hasClass("disabled")){this.deleteFile()}},this)).data("require","a")},uploadButton:function(){return this.data("uploadButton")!=t?this.data("uploadButton"):e("<a></a>").attr("id","uploadButton").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-arrow-up")).attr("title","Upload file").tooltip().bind("click",e.proxy(function(e){this.data("fileInput").trigger("click")},this))},addButton:function(){if(this.options.addFileCallback==t){return}return this.data("addButton")!=t?this.data("addButton"):e("<a></a>").attr("id","addButton").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-arrow-right")).attr("title","Add file").tooltip().bind("click",e.proxy(function(e){e.preventDefault();e.stopPropagation();if(!this.addButton().hasClass("disabled")){this.options.addFileCallback(this.data("activeFile"))}},this)).data("require","f")},addDirectory:function(){var t=this.data("activeDirectory")||this.options.root;var n=this;var r=t.replace(this.options.root,"/");var i=e("<div></div>").kbasePrompt({title:"Create directory",body:e("<p></p>").append("Create directory ").append(e("<span></span>").css("font-weight","bold").text(r)).append(" ").append(e("<input></input>").attr("type","text").attr("name","dir_name").attr("size","20")),controls:["cancelButton",{name:"Create directory",type:"primary",callback:function(e,r){r.closePrompt();n.makeDirectoryCallback(i.dialogModal().find("input").val(),t)}}]});i.openPrompt()},openFile:function(n,r,i){if(i==t){i=window.open();i.document.open()}if(r==t){this.fetchContent(n,i);return}r=r.replace(/>/g,">");r=r.replace(/</g,"<");i.document.write(e("<div></div>").append(e("<div></div>").css("white-space","pre").append(r)).html());i.document.close()},deleteFile:function(){var n=this.data("activeFile");var r="deleteFileCallback";if(n==t){n=this.data("activeDirectory");if(n==t){return}n=n.replace(/\/+$/,"");r="deleteDirectoryCallback"}var i=n.match(/(.+)\/[^/]+$/);var s="/";if(i!=t&&i.length>1){s=i[1]}var o=this;var u=n.replace(this.options.root,"");var a=e("<div></div>").kbaseDeletePrompt({name:u,callback:function(e,t){t.closePrompt();o[r](n,s)}});a.openPrompt()},handleFileSelect:function(t){t.stopPropagation();t.preventDefault();var n=t.target.files||t.originalEvent.dataTransfer.files||t.dataTransfer.files;e.each(n,jQuery.proxy(function(e,t){var n=new FileReader;var r=this.options.root;if(this.data("activeDirectory")){r=this.data("activeDirectory")}var i;if(this.options.processList){i=this.options.processList.addProcess("Uploading "+t.name)}n.onload=jQuery.proxy(function(e){this.uploadFile(t.name,e.target.result,r,i)},this);n.readAsText(t)},this));this.data("fileInput").val("")},listDirectory:function(e,t){throw"Cannot call listDirectory directly - please subclass"},makeDirectoryCallback:function(e,t){throw"Cannot call makeDirectoryCallback directly - please subclass"},fetchContent:function(e,t){throw"Cannot call fetchContent directly - please subclass"},deleteFileCallback:function(e,t){throw"Cannot call deleteFileCallback directly - please subclass"},deleteDirectoryCallback:function(e,t){throw"Cannot call deleteDirectoryCallback directly - please subclass"},uploadFile:function(e,t,n,r){throw"Cannot call uploadFile directly - please subclass"}})})(jQuery);(function(e,t){e.kbWidget("kbaseIrisCommands","kbaseAccordion",{version:"1.0.0",options:{link:function(t){alert("clicked on "+e(t.target).text())},englishCommands:0,fontSize:"75%",overflow:true,sectionHeight:"300px"},init:function(e){this._super(e);if(e.client){this.client=e.client}this.commands=[];return this},completeCommand:function(e){var t=[];var n=new RegExp("^"+e+".*");for(var r=0;r<this.commands.length;r++){if(this.commands[r].match(n)){t.push(this.commands[r])}}return t},commonPrefix:function(e,t){var n="";for(var r=0;r<e.length&&r<t.length;r++){var i=e.charAt(r);var s=t.charAt(r);if(i==s){n=n+i}else{break}}return n},commonCommandPrefix:function(e){var t="";if(e.length>1){t=this.commonPrefix(e[0],e[1]);for(var n=2;n<e.length;n++){t=this.commonPrefix(t,e[n])}}else{t=e[0]}return t},commandsMatchingRegex:function(e){var t=[];for(var n=0;n<this.commands.length;n++){if(this.commands[n].match(e)){t.push(this.commands[n])}}return t.sort()},appendUI:function(n){this.client.valid_commands_async(e.proxy(function(r){var i=[];e.each(r,e.proxy(function(n,r){r.title;var s=e("<ul></ul>").addClass("unstyled").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible");e.each(r.items,e.proxy(function(e,n){var r=n.cmd;if(this.options.englishCommands){var i=MetaToolInfo(n.cmd);if(i!=t){var o=i(n.cmd);r=o.label}}this.commands.push(n.cmd);s.append(this.createLI(n.cmd,r))},this));i.push({title:r.title,body:s})},this));this.loadedCallback(n,i)},this))},createLI:function(n,r,i){if(r==t){r=n}if(i==t){i=this.options.link}var s=this;return e("<li></li>").bind("mouseover",function(t){t.preventDefault();e(this).children().last().css("display","inline")}).bind("mouseout",function(t){t.preventDefault();e(this).children().last().css("display","none")}).append(e("<a></a>").attr("href","#").attr("title",n).data("type","invocation").text(r).bind("click",i)).append(e("<button></button>").addClass("btn btn-mini").css("display","none").css("float","right").append("?").bind("click",function(e){e.preventDefault();if(s.options.terminal!=t){s.options.terminal.run(n+" -h")}}))},loadedCallback:function(n,r){var i=this;e("input,textarea").on("focus.kbaseIrisCommands",e.proxy(function(n){if(e(":focus").get(0)!=t&&e(":focus").get(0)!=this.data("searchField").get(0)){this.data("focused",e(":focus"))}},this));this.data("focused",e(":focus"));var s=e("<div></div>").css("border","1px solid lightgray").css("padding","2px").append(e("<h5></h5>").addClass("text-left").text("Command List").css("background-color","lightgray").css("padding","2px").css("margin","0px").css("position","relative").bind("click",function(t){e(this).parent().children().last().collapse("toggle");if(i.options.fileBrowser){i.options.fileBrowser.toggleNavHeight()}}).append(e("<div></div>").css("right","0px").css("top","0px").css("position","absolute").append(e("<button></button>").attr("id","deleteSearchResults").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-remove")).css("padding-top","1px").css("padding-bottom","1px").css("display","none").attr("title","Remove search results").tooltip().bind("click",e.proxy(function(e){e.preventDefault();e.stopPropagation();this.data("searchResults").empty();this.data("deleteSearchResults").hide();this.data("searchFieldBox").hide()},this))).append(e("<button></button>").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-search")).css("padding-top","1px").css("padding-bottom","1px").attr("title","Search for command").tooltip().bind("click",e.proxy(function(e){e.preventDefault();e.stopPropagation();this.data("searchResults").empty();this.data("searchFieldBox").toggle();if(this.data("searchFieldBox").is(":hidden")){this.data("searchField").blur();this.data("focused").focus()}else{this.data("searchField").val("");this.data("searchField").focus()}},this)))).append(e("<div></div>").css("right","0px").css("top","24px").css("position","absolute").css("z-index","999").css("display","none").attr("id","searchFieldBox").append(e("<input></input").attr("type","text").addClass("input-medium search-query").attr("name","search").css("padding-top","1px").css("padding-bottom","1px").attr("id","searchField").keypress(e.proxy(function(t){if(t.which==13){var n=new RegExp(this.data("searchField").val(),"i");var r=this.commandsMatchingRegex(n);e.each(r,e.proxy(function(e,t){this.data("searchResults").append(this.createLI(t,t,function(e){i.options.link.call(this,e)}))},this));if(!r.length){this.data("searchResults").append(e("<li></li>").css("font-style","italic").text("No matching commands found"))}this.data("deleteSearchResults").show();this.data("searchFieldBox").hide();if(!r.length){this.data("focused").focus()}}},this))))).append(e("<ul></ul>").css("font-size",this.options.fontSize).css("padding-left","15px").attr("id","searchResults").addClass("unstyled").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible"));n.append(s);this._rewireIds(s,this);this._superMethod("appendUI",s,r);this.data("accordion").css("margin-bottom","0px")}})})(jQuery);(function(e,t){e.kbWidget("kbaseIrisFileBrowser","kbaseWidget",{version:"1.0.0",options:{root:"/",controls:true,externalControls:true,height:"110px",tallHeight:"450px",shouldToggleNavHeight:true,controlButtons:["deleteButton","viewButton","addDirectoryButton","uploadButton"],openFolderIcon:"icon-folder-open-alt",closedFolderIcon:"icon-folder-close-alt",fileIcon:"icon-file"},init:function(e){this._super(e);if(e.client){this.client=e.client}if(e.$loginbox){this.$loginbox=e.$loginbox}this.appendUI(this.$elem);return this},refreshDirectory:function(e){if(this.sessionId()==t){this.$elem.find("ul").first().empty()}if(this.data(e)){this.listDirectory(e,this.data(e))}},sortByName:function(e,t){if(e["name"]<t["name"]){return-1}else if(e["name"]>t["name"]){return 1}else{return 0}},sessionId:function(){return this.$loginbox.sessionId()},listDirectory:function(n,r){this.data(n,r);this.client.list_files_async(this.sessionId(),"/",n,jQuery.proxy(function(n){var i=n[0];var s=n[1];var o=this;r.empty();jQuery.each(i.sort(this.sortByName),e.proxy(function(n,i){i["full_path"]=i["full_path"].replace(/\/+/g,"/");r.append(e("<li></li>").append(e("<a></a>").append(e("<i></i>").addClass(this.data(i["full_path"])?o.options.openFolderIcon:o.options.closedFolderIcon).css("color","gray")).append(" ").append(i["name"]).attr("href","#").bind("click",function(n){n.preventDefault();o.data("activeDirectory",t);o.data("activeFile",t);o.viewButton().addClass("disabled");o.deleteButton().addClass("disabled");var r=o.$elem.find(".active");r.removeClass("active");if(e(this).next().children().length){if(e(this).parent().get(0)==r.get(0)){e(this).children().first().removeClass(o.options.openFolderIcon);e(this).children().first().addClass(o.options.closedFolderIcon);e(this).next().empty();o.data(i["full_path"],t)}else{o.data("activeDirectory",i["full_path"]);e(this).parent().addClass("active");o.deleteButton().removeClass("disabled")}}else{e(this).children().first().removeClass(o.options.closedFolderIcon);e(this).children().first().addClass(o.options.openFolderIcon);o.listDirectory(i["full_path"],e(this).next());e(this).parent().addClass("active");o.data("activeDirectory",i["full_path"]);o.deleteButton().removeClass("disabled")}})).append(e("<ul></ul>").addClass("nav nav-list")));if(this.data(i["full_path"])){this.listDirectory(i["full_path"],r.children().last().children().last())}},this));jQuery.each(s.sort(this.sortByName),e.proxy(function(n,i){i["full_path"]=i["full_path"].replace(/\/+/g,"/");r.append(e("<li></li>").append(e("<a></a>").append(e("<i></i>").addClass(this.options.fileIcon).css("color","gray")).append(" ").append(i["name"]).attr("href","#").bind("click",function(n){n.preventDefault();o.data("activeDirectory",t);o.data("activeFile",t);o.viewButton().addClass("disabled");o.deleteButton().addClass("disabled");var r=o.$elem.find(".active");r.removeClass("active");if(e(this).parent().get(0)!=r.get(0)){e(this).parent().addClass("active");o.data("activeFile",i["full_path"]);o.viewButton().removeClass("disabled");o.deleteButton().removeClass("disabled")}})))},this))},this),e.proxy(function(e){this.dbg(e)},this))},toggleNavHeight:function(){if(this.options.shouldToggleNavHeight){var e=this.data("ul-nav");var t=e.css("height");e.css("height",t==this.options.height?this.options.tallHeight:this.options.height)}},appendUI:function(t){var n=e("<div></div>").css("border","1px solid lightgray").css("padding","2px").append(e("<h5></h5>").addClass("text-left").text("File Browser").css("margin","0px").css("padding","2px").css("background-color","lightgray").css("border-collapse","collapse").bind("click",function(t){e(this).next().collapse("toggle")}));var r=this.options.height;var i=e("<ul></ul>").addClass("nav nav-list").css("height",r).css("overflow","auto").attr("id","ul-nav");var s=e("<div></div>").addClass("btn-toolbar").addClass("text-right").append(e("<div></div>").addClass("btn-group").attr("id","control-buttons").append(e("<input></input>").attr("type","file").attr("id","fileInput").css("display","none").bind("change",jQuery.proxy(this.handleFileSelect,this))));var o=e("<div></div>").append(i);n.append(o);t.append(n);if(this.options.controls){if(this.options.externalControls){n.append(s)}else{o.append(s)}}this._rewireIds(n,this);e.each(this.options.controlButtons,e.proxy(function(e,t){this.data("control-buttons").append(this[t]())},this));this._rewireIds(n,this);this.listDirectory(this.options.root,i);return this},addDirectoryButton:function(){return this.data("addDirectoryButton")!=t?this.data("addDirectoryButton"):e("<a></a>").attr("id","addDirectoryButton").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-plus")).attr("title","Add new directory").tooltip().bind("click",e.proxy(function(e){e.preventDefault();if(!this.addDirectoryButton().hasClass("disabled")){this.addDirectory()}},this))},viewButton:function(){return this.data("viewButton")!=t?this.data("viewButton"):e("<a></a>").attr("id","viewButton").addClass("btn btn-mini disabled").append(e("<i></i>").addClass("icon-search")).attr("title","View selected file").tooltip().bind("click",e.proxy(function(e){e.preventDefault();if(!this.viewButton().hasClass("disabled")){this.openFile(this.data("activeFile"))}},this))},deleteButton:function(){return this.data("deleteButton")!=t?this.data("deleteButton"):e("<a></a>").attr("id","deleteButton").addClass("btn btn-mini disabled").append(e("<i></i>").addClass("icon-remove")).attr("title","Delete selected item").tooltip().bind("click",e.proxy(function(e){e.preventDefault();if(!this.deleteButton().hasClass("disabled")){this.deleteFile()}},this))},uploadButton:function(){return this.data("uploadButton")!=t?this.data("uploadButton"):e("<a></a>").attr("id","uploadButton").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-arrow-up")).attr("title","Upload file").tooltip().bind("click",e.proxy(function(e){this.data("fileInput").trigger("click")},this))},addDirectory:function(){var t=this.data("activeDirectory")||this.options.root;var n=this;var r=t.replace(this.options.root,"/");var i=e("<div></div>").kbasePrompt({title:"Create directory",body:e("<p></p>").append("Create directory ").append(e("<span></span>").css("font-weight","bold").text(r)).append(" ").append(e("<input></input>").attr("type","text").attr("name","dir_name").attr("size","20")),controls:["cancelButton",{name:"Create directory",type:"primary",callback:function(e,r){r.closePrompt();n.client.make_directory_async(n.sessionId,t,i.dialogModal().find("input").val(),function(e){n.refreshDirectory(t)},function(){})}}]});i.openPrompt()},openFile:function(n){var r=window.open();r.document.open();this.client.get_file_async(this.sessionId(),n,"/",e.proxy(function(n){try{var i=JSON.parse(n);n=JSON.stringify(i,t,2)}catch(s){this.dbg("FAILURE");this.dbg(s)}r.document.write(e("<div></div>").append(e("<div></div>").css("white-space","pre").append(n)).html());r.document.close()},this),function(e){this.dbg("FILE FAILURE");this.dbg(e)})},deleteFile:function(){var n=this.data("activeFile");var r="remove_files_async";if(n==t){n=this.data("activeDirectory");if(n==t){return}n=n.replace(/\/+$/,"");r="remove_directory_async"}var i=n.match(/(.+)\/[^/]+$/);var s="/";if(i!=t&&i.length>1){s=i[1]}var o=this;var u=n.replace(this.options.root,"");var a=e("<div></div>").kbaseDeletePrompt({name:u,callback:function(e,t){t.closePrompt();o.client[r](o.sessionId,"/",n,function(e){o.refreshDirectory(s)},function(){})}});a.openPrompt()},handleFileSelect:function(t){t.stopPropagation();t.preventDefault();var n=t.target.files||t.originalEvent.dataTransfer.files||t.dataTransfer.files;e.each(n,jQuery.proxy(function(e,t){var n=new FileReader;var r="/";if(this.data("activeDirectory")){r=this.data("activeDirectory")}var i;if(this.options.processList){i=this.options.processList.addProcess("Uploading "+t.name)}n.onload=jQuery.proxy(function(e){this.client.put_file_async(this.sessionId(),t.name,e.target.result,r,jQuery.proxy(function(e){if(this.options.processList){this.options.processList.removeProcess(i)}this.refreshDirectory(r)},this),jQuery.proxy(function(e){if(this.options.processList){this.options.processList.removeProcess(i)}this.dbg(e)},this))},this);n.readAsText(t)},this));this.data("fileInput").val("")}})})(jQuery);(function(e,t){e.kbWidget("kbaseIrisGrammar","kbaseWidget",{version:"1.0.0",options:{defaultGrammarURL:"http://www.prototypesite.net/iris-dev/grammar.json"},init:function(n){this._super(n);if(this.options.$loginbox!=t){this.$loginbox=this.options.$loginbox}this.appendUI(e(this.$elem));this.retrieveGrammar(this.options.defaultGrammarURL);return this},appendUI:function(e){},tokenize:function(e){var n=[];var r="";var i=t;var s=false;for(var o=0;o<e.length;o++){var u=e.charAt(o);if(i==t){if(u.match(/[?;]/)){continue}}if(u.match(/\S/)||i!=t){r=r+u}else{if(r.length){n.push(r);r=""}continue}if(i!=t){if(u==i&&!s){r=r.substring(1,r.length-1);n.push(r);r="";i=t;continue}}if(i==t){if(u=='"'||u=="'"){i=u}}if(u=="\\"){s=true}else{s=false}}if(r.length){n.push(r)}return n},evaluate:function(n,r){var i=this.tokenize(n);var s=this.grammar;if(s==t){this.retrieveGrammar(this.options.defaultGrammarURL,e.proxy(function(){this.evaluate(n,r)},this));return}var o=t;var u=t;var a={};var f={parsed:"",string:n,grammar:s._root};if(i[0]=="explain"){i.shift();f.explain=1}for(var l=0;l<i.length;l++){var c=i[l];var h=false;for(child in f.grammar.children){var p=f.grammar.children[child];if(p.regex&&c.match(p.regex)){f.grammar=f.grammar.children[child];h=true}else if(child.match(/^\$/)){f.grammar=f.grammar.children[child];h=true}else if(c==child){f.grammar=f.grammar.children[child];h=true}else if(!p.caseSensitive){var d=new RegExp("^"+child+"$","i");if(c.match(d)){f.grammar=f.grammar.children[child];h=true}}if(h){if(child.match(/^\$/)){a[child]=c}if(f.parsed.length){f.parsed=f.parsed+" "+c}else{f.parsed=c}f.grammar=p;f.execute=p.execute;break}}if(!h&&!f.grammar.childrenOptional){f.tail=i.splice(l,i.length-l).join(" ");break}}if(f.grammar.children!=t&&Object.keys(f.grammar.children).length&&!f.grammar.childrenOptional){f.error="Parse error at "+c;f.fail=1;delete f.execute;f.token=c;f.tail=i.splice(l,i.length-l).join(" ");var v=[];if(f.grammar.children!=t){for(prop in f.grammar.children){v.push(this.nextForGrammar(prop,f.grammar.children))}}f.next=v.sort();if(r){r(f)}return f}f.rawExecute=f.execute;for(var m in a){f.execute=f.execute.replace(m,a[m])}if(f.tail){var g;if(g=f.tail.match(/^into\s+(\S+)/)){f.execute=f.execute+" > "+g[1]}else{f.fail=1;f.error="Extra characters - "+f.tail}}if(r){r(f)}return f},nextForGrammar:function(e,n){if(e==t){e=""}var r=n[e].children;var i;var s=1e3;while(r!=t&&s-->0){if(Object.keys(r).length==1){var o=Object.keys(r)[0];e=e.length?e+" "+o:o;r=r[o].children}}return e},allQuestions:function(e){var n=["Display the dna sequence of contig $contig_id from $max to $min","Display the dna sequence of gene $gene_id","What type of family is $family","What is the function of family $family","What fids are in family $family","Display sequences in family $family as fasta","Display sequences in family $family","What is the function of feature $feature_id","What fids in k12 have attached publications","What publications have been connected to gene thrB","Show the DNA sequence of fid thrB","Display the protein sequence of fid thrB","Which protein families contain gene $gene_id","Is fid thrB in an atomic regulon","Which fids appear to have correlated expression with gene thrB","What is the location of feature thrB","What protein sequence corresponds to fid $fid","Which contigs are in genome $genome","What is the size of genome $genome","What is the KBase id of SEED genome $genome","What is the KBase id of SEED feature $feature","What is the source of genome $genome","Which are the closest genomes to $genome","What is the name of genome $genome","Which genomes have models","Which models exist for genome $genome","Which reactions exist in genome $genome","Which reactions are in model $model","What reactions connect to role $role","What roles relate to reaction $reaction","What complexes implement reaction $reaction","What reactions does complex $complex implement","Describe the biomass reaction for model kb|fm.0","What compounds are connected to model $model","What media are known","What compounds are considered part of media $media","show reactions that connect to compound $compound","How many otus exist","What otus exist","What otu contains $otu","What genomes are in OTU $otu","What annotations are known for protein sequence $sequence","What roles are used in models","What roles are used in subsystem $subsystem","What subsystems include role $role","What features in $feature implement role $role","What families implement role $role","What roles occur in subsystem $subsystem","What roles are in subsystem $subsystem","What genomes are in subsystem $subsystem","What subsystems are in genome $genome","what is the taxonomy of genome $genome","What is the taxonomic group id of $group_id","What genomes are in taxonomic group $group"];if(e==t){return n}else{var r=[];var i=new RegExp(e);for(var s=0;s<n.length;s++){var o=n[s];if(o.match(i)){r.push(o)}}return r}},XXXallQuestionsBOGUS:function(n,r){if(r==t){r=""}if(n==t){if(this.grammar==t){this.retrieveGrammar(this.options.defaultGrammarURL,e.proxy(function(){this.allQuestions()},this));return}else{n=this.grammar._root.children}}for(var i in n){var s=r.length?r+" "+i:i}},retrieveGrammar:function(n,r){var i=t;e.ajax({async:true,dataType:"text",url:n,crossDomain:true,beforeSend:function(e){if(i){e.setRequestHeader("Authorization",i)}},success:e.proxy(function(e,t,n){var i=JSON.parse(e);this.grammar=i;if(r){r()}},this),error:e.proxy(function(e,t,n){this.dbg(t);throw e},this),type:"GET"})}})})(jQuery);(function(e,t){e.kbWidget("kbaseIrisProcessList","kbaseWidget",{version:"1.0.0",options:{},init:function(e){this._super(e);this.appendUI(this.$elem);return this},appendUI:function(t){t.append(e("<div></div>").css("border","1px solid lightgray").css("padding","2px").append(e("<h5></h5>").addClass("text-left").text("Running processes").css("margin","0px").css("padding","2px").css("background-color","lightgray").css("border-collapse","collapse")).append(e("<ul></ul>").addClass("unstyled").append(this.pendingLi())));return this},pendingLi:function(){if(this.data("pendingLi")==t){this.data("pendingLi",e("<li></li>").css("font-style","italic").text("No processes running"))}return this.data("pendingLi")},addProcess:function(t){this.pendingLi().remove();var n=e("<li></li>").text(t);this.$elem.find("ul").append(n);return n},removeProcess:function(e){e.remove();if(this.$elem.find("ul").children().length==0){this.$elem.find("ul").append(this.pendingLi())}}})})(jQuery);(function(e,t){e.kbWidget("kbaseIrisTerminal","kbaseWidget",{version:"1.0.0",options:{invocationURL:"http://localhost:5000",searchURL:"https://kbase.us/services/search-api/search/$category/$keyword?start=$start&count=$count&format=json",searchStart:1,searchCount:10,searchFilter:{literature:"link,pid"},maxOutput:100,scrollSpeed:750,terminalHeight:"500px",promptIfUnauthenticated:1},init:function(n){this._super(n);e.fn.setCursorPosition=function(t){if(this.length==0)return this;return e(this).setSelection(t,t)};e.fn.setSelection=function(e,t){if(this.length==0)return this;input=this[0];if(input.createTextRange){var n=input.createTextRange();n.collapse(true);n.moveEnd("character",t);n.moveStart("character",e);n.select()}else if(input.setSelectionRange){input.focus();input.setSelectionRange(e,t)}return this};e.fn.focusEnd=function(){this.setCursorPosition(this.val().length);return this};e.fn.getCursorPosition=function(){if(this.length==0)return this;input=this[0];return input.selectionEnd};if(this.options.client){this.client=this.options.client}else{this.client=new InvocationService(this.options.invocationURL,t,jQuery.proxy(function(){var e=this.$loginbox.kbaseLogin("get_kbase_cookie");if(e){var n=e["token"];this.dbg("returning token from auth_cb "+n);return n}else{this.dbg("returning undef from auth_cb ");return t}},this))}this.$loginbox=e("<div></div>").kbaseLogin({style:"text",login_callback:jQuery.proxy(function(e){if(e.success){this.out_line();this.client.start_session_async(e.user_id,jQuery.proxy(function(t){this.set_session(e.user_id);this.loadCommandHistory();this.out("Set session to "+e.user_id);this.scroll()},this),jQuery.proxy(function(e){this.out("<i>Error on session_start:<br>"+e.message.replace("\n","<br>\n")+"</i>")},this));this.kbase_sessionid=e.kbase_sessionid;this.input_box.focus();this.refreshFileBrowser()}},this),logout_callback:jQuery.proxy(function(){this.sessionId=t;this.cwd="/";this.dbg("LOGOUT CALLBACK");this.refreshFileBrowser();this.terminal.empty()},this)});this.tutorial=e("<div></div>").kbaseIrisTutorial();this.commandHistory=[];this.commandHistoryPosition=0;this.path=".";this.cwd="/";this.variables={};this.aliases={};this.appendUI(e(this.$elem));var r;if(r=this.$loginbox.get_kbase_cookie()){var i=e("<div></div>").css("white-space","pre");this.terminal.append(i);this.out_line();if(r.user_id){this.out_to_div(i,"Already logged in as "+r.name+"\n");this.set_session(r.user_id);this.loadCommandHistory();this.out_to_div(i,"Set session to "+r.user_id)}else if(this.options.promptIfUnauthenticated){this.$loginbox.kbaseLogin("openDialog")}}else if(this.options.promptIfUnauthenticated){this.$loginbox.kbaseLogin("openDialog")}this.fileBrowsers=[];if(this.options.fileBrowser){this.addFileBrowser(this.options.fileBrowser)}else{this.addFileBrowser(e("<div></div>").kbaseIrisFileBrowser({client:this.client,$loginbox:this.$loginbox,externalControls:false}))}return this},addFileBrowser:function(e){this.fileBrowsers.push(e)},open_file:function(e){this.fileBrowsers[0].openFile(e)},refreshFileBrowser:function(){for(var e=0;e<this.fileBrowsers.length;e++){this.fileBrowsers[e].refreshDirectory(this.cwd)}},loginbox:function(){return this.$loginbox},getClient:function(){return this.client},authToken:function(){var e=this.$loginbox.kbaseLogin("get_kbase_cookie");if(e!=t){return e["token"]}else{return t}},appendInput:function(e,n){if(this.input_box){var r=n==t?" ":"";if(this.input_box.val().length==0){r=""}this.input_box.val(this.input_box.val()+r+e);this.input_box.focusEnd()}},appendUI:function(t){var n=e("<div></div>").append(e("<div></div>").attr("id","terminal").css("height",this.options.terminalHeight).css("overflow","auto").css("padding","5px").css("font-family","monospace")).append(e("<textarea></textarea>").attr("id","input_box").attr("style","width : 99%;").attr("height","3")).append(e("<div></div>").attr("id","file-uploader")).append(e("<div></div>").attr("id","panel").css("display","none"));this._rewireIds(n,this);t.append(n);this.terminal=this.data("terminal");this.input_box=this.data("input_box");this.out("Welcome to the interactive KBase.");this.out_line();this.input_box.bind("keypress",jQuery.proxy(function(e){this.keypress(e)},this));this.input_box.bind("keydown",jQuery.proxy(function(e){this.keydown(e)},this));this.input_box.bind("onchange",jQuery.proxy(function(e){this.dbg("change")},this));this.data("input_box").focus();e(window).bind("resize",jQuery.proxy(function(e){this.resize_contents(this.terminal)},this));this.resize_contents(this.terminal)},saveCommandHistory:function(){this.client.put_file_async(this.sessionId,"history",JSON.stringify(this.commandHistory),"/",function(){},function(){})},loadCommandHistory:function(){this.client.get_file_async(this.sessionId,"history","/",jQuery.proxy(function(e){this.commandHistory=JSON.parse(e);this.commandHistoryPosition=this.commandHistory.length},this),jQuery.proxy(function(e){this.dbg("error on history load : "+e)},this))},set_session:function(e){this.sessionId=e},resize_contents:function(e){},keypress:function(e){if(e.which==13){e.preventDefault();var t=this.input_box.val();t=t.replace(/^ +/,"");t=t.replace(/ +$/,"");this.dbg("Run ("+t+")");this.out_cmd(t);var n=t+t;var r;if(r=t.match(/^\s*(\$\S+)/)){n=r[1]}for(variable in this.variables){if(variable.match(n)){continue}var i=variable.replace(/\$/,"\\$");var s=new RegExp(i,"g");t=t.replace(s,this.variables[variable])}this.run(t);this.scroll();this.input_box.val("")}},keydown:function(e){if(e.which==38){e.preventDefault();if(this.commandHistoryPosition>0){this.commandHistoryPosition--}this.input_box.val(this.commandHistory[this.commandHistoryPosition])}else if(e.which==40){e.preventDefault();if(this.commandHistoryPosition<this.commandHistory.length){this.commandHistoryPosition++}this.input_box.val(this.commandHistory[this.commandHistoryPosition])}else if(e.which==39){if(this.options.commandsElement){var n=this.input_box.val().length;var r=this.input_box.getCursorPosition();if(r!=t&&r<n){this.selectNextInputVariable(e);return}e.preventDefault();var i=this.input_box.val().match(/([^\s]+)\s*$/);if(i.length){i=i[1];var s=this.options.grammar.evaluate(this.input_box.val());if(s!=t&&s["next"]&&s["next"].length){var o=new RegExp("^"+i);var u=[];for(var a=0;a<s["next"].length;a++){var f=s["next"][a];if(f.match(o)){u.push(f)}}if(u.length||s.parsed.length==0){s["next"]=u;if(s["next"].length==1){var l=new RegExp("s*"+i+"s*$");this.input_box.val(this.input_box.val().replace(l,""))}}if(s["next"].length==1){var c=" ";if(this.input_box.val().match(/\s+$/)){c=""}this.appendInput(c+s["next"][0]+" ",0);this.selectNextInputVariable();return}else if(s["next"].length){var h=true;var p=new RegExp(i+"\\s*$");for(prop in s.next){if(!prop.match(p)){h=false}}this.displayCompletions(s["next"],i);return}}var d=this.options.commandsElement.kbaseIrisCommands("completeCommand",i);if(d.length==1){var v=d[0].replace(new RegExp("^"+i),"");this.appendInput(v+" ",0)}else if(d.length){this.displayCompletions(d,i)}}}}},selectNextInputVariable:function(e){var n;var r=this.input_box.getCursorPosition();if(n=this.input_box.val().match(/(\$\S+)/)){if(e!=t){e.preventDefault()}var i=this.input_box.val().indexOf(n[1]);var s=this.input_box.val().indexOf(n[1])+n[1].length;this.input_box.setSelection(i,s);this.input_box.setSelection(i,s)}},search_json_to_table:function(t,n){var r=e("<div></div>");var i=new RegExp(".");if(n){i=new RegExp(n.replace(/,/g,"|"))}e.each(t,e.proxy(function(t,n){var s=e("<table></table>").css("border","1px solid black").css("margin-bottom","2px");var o=Object.keys(n).sort();for(var t=0;t<o.length;t++){var u=o[t];if(u.match(i)){s.append(e("<tr></tr>").css("text-align","left").append(e("<th></th>").append(u)).append(e("<td></td>").append(n[u])))}}r.append(s)},this));return r},displayCompletions:function(n,r){var i=this.options.commandsElement.kbaseIrisCommands("commonCommandPrefix",n);if(i!=t&&i.length){this.input_box.val(this.input_box.val().replace(new RegExp(r+"s*$"),i))}else{i=r}var s=e("<div></div>");this.terminal.append(s);var o=e("<table></table>").attr("border",1).css("margin-top","10px").append(e("<tr></tr>").append(e("<th></th>").text("Suggested commands")));jQuery.each(n,jQuery.proxy(function(t,n){o.append(e("<tr></tr>").append(e("<td></td>").append(e("<a></a>").attr("href","#").text(n).bind("click",jQuery.proxy(function(e){e.preventDefault();this.input_box.val(this.input_box.val().replace(new RegExp(i+"s*$"),""));this.appendInput(n+" ")},this)))))},this));s.append(o);this.scroll()},out_cmd:function(t){var n=e("<div></div>").css("white-space","pre").css("position","relative").append(e("<div></div>").addClass("btn-group").css("display","none").css("position","absolute").css("top","0px").css("right","0px").css("text-align","right").append(e("<a></a>").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-download-alt")).attr("title","Open results in new window").bind("click",function(t){var n=window.open();n.document.open();var r=e("<div></div>").append(e("<div></div>").css("white-space","pre").css("font-family","monospace").append(e(this).parent().parent().next().clone()));e.each(r.find("a"),function(t,n){e(n).replaceWith(e(n).html())});n.document.write(r.html());n.document.close()})).append(e("<a></a>").addClass("btn btn-mini").append(e("<i></i>").addClass("icon-remove")).attr("title","delete command from window").bind("click",function(t){e(this).parent().parent().next().remove();e(this).parent().parent().next().remove();e(this).parent().parent().remove()}))).append(e("<span></span>").addClass("command").text(">"+this.cwd+" "+t)).mouseover(function(t){e(this).children().first().show()}).mouseout(function(t){e(this).children().first().hide()});this.terminal.append(n)},out:function(e,t,n){this.out_to_div(this.terminal,e,t,n)},out_to_div:function(e,t,n,r){if(!r&&typeof t=="string"){t=t.replace(/</g,"<");t=t.replace(/>/g,">")}e.append(t);if(n){this.scroll(0)}},out_line:function(t){var n=e("<hr/>");this.terminal.append(n);this.scroll(0)},scroll:function(e){if(e==t){e=this.options.scrollSpeed}this.terminal.animate({scrollTop:this.terminal.prop("scrollHeight")-this.terminal.height()},e)},run:function(n){if(n=="help"){this.out('There is an introductory Iris tutorial available <a target="_blank" href="http://kbase.us/developer-zone/tutorials/iris/introduction-to-the-kbase-iris-interface/">on the KBase tutorials website</a>.',0,1);return}var r=e("<div></div>").css("white-space","pre");this.terminal.append(r);this.out_line();var i;if(i=n.match(/^log[io]n\s*(.*)/)){var s=i[1].split(/\s+/);this.dbg(s.length);if(s.length!=1){this.out_to_div(r,"Invalid login syntax.");return}sid=s[0];this.client.start_session_async(sid,jQuery.proxy(function(e){this.set_session(sid);this.loadCommandHistory();this.out_to_div(r,"Set session to "+sid)},this),jQuery.proxy(function(e){this.out_to_div(r,"<i>Error on session_start:<br>"+e.message.replace("\n","<br>\n")+"</i>")},this));this.scroll();return}if(i=n.match(/^authenticate\s*(.*)/)){var s=i[1].split(/\s+/);if(s.length!=1){this.out_to_div(r,"Invalid login syntax.");return}sid=s[0];this.$loginbox.kbaseLogin("data","passed_user_id",sid);this.$loginbox.data("passed_user_id",sid);this.$loginbox.kbaseLogin("openDialog");return}if(i=n.match(/^unauthenticate/)){this.$loginbox.kbaseLogin("logout");this.scroll();return}if(i=n.match(/^logout/)){this.sessionId=t;this.scroll();return}if(!this.sessionId){this.out_to_div(r,"You are not logged in.");this.scroll();return}this.commandHistory.push(n);this.saveCommandHistory();this.commandHistoryPosition=this.commandHistory.length;if(n=="clear"){this.terminal.empty();return}if(n=="history"){var o=e("<table></table>");jQuery.each(this.commandHistory,jQuery.proxy(function(t,n){o.append(e("<tr></tr>").append(e("<td></td>").text(t)).append(e("<td></td>").css("padding-left","10px").append(e("<a></a>").attr("href","#").text(n).bind("click",jQuery.proxy(function(e){e.preventDefault();this.appendInput(n+" ")},this)))))},this));this.out_to_div(r,o);return}else if(i=n.match(/^!(\d+)/)){n=this.commandHistory.item(i[1])}if(i=n.match(/^cd\s*(.*)/)){var s=i[1].split(/\s+/);if(s.length!=1){this.out_to_div(r,"Invalid cd syntax.");return}dir=s[0];this.client.change_directory_async(this.sessionId,this.cwd,dir,jQuery.proxy(function(e){this.cwd=e},this),jQuery.proxy(function(e){var t=e.message.replace("/\n","<br>\n");this.out_to_div(r,"<i>Error received:<br>"+e.code+"<br>"+t+"</i>")},this));return}if(i=n.match(/^(\$\S+)\s*=\s*(\S+)/)){this.variables[i[1]]=i[2];this.out_to_div(r,i[1]+" set to "+i[2]);return}if(i=n.match(/^alias\s+(\S+)\s*=\s*(\S+)/)){this.aliases[i[1]]=i[2];this.out_to_div(r,i[1]+" set to "+i[2]);return}if(i=n.match(/^search\s+(\S+)\s+(\S+)(?:\s*(\S+)\s+(\S+)(?:\s*(\S+))?)?/)){var u=this.options.grammar.evaluate(n);var a={};var f=this.options.searchURL;a.$category=i[1];a.$keyword=i[2];a.$start=i[3]||this.options.searchStart;a.$count=i[4]||this.options.searchCount;var l=i[5]||this.options.searchFilter[a.$category];for(prop in a){f=f.replace(prop,a[prop])}e.support.cors=true;e.ajax({type:"GET",url:f,dataType:"json",crossDomain:true,xhrFields:{withCredentials:true},xhrFields:{withCredentials:true},beforeSend:function(e){e.withCredentials=true},success:e.proxy(function(t,n,i){this.out_to_div(r,e("<i></i>").html("Command completed."));this.out_to_div(r,e("<br/>"));this.out_to_div(r,e("<span></span>").append(e("<b></b>").html(t.found)).append(" records found."));this.out_to_div(r,e("<br/>"));this.out_to_div(r,this.search_json_to_table(t.body,l));var n=this.search_json_to_table(t.body,l);this.scroll()},this),error:e.proxy(function(e,t,n){this.out_to_div(r,n)},this)});return}if(i=n.match(/^cp\s*(.*)/)){var s=i[1].split(/\s+/);if(s.length!=2){this.out_to_div(r,"Invalid cp syntax.");return}from=s[0];to=s[1];this.client.copy_async(this.sessionId,this.cwd,from,to,e.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(e){var t=e.message.replace("\n","<br>\n");this.out_to_div(r,"<i>Error received:<br>"+e.code+"<br>"+t+"</i>")},this));return}if(i=n.match(/^mv\s*(.*)/)){var s=i[1].split(/\s+/);if(s.length!=2){this.out_to_div(r,"Invalid mv syntax.");return}from=s[0];to=s[1];this.client.rename_file_async(this.sessionId,this.cwd,from,to,e.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(e){var t=e.message.replace("\n","<br>\n");this.out_to_div(r,"<i>Error received:<br>"+e.code+"<br>"+t+"</i>")},this));return}if(i=n.match(/^mkdir\s*(.*)/)){var s=i[1].split(/\s+/);if(s.length!=1){this.out_to_div(r,"Invalid mkdir syntax.");return}dir=s[0];this.client.make_directory_async(this.sessionId,this.cwd,dir,e.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(e){var t=e.message.replace("\n","<br>\n");this.out_to_div(r,"<i>Error received:<br>"+e.code+"<br>"+t+"</i>")},this));return}if(i=n.match(/^rmdir\s*(.*)/)){var s=i[1].split(/\s+/);if(s.length!=1){this.out_to_div(r,"Invalid rmdir syntax.");return}dir=s[0];this.client.remove_directory_async(this.sessionId,this.cwd,dir,e.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(e){var t=e.message.replace("\n","<br>\n");this.out_to_div(r,"<i>Error received:<br>"+e.code+"<br>"+t+"</i>")},this));return}if(i=n.match(/^rm\s*(.*)/)){var s=i[1].split(/\s+/);if(s.length!=1){this.out_to_div(r,"Invalid rm syntax.");return}file=s[0];this.client.remove_files_async(this.sessionId,this.cwd,file,e.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(e){var t=e.message.replace("\n","<br>\n");this.out_to_div(r,"<i>Error received:<br>"+e.code+"<br>"+t+"</i>")},this));return}if(n=="next"){this.tutorial.goToNextPage();n="show_tutorial"}if(n=="back"){this.tutorial.goToPrevPage();n="show_tutorial"}if(n=="tutorial"){this.tutorial.currentPage=0;n="show_tutorial"}if(n=="tutorial list"){var c=this.tutorial.list();e.each(c,e.proxy(function(t,n){r.append(e("<a></a>").attr("href","#").append(n).bind("click",e.proxy(function(t){t.preventDefault();t.stopPropagation();this.out_to_div(r,"Set tutorial to <i>"+n+"</i><br>",0,1);this.tutorial=e("<div></div>").kbaseIrisTutorial({tutorial:n});this.input_box.focus()},this)).append("<br>"))},this));this.scroll();return}if(n=="show_tutorial"){var h=this.tutorial.contentForCurrentPage().clone();var p={"text-align":"left","font-size":"100%"};h.find("h1").css(p);h.find("h2").css(p);if(this.tutorial.currentPage>0){h.append("<br>Type <i>back</i> to move to the previous step in the tutorial.")}if(this.tutorial.currentPage<this.tutorial.pages.length-1){h.append("<br>Type <i>next</i> to move to the next step in the tutorial.")}h.append("<br>Type <i>tutorial list</i> to see available tutorials.");r.css("white-space","");this.out_to_div(r,h,0,1);this.scroll();return}if(n=="commands"){this.client.valid_commands_async(jQuery.proxy(function(n){var i=e("<table></table>");jQuery.each(n,function(n,r){i.append(e("<tr></tr>").append(e("<th></th>").attr("colspan",2).html(r.title)));for(var s=0;s<r.items.length;s+=2){i.append(e("<tr></tr>").append(e("<td></td>").html(r.items[s].cmd)).append(e("<td></td>").html(r.items[s+1]!=t?r.items[s+1].cmd:"")))}});r.append(i);this.scroll()},this));return}if(i=n.match(/^questions\s*(\S+)?/)){var v=this.options.grammar.allQuestions(i[1]);var o=e("<table></table>");e.each(v,e.proxy(function(t,n){o.append(e("<tr></tr>").append(e("<td></td>").append(e("<a></a>").attr("href","#").text(n).bind("click",jQuery.proxy(function(e){e.preventDefault();this.input_box.val(n);this.selectNextInputVariable()},this)))))},this));r.append(o);this.scroll();return}if(d=n.match(/^ls\s*(.*)/)){var s=d[1].split(/\s+/);var m=this;if(s.length==0){d="."}else{if(s.length!=1){this.out_to_div(r,"Invalid ls syntax.");return}else{d=s[0]}}this.client.list_files_async(this.sessionId,this.cwd,d,jQuery.proxy(function(t){var n=t[0];var i=t[1];var s=e("<table></table>");jQuery.each(n,function(t,n){s.append(e("<tr></tr>").append(e("<td></td>").text("0")).append(e("<td></td>").html(n["mod_date"])).append(e("<td></td>").html(n["name"])))});jQuery.each(i,jQuery.proxy(function(t,n){var r=this.options.invocationURL+"/download/"+n["full_path"]+"?session_id="+this.sessionId;s.append(e("<tr></tr>").append(e("<td></td>").text(n["size"])).append(e("<td></td>").html(n["mod_date"])).append(e("<td></td>").append(e("<a></a>").text(n["name"]).attr("href","#").bind("click",jQuery.proxy(function(e){e.preventDefault();this.open_file(n["full_path"])},this)))))},this));r.append(s);this.scroll()},this),function(e){var t=e.message.replace("\n","<br>\n");m.out_to_div(r,"<i>Error received:<br>"+e.code+"<br>"+t+"</i>")});return}var u=this.options.grammar.evaluate(n);if(u!=t){if(!u.fail&&u.execute){n=u.execute;if(u.explain){r.append(u.execute);return}}else if(u.parsed.length&&u.fail){r.append(e("<i></i>").html(u.error));return}}n=n.replace(/\\\n/g," ");n=n.replace(/\n/g," ");var g;if(this.data("processList")){g=this.data("processList").addProcess(n)}this.client.run_pipeline_async(this.sessionId,n,[],this.options.maxOutput,this.cwd,jQuery.proxy(function(t){if(this.data("processList")){this.data("processList").removeProcess(g)}if(t){var n=t[0];var i=t[1];this.refreshFileBrowser();if(n.length>0&&n[0].indexOf("	")>=0){var s=e("<table></table>");jQuery.each(n,jQuery.proxy(function(t,n){var r=n.split(/\t/);var i=e("<tr></tr>");jQuery.each(r,jQuery.proxy(function(t,n){i.append(e("<td></td>").html(n));if(t>0){i.children().last().css("padding-left","15px")}if(t<r.length-1){i.children().last().css("padding-right","15px")}},this));s.append(i)},this));r.append(s)}else{jQuery.each(n,jQuery.proxy(function(e,t){this.out_to_div(r,t,0)},this));if(i.length){jQuery.each(i,jQuery.proxy(function(t,n){this.out_to_div(r,e("<i></i>").html(n))},this))}else{this.out_to_div(r,e("<i></i>").html("Command completed."))}}}else{this.out_to_div(r,"Error running command.")}this.scroll()},this))}})})(jQuery);(function(e,t){e.kbWidget("kbaseIrisTutorial","kbaseWidget",{version:"1.0.0",options:{"default":"How to annotate a genome"},dispatch:{"How to annotate a genome":"http://www.prototypesite.net/iris-dev/annotate_genome.html","How to create an IRIS tutorial":"tutorial_tutorial.html","Constructing RAST2 in the IRIS Environment":"rast2.html"},list:function(){var e=[];for(key in this.dispatch){e.push(key)}return e.sort()},init:function(e){this._super(e);if(this.options.tutorial==t){this.options.tutorial=this.options.default}this.retrieveTutorial(this.options.tutorial);this.pages=[];this.currentPage=-1;return this},retrieveTutorial:function(n){var r=this.dispatch[n];this.pages=[];var i=t;e.ajax({async:true,dataType:"text",url:r,crossDomain:true,beforeSend:function(e){if(i){e.setRequestHeader("Authorization",i)}},success:e.proxy(function(t,n,r){var i=e("<div></div>").append(t);i=i.find("#tutorial");i.find("a").attr("target","_blank");var s=i.children();this.$title=e(s[0]);this.$summary=e(s[1]);var o=e(s[2]);this.pages.push({title:this.$title,content:this.$summary});e.each(o.children(),e.proxy(function(t,n){var r=e(n).find("h2");var i=e(n).find("div");e(n).find(".example").remove();r.remove();this.pages.push({title:r,content:e(n)})},this));this.renderAsHTML()},this),error:e.proxy(function(e,t,n){throw e},this),type:"GET"})},renderAsHTML:function(){this.$elem.empty();this.$elem.append(this.$title);this.$elem.append(this.$summary);e.each(this.pages,e.proxy(function(e,t){this.$elem.append(t.title);this.$elem.append(t.content)},this))},lastPage:function(){return this.pages.length-1},currentPage:function(){page=this.currentPage;if(this.currentPage<0){page=0}return this.pages[page]},goToPrevPage:function(){var e=this.currentPage-1;if(e<0){e=0}this.currentPage=e;return e},goToNextPage:function(){var e=this.currentPage+1;if(e>=this.pages.length){e=this.pages.length-1}this.currentPage=e;return e},contentForPage:function(t){return e("<div></div>").append(this.pages[this.currentPage].title).append(this.pages[this.currentPage].content)},contentForCurrentPage:function(){return this.contentForPage(this.currentPage)}})})(jQuery);(function(e,t){e.kbWidget("kbaseWorkspaceBrowser","kbaseFileBrowser",{version:"1.0.0",options:{name:"Workspace Browser",workspace:"chenrydemo",selectWorkspace:true},init:function(e){e.controlButtons=["deleteButton","viewButton","uploadButton","addButton"];this._super(e);if(this.options.wsClient!=t){this.wsClient=this.options.wsClient}if(this.options.workspace!=t){this.workspace=this.options.workspace}this.listWorkspaces();return this},token:function(){var e=this.$loginbox.get_kbase_cookie("token");return e},selected:function(e){var t=this.data("workspace-select").val();var n=this.data("workspace-select").find(":selected");if(n.data("perm")!="a"){this.deleteButton().addClass("disabled")}},refreshDirectory:function(e){this.listWorkspaces()},listDirectory:function(t,n){if(t==this.workspace){this.wsClient.list_workspace_objects_async({workspace:t,auth:this.token(),showDeletedObject:false},e.proxy(function(t){var r=[];this.meta={};e.each(t,e.proxy(function(e,t){r.push({name:t[0],path:t[0],type:t[3]==0?"file":"directory"});this.meta[t[0]]={name:t[0],version:t[3],type:t[1]}},this));this.displayPath("/",n,r.sort(this.sortByName))},this))}else if(this.workspace){var r=[];var i=this.meta[t].version;for(var s=i;s>=0;s--){r.push({name:"Revision "+s,path:t,type:"file",meta:{version:s}})}this.displayPath("path",n,r)}},viewButton:function(){var n=this._super();n.data("require","a");n.unbind("click");n.bind("click",e.proxy(function(e){e.preventDefault();if(!this.viewButton().hasClass("disabled")){var n=this.data("activeFile");if(n==t){n=this.data("activeDirectory")}this.openFile(n)}},this));return n},addButton:function(){var n=this._super();n.data("require","a");n.unbind("click");n.bind("click",e.proxy(function(e){e.preventDefault();if(!this.addButton().hasClass("disabled")){var n=this.data("activeFile");if(n==t){n=this.data("activeDirectory")}this.options.addFileCallback(n)}},this));return n},stringify:function(e,t){if(typeof t=="array"){t=t.join(", ")}else if(typeof t!="string"){t=this.stringify(t)}return e+" : "+t},fetchContent:function(n,r){var i=this.$elem.find(".active");var s={type:this.meta[n].type,workspace:this.workspace,id:n};if(meta=i.data("meta")){s.instance=meta.version}this.wsClient.get_object_async(s,e.proxy(function(e){try{if(typeof e.data=="string"){e=e.data}else{var i=JSON.stringify(e.data,t,2);e=i}}catch(s){this.dbg("FAILURE");this.dbg(s);e=e.data}this.openFile(n,e,r)},this),e.proxy(function(t){r.close();var n=e("<div></div>").kbaseErrorPrompt({title:"Fetch failed",message:t.message});n.openPrompt()},this))},deleteFileCallback:function(n,r){if(this.workspace==t){}else{this.wsClient.delete_object_async({type:"Unspecified",workspace:this.workspace,id:n,auth:this.token()},e.proxy(function(e){this.listDirectory(this.workspace,this.data("ul-nav"))},this),e.proxy(function(t){var n=e("<div></div>").kbaseErrorPrompt({title:"Deletion failed",message:t.message});n.openPrompt()},this))}},uploadFile:function(n,r,i,s){if(this.workspace==t){}else{this.wsClient.save_object_async({type:"Unspecified",workspace:this.workspace,id:n,data:r,auth:this.token()},e.proxy(function(e){if(this.options.processList){this.options.processList.removeProcess(s)}this.listDirectory(this.workspace,this.data("ul-nav"))},this),e.proxy(function(t){if(this.options.processList){this.options.processList.removeProcess(s)}var n=e("<div></div>").kbaseErrorPrompt({title:"Creation failed",message:t.message});n.openPrompt()},this))}},createWorkspace:function(){var t=e("<div></div>").kbasePrompt({title:"Create workspace",body:e("<p></p>").append("Create workspace ").append(" ").append(e("<input></input>").attr("type","text").attr("name","ws_name").attr("size","20")),controls:["cancelButton",{name:"Create workspace",type:"primary",callback:e.proxy(function(n,r){r.closePrompt();this.wsClient.create_workspace_async({workspace:t.dialogModal().find("input").val(),permission:"a",auth:this.token()},e.proxy(function(e){this.workspace=t.dialogModal().find("input").val();this.listWorkspaces()},this),e.proxy(function(t){var n=e("<div></div>").kbaseErrorPrompt({title:"Creation failed",message:t.message});n.openPrompt()},this))},this)}]});t.openPrompt()},deleteWorkspace:function(){var t=e("<div></div>").kbaseDeletePrompt({name:this.data("workspace-select").val(),callback:e.proxy(function(e,t){t.closePrompt();this.deleteWorkspaceCallback(this.data("workspace-select").val())},this)});t.openPrompt()},deleteWorkspaceCallback:function(t){this.wsClient.delete_workspace_async({workspace:t,auth:this.token()},e.proxy(function(e){this.listWorkspaces()},this),e.proxy(function(t){var n=e("<div></div>").kbaseErrorPrompt({title:"deletion failed",message:t.message});n.openPrompt()},this))},fileBrowserContainer:function(){var n=this._super("fileBrowserContainer");if(this.options.selectWorkspace){n.prepend(e("<div></div>").addClass("btn-toolbar").addClass("text-left").css("width","100%").append(e("<div></div>").addClass("input-append").attr("id","workspace-controls").append(e("<select></select>").css("height","22px").css("width","254px").attr("id","workspace-select").bind("change",e.proxy(function(e){e.preventDefault();e.stopPropagation();this.workspace=t;var n=this.data("workspace-select").val();var r=this.data("workspace-select").find(":selected");if(r.data("perm")!="a"){this.data("deleteWorkspace-button").addClass("disabled")}else{this.data("deleteWorkspace-button").removeClass("disabled")}if(n!="--- choose workspace ---"){this.workspace=n;this.listDirectory(n,this.data("ul-nav"))}},this))).append(e("<button></button>").addClass("btn btn-mini").attr("id","deleteWorkspace-button").append(e("<i></i>").addClass("icon-minus")).bind("click",e.proxy(function(e){e.preventDefault();e.stopPropagation();if(!this.data("deleteWorkspace-button").hasClass("disabled")){this.deleteWorkspace()}},this))).append(e("<button></button>").addClass("btn btn-mini").attr("id","createWorkspace-button").append(e("<i></i>").addClass("icon-plus")).bind("click",e.proxy(function(e){e.preventDefault();e.stopPropagation();this.createWorkspace()},this)))))}this._rewireIds(n,this);return n},listWorkspaces:function(){this.wsClient.list_workspaces_async({auth:this.token()},e.proxy(function(n){var r=[];e.each(n,e.proxy(function(e,t){r.push({name:t[0],perm:t[4]})},this));var i;r=r.sort(this.sortByName);if(this.data("workspace-select")!=t){this.data("workspace-select").empty();this.data("workspace-select").append(e("<option></option>").append(" --- choose workspace --- ").attr("val",""));e.each(r,e.proxy(function(t,n){var r=e("<option></option>").append(n.name).attr("value",n.name).data("perm",n.perm);if(n.name==this.workspace){i=n.perm}this.data("workspace-select").append(r)},this))}if(this.workspace){this.data("workspace-select").val(this.workspace);this.listDirectory(this.workspace,this.data("ul-nav"))}if(i!="a"){this.data("deleteWorkspace-button").addClass("disabled")}},this))}})})(jQuery)
