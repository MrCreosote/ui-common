function WSHandler(t){function e(t){return/^[nrwa]$/.test(t)}function i(t){for(var i=this,o=["id","owner","moddate","objects","user_permission","global_permission"],l=0;l<o.length;l++)this[o[l]]=t[l];this.isOwned=s?s.user_id===this.owner?!0:!1:"public"===this.owner?!0:!1,this.clone=function(t,n){var o=$.Deferred();e(n)||(n=null);var l={current_workspace:i.id,new_workspace:t};return n&&(l.default_permission=n),s&&(l.auth=s.token),r.clone_workspace(l).done(function(){a.getWorkspace(t).done(function(t){o.resolve(t)}).fail(function(t){o.reject(t)})}).fail(function(t){o.reject(t)}),o.promise()},this.getAllObjectsMeta=function(){var t=$.Deferred(),e={workspace:i.id};return s&&(e.auth=s.token),r.list_workspace_objects(e).done(function(e){for(var i=0;i<e.length;i++)e[i]=new n(e[i]);t.resolve(e)}).fail(function(){t.reject()}),t.promise()},this.hasObject=function(){},this.getObject=function(t,e){var i=$.Deferred(),n={workspace:this.id,type:t,id:e};return s&&(n.auth=s.token),r.get_object(n).done(function(t){i.resolve(t.data)}).fail(function(){i.reject()}),i.promise()},this.getObjectHistory=function(t,e){var i=$.Deferred(),n={workspace:this.id,type:t,id:e};s&&(n.auth=s.token);var a=r.object_history(n).fail(function(){i.reject()});return a},this.deleteObj=function(t,e){var n=$.Deferred(),a={workspace:this.id,type:t,id:e};return console.log(a),s&&(a.auth=s.token),r.delete_object(a).done(function(){n.resolve(i)}).fail(function(){n.reject()}),n.promise()},this.copyObject=function(t,e,n,a){var o=$.Deferred(),l={source_workspace:this.id,type:t,source_id:e,new_workspace:n,new_id:a};return console.log(l),s&&(l.auth=s.token),r.copy_object(l).done(function(){o.resolve(i)}).fail(function(){o.reject()}),o.promise()},this.moveObject=function(t,e,n,a){var o=$.Deferred(),l={source_workspace:this.id,type:t,source_id:e,new_workspace:n,new_id:a};return console.log(l),s&&(l.auth=s.token),r.move_object(l).done(function(){o.resolve(i)}).fail(function(){o.reject()}),o.promise()},this.saveObject=function(){},this.revertObject=function(){},(this.isOwned||"a"===this.user_permission)&&(this.getPermissions=function(){var t=$.Deferred(),e={workspace:i.id};return s&&(e.auth=s.token),r.get_workspacepermissions(e).done(function(e){delete e["default"],s?delete e[s.user_id]:delete e["public"],i.permissions=e,t.resolve(i)}).fail(function(){t.reject()}),t.promise()},this.setGlobalPermission=function(t){var n=$.Deferred();if(!e(t))return n.reject(),n.promise();var a={workspace:i.id,new_permission:t};return s&&(a.auth=s.token),r.set_global_workspace_permissions(a).done(function(){i.global_permission=t,n.resolve(i)}).fail(function(){n.reject()}),n.promise()},this.setWorkspacePermissions=function(t){var n=$.Deferred(),a={n:[],r:[],w:[],a:[]},o=!1;if($.each(t,function(t,i){e(i)||(o=!0)}),o)return n.reject(),n.promise();$.each(i.permissions,function(e){void 0===t[e]&&a.n.push(e)}),$.each(t,function(t,e){e!==i.permissions[t]&&a[e].push(t)});var l=[];return $.each(a,function(t,e){if(0!==e.length){var n={workspace:i.id,new_permission:t,users:e};s&&(n.auth=s.token);var a=r.set_workspace_permissions(n);l.push(a)}}),$.when.apply($,l).done(function(){i.permissions=t,n.resolve(i)}).fail(function(){n.reject()}),n.promise()},this.isOwned&&(this.delete=function(){var t=$.Deferred(),e={workspace:i.id};return s&&(e.auth=s.token),r.delete_workspace(e).done(function(){t.resolve(i)}).fail(function(){t.reject()}),t.promise()}))}function n(t){for(var e=["id","type","moddate","instance","command","lastmodifier","owner","workspace","ref","chsum","metadata"],i=0;i<e.length;i++)this[e[i]]=t[i]}console.log("here");var a=this,s=t&&t.user?t.user:null,o=t&&t.url?t.url:"http://kbase.us/services/workspace",r=new workspaceService(o);this.getWorkspace=function(t){var e=$.Deferred(),n={workspace:t};return s&&(n.auth=s.token),r.get_workspacemeta(n).done(function(t){var n=new i(t);e.resolve(n)}).fail(function(){e.reject()}),e.promise()},this.getWorkspaces=function(){def=$.Deferred();var t={};return s&&(t.auth=s.token),r.list_workspaces(t).done(function(t){for(var e=[],n=0;n<t.length;n++){var a=new i(t[n]);e.push(a)}def.resolve(e)}).fail(function(){def.reject()}),def.promise()},this.createWorkspace=function(t,n){var a=$.Deferred();e(n)||(n="n");var o={workspace:t,default_permission:n};return s&&(o.auth=s.token),r.create_workspace(o).done(function(t){var e=new i(t);e.permissions={},a.resolve(e)}).fail(function(t){a.reject(t)}),a.promise()}}!function(t){function e(t,e){function i(){}i.prototype=e.prototype;var n=new i;n.constructor=t,t.prototype=n}var i,n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},a=function(t){return"willChangeValueFor"+n(t)},s=function(t){return"didChangeValueFor"+n(t)},o=function(e){var i=t(e).prop("tagName").toLowerCase();return i.match(/^(input|select|textarea)$/)?"checkbox"==t(e).attr("type")?{setter:"checked",getter:"checked"}:{setter:"val",getter:"val"}:{setter:"text",getter:"text"}};makeBindingCallback=function(e,i,n,a,s){return t.proxy(function(i,n){i.preventDefault(),i.stopPropagation();var o=n.newValue;void 0!=a.transformedValue&&(o=a.transformedValue(o)),"checked"==s.setter?t(e).attr(s.setter,o):t(e)[s.setter](o)},t(e))},makeBindingBlurCallback=function(e,i,n,a,s){return t.proxy(function(o){if("keypress"!=o.type||13==o.which){o.preventDefault(),o.stopPropagation();var r;if(r="checked"==s.getter?this.is(":checked")?!0:!1:this[s.getter](),r!=this.data("kbase_bindingValue")){if(void 0!=a.validator){var l=a.validator(r);if(!l.success)return t(e).data("validationError.kbaseBinding",l.msg),this.popover({placement:"right",title:"Validation error",content:t.proxy(function(){return this.data("validationError.kbaseBinding")},t(e)),trigger:"manual",html:!0}),this.popover("show"),void 0;t(e).popover("hide"),l.newVal&&(r=l.newVal)}void 0!=a.reverseTransformedValue&&(r=a.reverseTransformedValue(r));var d=i.__attributes[n].setter;i[d](r)}}},t(e))},makeBindingFocusCallback=function(e,i,n){return t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.data("kbase_bindingValue",this[n.getter]())},t(e))},t.fn.kb_bind=function(e,i,n,a){if(this.length>1){var r=arguments;return t.each(this,function(e,i){t.fn.kb_bind.apply(t(i),r)}),this}void 0==a&&(a=o(this)),void 0==n&&(n={});var l=s(i);e.on(l,makeBindingCallback(this,e,i,n,a)),t(this).on("blur.kbaseBinding",makeBindingBlurCallback(this,e,i,n,a)),t(this).on("focus.kbaseBinding",makeBindingFocusCallback(this,n,a));var d=t(this).prop("tagName").toLowerCase();d.match(/^(input)$/)&&(t(this).on("keypress.kbaseBinding",makeBindingBlurCallback(this,e,i,n,a)),"checkbox"==t(this).attr("type")&&t(this).on("change.kbaseBinding",makeBindingBlurCallback(this,e,i,n,a)));var c=e.__attributes[i].getter,p=e[c]();return void 0!=n.transformedValue&&(p=n.transformedValue(p)),"checked"==a.setter?t(this).attr(a.setter,p):t(this)[a.setter](p),this},t.fn.kb_unbind=function(e,i,n,a,r){if(this.length>1){var l=arguments;return t.each(this,function(e,i){t.fn.kb_unbind.apply(t(i),l)}),this}void 0==r&&(r=o(this)),void 0==a&&(a={});var d=s(i);e.off(d,makeBindingCallback(this,e,i,a,r)),t(this).off("blur.kbaseBinding",makeBindingBlurCallback(this,e,i,a,r)),t(this).off("focus.kbaseBinding",makeBindingBlurCallback(this,a,r));var c=t(this).prop("tagName").toLowerCase();return c.match(/^(input)$/)&&(t(this).off("keypress.kbaseBinding",makeBindingEnterCallback(this,e,i,a,r)),"checkbox"==t(this).attr("type")&&t(this).off("change.kbaseBinding",makeBindingBlurCallback(this,e,i,a,r))),this};var r={};void 0===i&&(i=window.KBase={_functions:{getter:function(t){return function(){return this.valueForKey(t)}},setter:function(t){return function(e){return this.setValueForKey(t,e)}},getter_setter:function(t){return function(e){return 1==arguments.length?this.setValueForKey(t,e):this.valueForKey(t)}}}}),t.jqElem=function(e){var i="<"+e+">";return i.match(/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track)/)||(i+="</"+e+">"),t(i)},t.KBWidget=function(n){n=n||{};var a=n.name,s=n.parent;void 0==s&&(s="kbaseWidget");var o=n.asPlugin;void 0===o&&(o=!0);var l=function(e){return this.$elem=e,this.options=t.extend(!0,{},n.options,this.constructor.prototype.options),this};if(a){var d=a;d=d.replace(/^kbase/,""),d=d.charAt(0).toLowerCase()+d.slice(1),i[d]=function(e,i){var n=new l;return void 0==i&&(i=t.jqElem("div")),n.$elem=i,n.init(e),n._init=!0,n.trigger("initialized"),n},r[a]=l,void 0==n&&(n=s,s="kbaseWidget",void 0==n&&(n={}))}if(s){var c=r[s];if(void 0===c)throw new Error("Parent widget is not registered");e(l,c)}var p=t.extend(!0,{},n);l.prototype.__attributes={},void 0!=p._accessors&&(t.each(p._accessors,t.proxy(function(t,e){var n={name:e,setter:e,getter:e,type:"rw"};if("object"==typeof e){n.setter=e.name,n.getter=e.name;for(var a in e)n[a]=e[a]}l.prototype.__attributes[n.name]=n,n.setter==n.getter&&n.type.match(/rw/)?l.prototype[n.getter]=i._functions.getter_setter(n.name):(n.type.match(/w/)&&void 0!=n.setter&&(l.prototype[n.setter]=i._functions.setter(n.name)),n.type.match(/r/)&&void 0!=n.getter&&(l.prototype[n.getter]=i._functions.getter(n.name)))},this)),p._accessors=void 0);var u=t.extend(!0,{},l.prototype.__attributes,r[s].prototype.__attributes);l.prototype.__attributes=u;for(var h in p)l.prototype[h]=t.isFunction(p[h])?function(t,e){var i=function(){throw"No parent method defined! Play by the rules!"},n=function(){throw"No parent method defined! Play by the rules!"};if(s)var i=function(){return r[s].prototype[t].apply(this,arguments)},n=function(t){return r[s].prototype[t].apply(this,Array.prototype.slice.call(arguments,1))};return function(){var t=this._super,a=this._superMethod;this._super=i,this._superMethod=n;var s=e.apply(this,arguments);return this._super=t,this._superMethod=a,s}}(h,p[h]):p[h];if(s&&(l.prototype.options=t.extend(!0,{},r[s].prototype.options,l.prototype.options)),o){var f=function(e){if(this.length>1){var i=arguments;return t.each(this,function(e,n){t.fn[a].apply(t(n),i)}),this}return void 0==this.data(a)&&this.data(a,new l(this)),l.prototype[e]?l.prototype[e].apply(this.data(a),Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on "+a),this):($w=this.data(a),void 0===$w._init&&($w=l.prototype.init.apply($w,arguments)),$w._init=!0,$w.trigger("initialized"),$w)};f.name=a,t.fn[a]=f,t[a]=t.fn[a]}return this.on=function(t,e){return this.$elem.bind(t,e),this},this.emit=function(t,e){return this.$elem.trigger(t,e),this},this.off=function(t){return this.$elem.unbind(t),this},void 0!==a?(l.prototype[a]=function(){return t.fn[a].apply(this.$elem,arguments)},t.fn[a]):this},t.KBWidget.registry=function(){var t={};for(var e in r)"kbaseWidget"!==e&&(t[e]=r[e]);return t},t.KBWidget.resetRegistry=function(){for(var t in r)"kbaseWidget"!==t&&delete r[t];return this},t.KBWidget({name:"kbaseWidget",dbg:function(t){window.console&&console.log(t)},callAfterInit:function(t){var e=this,i=function(){var i=arguments.callee;e._init?t():setTimeout(i,10)};return i(),i},init:function(e){this._attributes={};var i=t.extend(!0,{},this.options);this.options=t.extend(!0,{},i,e);for(attribute in this.__attributes)void 0!=this.options[attribute]&&this.setValueForKey(attribute,this.options[attribute]);return this},alert:function(t){return void 0==t&&(t=this.data("msg")),this.data("msg",t),this},valueForKey:function(t){return this._attributes[t]},setValueForKey:function(t,e){var i=void 0,n=this.valueForKey(t);if(e!=n){var o=a(t);if(i={oldValue:n,newValue:e},this.trigger(o,i),this._attributes[t]=i.newValue,i.newValue!=n){var r=s(t);this.trigger(r,i)}}return this.valueForKey(t)},data:function(t,e){return void 0==this.options._storage&&(this.options._storage={}),2==arguments.length&&(this.options._storage[t]=e),void 0!=t?this.options._storage[t]:this.options._storage},_rewireIds:function(e,i){return void 0==i&&(i=e),e.attr("id")&&(i.data(e.attr("id"),e),e.removeAttr("id")),t.each(e.find("[id]"),function(){i.data(t(this).attr("id"),t(this)),t(this).removeAttr("id")}),e},sortCaseInsensitively:function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0},sortByKey:function(t,e){return e?function(e,i){return e[t].toLowerCase()<i[t].toLowerCase()?-1:e[t].toLowerCase()>i[t].toLowerCase()?1:0}:function(e,i){return e[t]<i[t]?-1:e[t]>i[t]?1:0}},trigger:function(){this.$elem.trigger.apply(this.$elem,arguments)},on:function(){this.$elem.on.apply(this.$elem,arguments)},off:function(){this.$elem.off.apply(this.$elem,arguments)},makeObserverCallback:function(e,i,n){return t.proxy(function(t,i){t.preventDefault(),t.stopPropagation(),n.call(this,t,e,i)},this)},observe:function(t,e,i){t.on(e,t,this.makeObserverCallback(t,e,i))},unobserve:function(t,e,i){t.off(e,t,this.makeObserverCallback(t,e,i))},kb_bind:function(t,e,i){var n=s(e);this.observe(t,n,i)},kb_unbind:function(t,e,i){var n=s(e);this.unobserve(t,n,i)},uuid:function(){for(var t="",e=0;32>e;e++)t+=Math.floor(16*Math.random()).toString(16).toUpperCase();return t}})}(jQuery),function(t){t.KBApplication=t.fn.KBApplication=function(){return this.constructor=t.KBWidget.constructor,this}}(jQuery),function(t,e){t.KBWidget({name:"kbaseLogin",version:"1.0.0",options:{style:"text",loginURL:"http://kbase.us/services/authorization/Sessions/Login",possibleFields:["verified","name","opt_in","kbase_sessionid","token","groups","user_id","email","system_admin"],fields:["name","kbase_sessionid","user_id","token"]},get_kbase_cookie:function(t){var i=sessionStorage.getItem("kbase_session");return i=i!=e?JSON.parse(i):{},t==e?i:i[t]},sessionId:function(){return this.get_kbase_cookie("kbase_sessionid")},token:function(){return this.get_kbase_cookie("token")},init:function(e){this._super(e);var i=this.get_kbase_cookie();this.$elem.empty();var n="_"+this.options.style+"Style";return this.ui=this[n](),this.ui&&this.$elem.append(this.ui),i.user_id&&(this.registerLogin&&this.registerLogin(i),this.options.prior_login_callback&&this.options.prior_login_callback.call(this,i),this.data("_session",i),this.trigger("loggedIn",this.get_kbase_cookie())),t(document).on("loggedInQuery.kbase",t.proxy(function(t,e){var i=this.get_kbase_cookie();e&&e(i)},this)),t(document).on("promptForLogin.kbase",t.proxy(function(t,e){e.user_id&&this.data("passed_user_id",e.user_id),this.openDialog()},this)),t(document).on("logout.kbase",t.proxy(function(t,e){this.logout(e)},this)),this},registerLoginFunc:function(){return this.registerLogin},specificLogoutFunc:function(){return this.specificLogout},populateLoginInfo:function(t){t.success?(this.data("_session",t),this._error=e):(this.data("_session",{}),this._error=t.message)},session:function(t,i){this.data("_session")==e&&this.data("_session",{});var n=this.data("_session");return 2==arguments.length&&(n[t]=i),arguments.length>0?n[t]:n},error:function(t){return t&&(this._error=t),this._error},openDialog:function(){if(this.data("loginDialog")){var i=this.data("loginDialog");t("form",i.dialogModal()).get(0).reset(),i.dialogModal().data("user_id").val(this.session("user_id")||this.data("passed_user_id")||this.options.user_id),delete this.options.user_id,this.session("user_id",e),i.dialogModal().trigger("clearMessages"),this.data("loginDialog").openPrompt()}},_textStyle:function(){this._createLoginDialog(),this.$elem.css("padding","9px 15px 7px 10px");var e=t("<span></span>").append(t("<a></a>").attr("id","loginlink").attr("href","#").text("Sign In").bind("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.openDialog()},this))).append(t("<div></div>").addClass("btn-group").attr("id","userdisplay").css("display","none").append(t("<button></button>").addClass("btn btn-default").addClass("btn-xs").addClass("dropdown-toggle").append(t("<span></span>").addClass("glyphicon glyphicon-user")).append(t("<span></span>").addClass("caret")).bind("click",function(e){e.preventDefault(),e.stopPropagation(),t(this).next().toggle()})).append(t("<ul></ul>").addClass("dropdown-menu").addClass("pull-right").css("padding","3px").attr("id","login-dropdown-menu").append(t("<li></li>").css("border-bottom","1px solid lightgray").css("white-space","nowrap").append(t.jqElem("div").css("text-align","right").append(t("<a></a>").attr("id","loggedinuser_id").css("font-weight","bold").attr("href","https://gologin.kbase.us/account/UpdateProfile").attr("target","_blank").css("padding-right","0px").css("padding-left","0px")))).append(t("<li></li>").addClass("pull-right").append(t("<span></span>").append(t("<a></a>").css("padding-right","0px").css("padding-left","0px").append("Sign out")).bind("click",t.proxy(function(t){t.stopPropagation(),t.preventDefault(),this.data("login-dropdown-menu").hide(),this.logout()},this))))));return this._rewireIds(e,this),this.registerLogin=function(t){t.success?(this.data("loginlink").hide(),this.data("loggedinuser_id").text(t.name),this.data("userdisplay").show(),this.data("loginDialog").closePrompt()):this.data("loginDialog").dialogModal().trigger("error",t.message)},this.specificLogout=function(){this.data("userdisplay").hide(),this.data("loginlink").show()},e},_hiddenStyle:function(){return this._createLoginDialog(),this.registerLogin=function(t){t.success?this.data("loginDialog").closePrompt():this.data("loginDialog").dialogModal().trigger("error",t.message)},e},_slimStyle:function(){this.data("loginDialog",e);var i=t("<span></span>").addClass("form-inline").append(t("<span></span>").attr("id","entrance").append(t("<span></span>").addClass("input-group").append(t("<span></span>").addClass("input-group-addon").append("username: ").bind("click",function(){t(this).next().focus()})).append(t("<input>").attr("type","text").attr("name","user_id").attr("id","user_id").attr("size","20").val(this.options.user_id)).append(t("<span></span>").addClass("input-group-addon").append(" password: ").bind("click",function(){t(this).next().focus()})).append(t("<input>").attr("type","password").attr("name","password").attr("id","password").attr("size","20")).append(t("<button></button>").attr("id","loginbutton").addClass("btn btn-primary").append(t("<i></i>").attr("id","loginicon").addClass("icon-lock"))))).append(t("<span></span>").attr("id","userdisplay").attr("style","display : none;").addClass("input-group").append(t("<span></span>").addClass("input-group-addon").append("Logged in as ").append(t("<span></span>").attr("id","loggedinuser_id").attr("style","font-weight : bold").append("user_id\n"))).append(t("<button></button>").addClass("btn btn-default").attr("id","logoutbutton").append(t("<i></i>").attr("id","logouticon").addClass("icon-signout"))));return this._rewireIds(i,this),this.data("password").keypress(t.proxy(function(t){13==t.keyCode&&(this.data("loginbutton").trigger("click"),t.stopPropagation())},this)),this.registerLogin=function(e){if(this.data("loginicon").removeClass().addClass("icon-lock"),e.success)this.data("entrance").hide(),this.data("user_id").val(""),this.data("password").val(""),this.data("loggedinuser_id").text(e.name),this.data("userdisplay").show();else{var i=t("<div></div>").kbasePrompt({title:"Login failed",body:t("<div></div>").attr("class","alert alert-error").append(t("<div></div>").append(t("<div></div>").addClass("pull-left").append(t("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(t("<div></div>").append(t("<strong></strong>").append(e.message)))),controls:["okayButton"]});i.openPrompt()}},this.specificLogout=function(){this.data("userdisplay").hide(),this.data("entrance").show()},this.data("loginbutton").bind("click",t.proxy(function(){this.data("loginicon").removeClass().addClass("icon-refresh"),this.login(this.data("user_id").val(),this.data("password").val(),function(t){this.registerLogin(t),this.options.login_callback&&this.options.login_callback.call(this,t)})},this)),this.data("logoutbutton").bind("click",t.proxy(function(){this.logout(),this.data("user_id").focus()},this)),i},_microStyle:function(){var e=t("<span></span>").append(t("<button></button>").addClass("btn btn-primary").attr("id","loginbutton").append(t("<i></i>").attr("id","loginicon").addClass("icon-lock")));return this._rewireIds(e,this),this._createLoginDialog(),this.data("loginbutton").bind("click",t.proxy(function(){this.openDialog()},this)),this.registerLogin=function(e){e.success?(this.data("loginDialog").dialogModal().trigger("clearMessages"),this.data("loginDialog").closePrompt(),this.data("loginbutton").tooltip({title:"Logged in as "+e.name}),this.data("loginicon").removeClass().addClass("icon-user"),this.data("loginbutton").bind("click",t.proxy(function(){this.logout()},this))):this.data("loginDialog").dialogModal().trigger("error",e.message)},this.specificLogout=function(){this.data("loginbutton").tooltip("destroy"),this.data("loginicon").removeClass().addClass("icon-lock")},e},_buttonStyle:function(){var e=t("<div></div>").attr("style","width : 250px; border : 1px solid gray").append(t("<h4></h4>").attr("style","padding : 5px; margin-top : 0px; background-color : lightgray ").addClass("text-center").append("User\n")).append(t("<div></div>").attr("id","entrance").append(t("<p></p>").attr("style","text-align : center").append(t("<button></button>").attr("id","loginbutton").append("Login").addClass("btn btn-primary")))).append(t("<div></div>").attr("id","userdisplay").attr("style","display : none;").append(t("<p></p>").attr("style","text-align : center").append("Logged in as ").append(t("<span></span>").attr("id","loggedinuser_id").attr("style","font-weight : bold").append("user_id\n")).append(t("<button></button>").attr("id","logoutbutton").append("Logout\n").addClass("btn btn-default"))));return this._rewireIds(e,this),this._createLoginDialog(),this.data("loginbutton").bind("click",t.proxy(function(){this.openDialog()},this)),this.data("logoutbutton").bind("click",t.proxy(this.logout,this)),this.registerLogin=function(t){t.success?(this.data("loginDialog").dialogModal().trigger("clearMessages"),this.data("entrance").hide(),this.data("loggedinuser_id").text(t.name),this.data("userdisplay").show(),this.data("loginDialog").closePrompt()):this.data("loginDialog").dialogModal().trigger("error",t.message)},this.specificLogout=function(){this.data("userdisplay").hide(),this.data("entrance").show()},e},_createLoginDialog:function(){this.$elem;var e=t("<div></div").kbasePrompt({title:"Login to KBase",controls:["cancelButton",{name:"Login",type:"primary",id:"loginbutton",callback:t.proxy(function(){var t=this.data("loginDialog").dialogModal().data("user_id").val(),e=this.data("loginDialog").dialogModal().data("password").val();this.data("loginDialog").dialogModal().trigger("message",t),this.login(t,e,function(t){this.registerLogin&&this.registerLogin(t),this.options.login_callback&&this.options.login_callback.call(this,t)})},this)}],body:t("<p></p>").append(t("<form></form>").attr("name","form").attr("id","form").addClass("form-horizontal").append(t("<fieldset></fieldset>").append(t("<div></div>").attr("class","alert alert-error").attr("id","error").attr("style","display : none").append(t("<div></div>").append(t("<div></div>").addClass("pull-left").append(t("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(t("<div></div>").append(t("<strong></strong>").append("Error:\n")).append(t("<span></span>").attr("id","errormsg"))))).append(t("<div></div>").attr("class","alert alert-success").attr("id","pending").attr("style","display : none").append(t("<div></div>").append(t("<div></div>").append(t("<strong></strong>").append("Logging in as:\n")).append(t("<span></span>").attr("id","pendinguser"))))).append(t("<div></div>").attr("class","form-group").append(t("<label></label>").addClass("control-label").addClass("col-lg-2").attr("for","user_id").css("margin-right","10px").append("Username:\n")).append(t.jqElem("div").addClass("col-lg-9").append(t("<input>").addClass("form-control").attr("type","text").attr("name","user_id").attr("id","user_id").attr("size","20")))).append(t("<div></div>").attr("class","form-group").append(t("<label></label>").addClass("control-label").addClass("col-lg-2").attr("for","password").css("margin-right","10px").append("Password:\n")).append(t.jqElem("div").addClass("col-lg-9").append(t("<input>").addClass("form-control").attr("type","password").attr("name","password").attr("id","password").attr("size","20")))))),footer:t("<span></span").append(t("<a></a>").attr("href","https://gologin.kbase.us/ResetPassword").attr("target","_blank").text("Forgot password?")).append("&nbsp;|&nbsp;").append(t("<a></a>").attr("href"," https://gologin.kbase.us/OAuth?response_type=code&step=SignUp&redirect_uri="+encodeURIComponent(location.href)).attr("target","_blank").text("Sign up"))});return this._rewireIds(e.dialogModal(),e.dialogModal()),this.data("loginDialog",e),e.dialogModal().bind("error",function(e,i){t(this).trigger("clearMessages"),t(this).data("error").show(),t(this).data("errormsg").html(i)}),e.dialogModal().bind("message",function(e,i){t(this).trigger("clearMessages"),t(this).data("pending").show(),t(this).data("pendinguser").html(i)}),e.dialogModal().bind("clearMessages",function(){t(this).data("error").hide(),t(this).data("pending").hide()}),e.dialogModal().on("shown.bs.modal",function(){0==t(this).data("user_id").val().length?t(this).data("user_id").focus():t(this).data("password").focus()}),e},login:function(i,n,a){var s={user_id:i,status:1};0==i.length?(s.message="Cannot login w/o user_id",s.status=0,a.call(this,s)):n==e||0==n.length?(s.message="Cannot login w/o password",s.status=0,a!=e&&a.call(this,s)):(s.password=n,s.cookie=1,s.fields=this.options.fields.join(","),t.support.cors=!0,t.ajax({type:"POST",url:this.options.loginURL,data:s,dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},success:t.proxy(function(e){if(e.kbase_sessionid){t.cookie&&t.cookie("kbase_session","unEQUALSSIGN"+e.user_id+"PIPESIGN"+"kbase_sessionidEQUALSSIGN"+e.kbase_sessionid+"PIPESIGN"+"token_idEQUALSSIGN"+e.kbase_sessionid);for(var i={success:1},n=this.options.fields,s=0;s<n.length;s++){var o=e[n[s]];i[n[s]]=o}var r=JSON.stringify(i);sessionStorage.setItem("kbase_session",r),this.populateLoginInfo(i),this.trigger("loggedIn",this.get_kbase_cookie()),a.call(this,i)}else sessionStorage.removeItem("kbase_session"),this.populateLoginInfo({}),a.call(this,{status:0,message:e.error_msg}),this.trigger("loggedInFailure",{status:0,message:e.error_msg})},this),error:t.proxy(function(t,e){"error"==e&&(e="Error connecting to KBase login server"),this.populateLoginInfo({}),a.call(this,{status:0,message:e})},this),xhrFields:{withCredentials:!0},beforeSend:function(t){t.withCredentials=!0}}))},logout:function(t){t==e&&(t=!0);var i=this.get_kbase_cookie("kbase_sessionid");i!=e&&(sessionStorage.removeItem("kbase_session"),this.specificLogout&&this.specificLogout(),this.populateLoginInfo({}),this.data("loginDialog")!=e&&t&&this.openDialog(),this.trigger("loggedOut"),this.options.logout_callback&&this.options.logout_callback.call(this))}})}(jQuery),function(t){t.KBWidget({name:"kbaseModal",version:"1.0.0",options:{},init:function(e){this._super(e);var i=this,n=e.title,a=e.subText;e.rightLabel;var s=e.body,o=e.buttons,r=t('<div class="modal">                              <div class="modal-dialog">                                  <div class="modal-content">                                    <div class="modal-header">                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                                        <h3 class="modal-title"></h3>                                        <span class="modal-subtext"></span>                                    </div>                                    <div class="modal-body"></div>                                    <div class="modal-footer">                                      <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>                                    </div>                                  </div>                              </div>                           </div>'),l=r.find(".modal-header"),d=r.find(".modal-title"),c=r.find(".modal-subtext"),p=r.find(".modal-body"),u=r.find(".modal-footer");return n&&d.append(n),a&&c.append(a),s&&p.append(s),o&&this.buttons(o),i.$elem.append(r),this.header=function(t){return t&&l.html(t),l},this.title=function(t){return t&&d.html(t),d},this.body=function(t){return t&&p.html(t),p},this.footer=function(t){return t&&u.html(t),u},this.buttons=function(e){u.html("");for(var i in e){var n=e[i];if(n.dismiss)var a=t('<a class="btn">'+n.text+"</a>");else var a=t('<a class="btn" data-dismiss="modal">'+n.text+"</a>");"primary"==n.color?a.addClass("btn-primary"):a.addClass("btn-default"),u.append(a)}},this.show=function(){r.modal("show")},this.hide=function(){r.modal("hide")},this}})}(jQuery),function(t){t.KBWidget({name:"kbasePanel",version:"1.0.0",options:{},init:function(e){this._super(e);var i=this,n=e.title?e.title:"Default Panel Heading",a=e.subText,s=e.rightLabel,o=e.body,r=t('<div class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title"></h4>                                </div>                                <div class="panel-body"></div>                           </div>'),l=r.find(".panel-heading"),d=r.find(".panel-title"),c=r.find(".panel-body");return n&&d.html(n),o&&c.html(o),a&&l.append(a),s&&l.append('<span class="label label-primary pull-right">'+s+"</span><br>"),this.header=function(t){return t&&l.html(t),l},this.title=function(t){return t&&d.html(t),d},this.body=function(t){return t&&c.html(t),c},this.loading=function(){c.append('<p class="muted ajax-loader">                 <img src="assets/img/ajax-loader.gif"> loading...</p>')},this.rmLoading=function(){c.find(".ajax-loader").remove()},i.$elem.append(r),this}})}(jQuery),function(t,e){t.KBWidget({name:"kbasePrompt",version:"1.0.0",options:{controls:["cancelButton","okayButton"],modalClass:"fade"},init:function(t){return this._super(t),this},openPrompt:function(){this.dialogModal().modal({keyboard:!0})},closePrompt:function(){this.dialogModal().modal("hide")},cancelButton:function(){return{name:"Cancel",callback:function(t,e){e.closePrompt()}}},okayButton:function(){return{name:"Okay",type:"primary",callback:function(t,e){e.closePrompt()}}},dialogModal:function(){if(this.data("dialogModal")!=e)return this.data("dialogModal");var i=t("<div></div>").attr("class","modal "+this.options.modalClass).attr("tabindex","-1").append(t.jqElem("div").addClass("modal-dialog").append(t.jqElem("div").addClass("modal-content").append(t("<div></div>").attr("class","modal-header").append(t("<button></button>").attr("type","button").attr("class","close").attr("data-dismiss","modal").attr("aria-hidden","true").append("x\n")).append(t("<h3></h3>").addClass("modal-title").attr("id","title"))).append(t("<div></div>").attr("class","modal-body").attr("id","body")).append(t("<div></div>").attr("class","modal-footer").append(t("<div></div>").addClass("row").addClass("form-horizontal").append(t("<div></div>").addClass("col-md-6").addClass("text-left").attr("id","footer")).append(t("<div></div>").addClass("col-md-6").attr("id","controls").css("white-space","nowrap"))))));i.unbind("keypress"),i.keypress(function(e){13==e.keyCode&&(e.stopPropagation(),e.preventDefault(),t("a:last",i).trigger("click"))}),this._rewireIds(i,i),this.options.title&&i.data("title").append(this.options.title),this.options.body&&i.data("body").append(this.options.body),this.options.footer&&i.data("footer").append(this.options.footer);var n=this;t.each(this.options.controls,function(e,a){"string"==typeof a&&(a=n[a]());var s="btn btn-default";a.type&&(s=s+" btn-"+a.type);var o=t("<a></a>").attr("href","#").attr("class",s).append(a.name).bind("click",function(t){t.preventDefault(),t.stopPropagation(),a.callback.call(this,t,n)});a.id&&o.attr("id",a.id),i.data("controls").append(o)
}),this._rewireIds(i,i),this.data("dialogModal",i);var a=e,s=!1;return i.on("shown.bs.modal",t.proxy(function(){t.each(i.find("input[type=text],input[type=password],textarea"),function(i,n){return a==e&&(a=t(n)),t(n).is("input")&&t(n).val()==e?(t(n).focus(),s=!0,void 0):t(n).is("textarea")&&0==t(n).text().length?(t(n).focus(),s=!0,void 0):void 0}),s||a==e||a.focus()},this)),i}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseTable",version:"1.0.0",options:{sortable:!1,striped:!0,hover:!0,bordered:!0},init:function(e){return this._super(e),this.appendUI(t(this.$elem),this.options.structure),this},appendUI:function(i,n){n=n||{},i.empty();var a=t("<table></table>").attr("id","table").addClass("table");if(this.options.tblOptions&&this.addOptions(a,this.options.tblOptions),this.options.striped&&a.addClass("table-striped"),this.options.hover&&a.addClass("table-hover"),this.options.bordered&&a.addClass("table-bordered"),this.options.caption&&a.append(t("<caption></caption>").append(this.options.caption)),n.header){var s=t("<thead></thead>").attr("id","thead"),o=t("<tr></tr>").attr("id","headerRow");t.each(n.header,t.proxy(function(i,n){var a=this.nameOfHeader(n);new Date;var s=t("<th></th>").append(a);if("string"!=typeof n&&(this.addOptions(s,n),n.sortable)){var r=a+"-sortButton",l=t("<i></i>").addClass("icon-sort"),d=t("<button></button>").addClass("btn btn-default btn-xs").attr("id",r).css("display","none").css("float","right").append(l).data("shouldHide",!0);d.bind("click",t.proxy(function(){var t=this.data("lastSort");t!=e&&t.get(0)!=d.get(0)&&(t.children(":first").removeClass("icon-sort-up"),t.children(":first").removeClass("icon-sort-down"),t.children(":first").addClass("icon-sort"),t.data("shouldHide",!0),t.css("display","none")),l.hasClass("icon-sort")?(l.removeClass("icon-sort"),l.addClass("icon-sort-up"),d.data("shouldHide",!1),this.sortAndLayoutOn(a,1)):l.hasClass("icon-sort-up")?(l.removeClass("icon-sort-up"),l.addClass("icon-sort-down"),d.data("shouldHide",!1),this.sortAndLayoutOn(a,-1)):l.hasClass("icon-sort-down")&&(l.removeClass("icon-sort-down"),l.addClass("icon-sort"),d.data("shouldHide",!0),this.sortAndLayoutOn(e)),this.data("lastSort",d)},this)),s.append(d),s.bind("mouseover",t.proxy(function(){d.css("display","inline")},this)),s.bind("mouseout",t.proxy(function(){d.data("shouldHide")&&d.css("display","none")},this))}o.append(s)},this)),s.append(o),a.append(s)}if(n.rows){var r=this.data("tbody",t("<tbody></tbody>"));this.layoutRows(n.rows,n.header),a.append(r)}if(n.footer){for(var l=t("<tfoot></tfoot>").attr("id","tfoot"),d=0;d<n.footer.length;d++)l.append(t("<td></td>").append(n.footer[d]));a.append(l)}return this._rewireIds(a,this),i.append(a),i},sortAndLayoutOn:function(t,i){var n=this.options.structure.rows;if(t!=e){var a=this.nameOfHeader(t);n=this.options.structure.rows.slice().sort(function(t,e){var n=t[a],s=e[a];return n="string"==typeof n?n.toLowerCase():n,s="string"==typeof s?s.toLowerCase():s,s>n?0-i:n>s?i:0})}this.layoutRows(n,this.options.structure.header)},nameOfHeader:function(t){return"string"==typeof t?t:t.value},layoutRows:function(t,e){this.data("tbody").empty();for(var i=0;i<t.length;i++)this.data("tbody").append(this.createRow(t[i],e))},addOptions:function(i,n){if(n.style!=e&&i.attr("style",n.style),n.class!=e){var a="string"==typeof n.class?[n.class]:n.class;t.each(a,t.proxy(function(t,e){i.addClass(e)},this))}var s=["mouseover","mouseout","click"];t.each(s,t.proxy(function(t,a){n[a]!=e&&i.bind(a,n[a])},this)),n.colspan&&i.attr("colspan",n.colspan),n.rowspan&&i.attr("rowspan",n.rowspan)},createRow:function(i,n){var a=t("<tr></tr>");return t.isArray(i)?t.each(i,t.proxy(function(i,n){var s="string"==typeof n||"number"==typeof n?n:n.value,o=t.jqElem("td").append(s);"string"!=typeof n&&"number"!=typeof n&&this.addOptions(o,n),s!=e&&a.append(o)},this)):t.each(n,t.proxy(function(n,s){var o=this.nameOfHeader(s),r=t("<td></td>");if(i[o]!=e){var l="string"==typeof i[o]?i[o]:i[o].value;r.append(l),"string"!=typeof i[o]&&this.addOptions(r,i[o])}l!=e&&a.append(r)},this)),a},deletePrompt:function(e){var i=t("<div></div>").kbaseDeletePrompt({name:e,callback:this.deleteRowCallback(e)});i.openPrompt()},deleteRowCallback:function(){},shouldDeleteRow:function(){return 1}})}(jQuery),function(e,i){e.KBWidget({name:"kbaseTabs",version:"1.0.0",_accessors:["tabsHeight"],options:{tabPosition:"top",canDelete:!1,borderColor:"lightgray"},init:function(t){return this._super(t),this.data("tabs",{}),this.data("nav",{}),this.appendUI(e(this.$elem)),this},appendUI:function(t,n){n==i&&(n=this.options.tabs);var a=e("<div></div>").addClass("tabbable"),s=e("<div></div>").addClass("tab-content").attr("id","tabs-content").css("height",this.tabsHeight()),o=e("<ul></ul>").addClass("nav nav-tabs").attr("id","tabs-nav");a.append(o).append(s),this._rewireIds(a,this),t.append(a),n&&e.each(n,e.proxy(function(t,e){this.addTab(e)},this))},addTab:function(n){n.canDelete==i&&(n.canDelete=this.options.canDelete);var a=e("<div></div>").addClass("tab-pane fade").append(n.content);this.options.border&&(a.css("border","solid "+this.options.borderColor),a.css("border-width","0px 1px 0px 1px"),a.css("padding","3px"));var s=this,o=e("<li></li>").css("white-space","nowrap").append(e("<a></a>").attr("href","#").text(n.tab).attr("data-tab",n.tab).bind("click",function(t){t.preventDefault(),t.stopPropagation();var i=s.data("tabs-nav").find(".active:last a")[0];e.fn.tab.Constructor.prototype.activate.call(e(this),e(this).parent("li"),s.data("tabs-nav")),e.fn.tab.Constructor.prototype.activate.call(e(this),a,a.parent(),function(){e(this).trigger({type:"shown",relatedTarget:i})})}).append(e("<button></button>").addClass("btn btn-default btn-xs").append(e("<i></i>").addClass(this.closeIcon())).css("padding","0px").css("width","22px").css("height","22px").css("margin-left","10px").attr("title",this.deleteTabToolTip(n.tab)).tooltip().bind("click",e.proxy(function(t){t.preventDefault(),t.stopPropagation(),n.deleteCallback!=i?n.deleteCallback(n.tab):this.deletePrompt(n.tab)},this))));n.canDelete||o.find("button").remove(),this.data("tabs")[n.tab]=a,this.data("nav")[n.tab]=o,this.data("tabs-content").append(a),this.data("tabs-nav").append(o);var r=0;for(t in this.data("tabs"))r++;(n.show||1==r)&&this.showTab(n.tab)},closeIcon:function(){return"icon-remove"},deleteTabToolTip:function(t){return"Remove "+t},hasTab:function(t){return this.data("tabs")[t]},showTab:function(t){this.shouldShowTab(t)&&this.data("nav")[t].find("a").trigger("click")},removeTab:function(t){var e=this.data("tabs")[t],n=this.data("nav")[t];n.hasClass("active")&&(n.next("li").length?n.next().find("a").trigger("click"):n.prev("li").find("a").trigger("click")),e.remove(),n.remove(),this.data("tabs")[t]=i,this.data("nav")[t]=i},shouldShowTab:function(){return 1},deletePrompt:function(t){var i=e("<div></div>").kbaseDeletePrompt({name:t,callback:this.deleteTabCallback(t)});i.openPrompt()},deleteTabCallback:function(t){return e.proxy(function(e,n){n!=i&&n.closePrompt(),this.shouldDeleteTab(t)&&this.removeTab(t)},this)},shouldDeleteTab:function(){return 1},activeTab:function(){var t=this.data("tabs-nav").find(".active:last a")[0];return e(t).attr("data-tab")}})}(jQuery),function(t){function e(e){for(var i={nodes:[],edges:[]},n={},a=0;a<e.nodes.length;a++){var s=t.extend({},e.nodes[a]);n[s.id]=a,s.kbid=s.id,s.group=s.type,s.id=a,i.nodes.push(s)}for(var a=0;a<e.edges.length;a++){var o=t.extend({},e.edges[a]);o.source=parseInt(n[o.nodeId1]),o.target=parseInt(n[o.nodeId2]),o.weight=1,i.edges.push(o)}for(var r in e)i.hasOwnProperty(r)||(i[r]=e[r]);return i}var i="http://140.221.84.142/objects/coexpr_test/Networks",n="http://kbase.us/services/workspace_service/";t.KBWidget({name:"ForceDirectedNetwork",version:"0.1.0",options:{minHeight:"300px"},init:function(t){return this._super(t),this.render(),this},render:function(){var a=this,s=function(){return 1};if(a.options.minHeight&&a.$elem.css("min-height",a.options.minHeight),a.options.token){var o=/^(\w+)\.(.+)/,r=o.exec(a.options.workspaceID);if(null===r||!r[1]||!r[2])return a.trigger("error",["Cannot parse workspace ID "+a.options.workspaceID]),a;var l=new workspaceService(n);s=l.get_object({auth:a.options.token,workspace:r[1],id:r[2],type:"Networks"})}else s=t.ajax({dataType:"json",url:i+"/"+encodeURIComponent(a.options.workspaceID)+".json"});return t.when(s).done(function(t){var i=e(t.data);KBVis.require(["renderers/network","util/viewport"],function(t,e){var n=new e({parent:a.$elem,title:"Network",maximize:!0});n.css("min-height","700px");var s=new t({element:n,dock:!1,nodeLabel:{type:"GENE"}});s.setData(i),s.render()})}),a}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseAccordion",version:"1.0.0",options:{fontSize:"100%"},init:function(e){return this._super(e),this.options.client&&(this.client=this.options.client),this.appendUI(t(this.$elem)),this},appendUI:function(i,n){n==e&&(n=this.options.elements);var a=this.options.fontSize,s=t("<div></div>").addClass("accordion").css("font-size",a).attr("id","accordion");t.each(n,t.proxy(function(i,n){s.append(t("<div></div>").addClass("panel panel-default").css("margin-bottom","2px").append(t("<div></div>").addClass("panel-heading").css("padding","0px").append(t("<i></i>").css("margin-right","5px").css("margin-left","3px").addClass("icon-chevron-right").addClass("pull-left").css("height","22px").css("line-height","22px").css("color","gray")).append(t("<a></a>").css("padding","0px").attr("href","#").attr("title",n.title).css("height","22px").css("line-height","22px").append(n.title)).bind("click",function(i){i.preventDefault();var n=t(this).closest(".panel").find(".in"),a=t(this).next();if(n!=e){n.collapse("hide");var s=n.parent().first().find("i");s.removeClass("icon-chevron-down"),s.addClass("icon-chevron-right")}if(a.get(0)!=n.get(0)){a.collapse("show");var s=t(this).parent().find("i");s.removeClass("icon-chevron-right"),s.addClass("icon-chevron-down")}})).append(t("<div></div>").addClass("panel-body collapse").css("padding-top","9px").css("padding-bottom","9px").append(n.body)))},this)),this._rewireIds(s,this),i.append(s)}})}(jQuery),function(t){t.KBWidget({name:"kbaseBox",version:"1.0.0",options:{canCollapse:!0,canCollapseOnDoubleClick:!1,controls:[],bannerColor:"lightgray",boxColor:"lightgray"},init:function(e){return this._super(e),this.options.canCollapse&&this.options.controls.push({icon:"icon-caret-up","icon-alt":"icon-caret-down",tooltip:{title:"collapse / expand",placement:"bottom"},callback:t.proxy(function(){this.data("content").slideToggle()},this)}),this.appendUI(t(this.$elem)),this},setBannerColor:function(t){this.data("banner").css("background-color",t)},startThinking:function(){this.data("banner").addClass("progress progress-striped active")},stopThinking:function(){this.data("banner").removeClass("progress progress-striped active")},appendUI:function(e){this.options.canCollapse;var i=t("<div></div>").append(t("<div></div>").css("text-align","left").css("font-size","70%").css("color","gray").append(this.options.precontent)).append(t("<div></div>").css("border","1px solid "+this.options.boxColor).css("padding","2px").append(t("<div></div>").attr("id","banner").css("width","100%").css("height","24px").css("margin-bottom","0px").css("box-shadow","none").css("background-color",this.options.bannerColor).css("border-radius","0px").append(t("<h5></h5>").attr("id","banner-text").addClass("text-left").css("text-align","left").css("text-shadow","none").css("color","black").css("font-size","14px").addClass("bar").css("padding","2px").css("margin","0px").css("position","relative").css("width","100%").bind("dblclick",function(e){e.preventDefault(),e.stopPropagation(),canCollapseOnDoubleClick&&t(this).parent().parent().children().last().collapse("toggle")}).append(t("<span></span>").attr("id","title")))).append(t("<div></div>").attr("id","content"))).append(t("<div></div>").css("text-align","right").css("font-size","70%").css("color","gray").append(this.options.postcontent));return this._rewireIds(i,this),this.options.controls&&this.data("banner-text").kbaseButtonControls({onMouseover:!1,controls:this.options.controls}),this.setTitle(this.options.title),this.setContent(this.options.content),e.append(i),this},setTitle:function(t){this.data("title").empty(),this.data("title").append(t)},setContent:function(t){this.data("content").empty(),this.data("content").append(t)},content:function(){return this.data("content")},controls:function(t){return this.data("banner-text").kbaseButtonControls("controls",t)}})}(jQuery),$.fn.workspaceSelector=function(t,e){function i(){F.css("top",C.outerHeight(!0)+T.outerHeight(!0)+"px")}function n(){M.empty();var i=$('<tr id="ws-info-row">');M.append(i);var n=$("<td>");i.append(n);var a={};if(E)for(var s=0;s<k.length;s++)a[k[s].getWorkspace().id]=!0;else{var o=e.get("selected");if("array"===$.type(o))for(var s=0;s<o.length;s++)a[o[s]]=!0}y={};for(var r=[],l=[],s=0;s<t.length;s++){var d=t[s],c=new h(d);a[d.id]&&r.push(c),M.append(c.getHtml()),l.push(c),y[d.id]=c}k=r,v=l,p()}function a(t){for(var i=0;i<k.length;i++)k[i].unselect();for(var n=[],a=[],i=0;i<t.length;i++){var s=t[i],o=s.getWorkspace();n.push(o),a.push(o.id),s.select()}k=t,e.set("selected",a),W.fire(n)}function s(t){return $.inArray(t,b)}function o(t){var e=s(t);return e>0?b[e-1]:null}function r(t){var e=s(t);return e<b.length-1?b[e+1]:null}function l(t,e){if(t.ctrlKey||t.metaKey){var i=$.inArray(e,k),n=k.slice();i>-1?n.splice(i,1):n.push(e),w=e,x=null,a(n)}else if(t.shiftKey){null===w&&(w=e);var o,r,l=s(w),d=s(e);if(l===d)o="none",r=l;else if(l>d){o="up",r=d;var c=l;l=d,d=c}else o="down",r=d;x={dir:o,last:b[r]};for(var n=[],p=l;d>=p;p++)n.push(b[p]);a(n)}else w=e,x=null,a([e])}function d(t){if((t.ctrlKey||t.metaKey)&&65==t.which)return a(b),!1;if(38===t.keyCode){if(0===(x?s(x.last):s(w)))return!1;if(t.shiftKey){null===w&&(w=b[b.length-1]),null===x&&(x={dir:"none",last:w});var e;if(e="down"===x.dir?x.last:o(x.last),null!==e){var i=k.slice();return s(x.last)<=s(w)?$.inArray(e,i)<0&&(i.push(e),c("up",e)):e===w?(e=o(e),i.push(e),c("up",e)):(i.splice($.inArray(e,i),1),c("up",o(e))),x={dir:"up",last:e},a(i),!1}}else{var e;if(e=null===w?b[b.length-1]:null!==x?o(x.last):o(w),null!==e)return w=e,x=null,a([e]),c("up",e),!1}}else if(40===t.keyCode){if((x?s(x.last):s(w))===b.length-1)return!1;if(t.shiftKey){null===w&&(w=b[0]),null===x&&(x={dir:"none",last:w});var n;if(n="up"===x.dir?x.last:r(x.last),null!==n){var i=k.slice();return s(x.last)>=s(w)?$.inArray(n,i)<0&&(i.push(n),c("down",n)):n===w?(n=r(n),i.push(n),c("down",n)):(i.splice($.inArray(n,i),1),c("down",r(n))),x={dir:"down",last:n},a(i),!1}}else{var n;if(n=null===w?b[0]:null!==x?r(x.last):r(w),null!==n)return w=n,x=null,a([n]),c("down",n),!1}}return!0}function c(t,e){var i=$.inArray(e,b);if(!(0>i)){var n=e.getHtml().height(),a=i*n+1,s=a+n,o=F.scrollTop(),r=o+F.height();if(!(a>=o&&r>=s)){if("down"===t){if(Math.abs(a-r)<=n)return e.getHtml().get(0).scrollIntoView(!1),void 0}else if("up"===t&&Math.abs(s-o)<=n)return e.getHtml().get(0).scrollIntoView(!0),void 0;F.scrollTop(a-(r-o-n)/2)}}}function p(){var t=D.prop("checked"),i=S.prop("checked"),n=P.prop("checked"),s=B.prop("checked"),o=T.val();if(e.set("filter",{owner:t,admin:i,write:n,read:s,search:o}),0===v.length)return M.find("#ws-info-row").removeClass("hide").find("td").html("no workspaces"),void 0;var r=new RegExp(o,"i");b=[];for(var l=0;l<v.length;l++){var d=v[l],c=d.getWorkspace(),p=!1;if(i&&"a"===c.user_permission&&(p=!0),n&&"w"===c.user_permission&&(p=!0),s&&"r"===c.user_permission&&(p=!0),p&&t&&!c.isOwned&&(p=!1),p&&""!=o&&(p=r.test(c.id)),p)d.show(),b.push(d);else{var u=$.inArray(d,k);u>-1&&(d.unselect(),k.splice(u,1)),d.hide()}}0===b.length?M.find("#ws-info-row").removeClass("hide").find("td").html("no workspaces (change filters)"):M.find("#ws-info-row").addClass("hide"),a(k)}function u(){return'<div class="accordion" style="margin-bottom: 0px;"><div class="accordion-group"><div class="accordion-heading" style="text-align: center; position: relative;"><button class="btn btn-link" title="Filter Workspaces" style="width: 100%; height: 100%;">Workspaces <span class="caret"></span></button><button id="create-workspace" class="btn btn-xs" style="position: absolute; right: 3px; height: 20px; top: 5px; font-size: 15px; padding: 0px 4px 2px 4px;">+</button></div><div id="collapseOne" class="accordion-body collapse"><div class="accordion-inner"><div class="pull-left" style="position: relative; margin-right: 10px; height: 75px;"><div style="display: table; position: static; height: 100%;"><div style="display: table-cell; vertical-align: middle; position: static"><label class="checkbox"><input id="ws-filter-owner" type="checkbox" tabindex="-1" /> owner</label></div></div></div><div class="pull-left"><label class="checkbox"><input id="ws-filter-admin" type="checkbox" tabindex="-1" /> admin</label><label class="checkbox"><input id="ws-filter-write" type="checkbox" tabindex="-1" /> write</label><label class="checkbox"><input id="ws-filter-read" type="checkbox" tabindex="-1" /> read</label></div><div class="clearfix"></div></div></div></div></div>'}function h(t){function e(){s.find(".badge").addClass("badge-success").html(t.objectData.length)}var i=this,n=$('<tr class="ws-row">'),a=$('<td class="ws-cell">');n.append(a);var s=$('<div class="ws-cell-content">');a.append(s),s.append('<span class="ws-num-objects badge">~ '+t.objects+"</span>"),s.append(t.isOwned?"<strong>"+t.id+"</strong>":t.id),a.mousedown(function(){return!1}),a.click(function(t){l(t,i)});var o=$('<a class="ws-cell-manage btn btn-xs btn-xmini hide" style="margin-right: 2px; padding-bottom: 2px;" title="Manage Workspace"><i class="icon-cog"></i></a>');s.append(o),o.click(function(){return manageWorkspaceModal(t),!1}),"array"===$.type(t.objectData)&&e(),$.browser.mobile?(o.removeClass("hide"),s.addClass("ws-cell-content-hover")):a.hover(function(){o.removeClass("hide"),s.addClass("ws-cell-content-hover")},function(){o.addClass("hide"),s.removeClass("ws-cell-content-hover")}),this.getHtml=function(){return n},this.select=function(){a.addClass("ws-cell-selected")},this.unselect=function(){a.removeClass("ws-cell-selected")},this.hide=function(){n.addClass("hide")},this.show=function(){n.removeClass("hide")},this.getWorkspace=function(){return t},this.loaded=e}function f(){var t=new g;t.setTitle("Create Workspace"),t.setContent('<table style="margin-left: auto; margin-right: auto; text-align: right;"><tr><td>Workspace Id:</td><td><input type="text" id="create-id" style="width: 150px" /></td></tr><tr><td>Global Permission:</td><td>'+m("create-permission","n")+"</td></tr></table>"),$("#create-permission").css({width:"164px"}),t.on("hidden",function(){t.delete()}),$("#create-id").keypress(function(e){13==e.which&&t.submit()}),t.setButtons("Cancel","Create"),t.on("submit",function(){createWorkspace(t)}),t.show(),$("#create-id").focus()}function g(){var t=O.clone();$("body").append(t);var e=!1;t.on("hide",function(t){return e?(t.stopImmediatePropagation(),!1):!0});var i=/error|warning|info|success/,n=t.find(".modal-footer").find("button");n.eq(1).click(function(){t.trigger("submit")}),this.setTitle=function(e){t.find(".modal-header").find("h3").html(e)},this.setContent=function(e){t.find(".modal-body").empty().append(e)},this.setButtons=function(t,e){null===t?n.eq(0).remove():"string"==typeof t&&n.eq(0).html(t),null===e?n.eq(1).remove():"string"==typeof e&&n.eq(1).html(e)},this.on=function(){t.on.apply(t,arguments)},this.off=function(){t.off.apply(t,arguments)},this.show=function(e,i){e||(e={backdrop:"static"}),t.modal(e),this.setWidth(i),t.find(".modal-body").css({padding:"0px 15px",margin:"15px 0px"})},this.hide=function(){t.modal("hide")},this.delete=function(){t.modal("hide"),t.remove()},this.lock=function(){e=!0,t.find(".modal-header").find("button").prop("disabled",!0),n.prop("disabled",!0)},this.unlock=function(){e=!1,t.find(".modal-header").find("button").prop("disabled",!1),n.prop("disabled",!1)},this.cover=function(e){t.find(".base-modal-cover-box").removeClass().addClass("base-modal-cover-box base-modal-cover-content").empty().append(e),t.find(".modal-body").fadeTo(0,.3),t.find(".base-modal-cover").height(t.find(".modal-body").outerHeight()).width(t.find(".modal-body").outerWidth()).removeClass("hide")},this.uncover=function(){t.find(".base-modal-cover").addClass("hide"),t.find(".modal-body").fadeTo(0,1)},this.alert=function(e,n){n=i.test(n)?"alert-"+n:"",t.find(".base-modal-alert").removeClass("hide alert-error alert-info alert-success").addClass(n).empty().append(e)},this.alertHide=function(){t.find(".base-modal-alert").addClass("hide")},this.coverAlert=function(e,n){n=i.test(n)?"alert-"+n:"",this.cover(e),t.find(".base-modal-cover-box").removeClass().addClass("base-modal-cover-box alert "+n)},this.coverAlertHide=function(){this.uncover()},this.focus=function(){t.focus()},this.setWidth=function(e){t.css({width:function(){return e?e:$(this).width()},"margin-left":function(){return-($(this).width()/2)}})},this.submit=function(){t.trigger("submit")}}function m(t,e,i){var n=' selected="selected"',a=' id="'+t+'"';return"<select"+(t?a:"")+' class="input-sm"'+' style="margin: 0px;" data-value="'+e+'">'+(i?"":'<option value="n"'+("n"===e?n:"")+">none</option>")+'<option value="r"'+("r"===e?n:"")+">read</option>"+'<option value="w"'+("w"===e?n:"")+">write</option>"+'<option value="a"'+("a"===e?n:"")+">admin</option>"+"</select>"}var v=[],b=[],y={},k=[],w=null,x=null,_=this,C=$(u());C.find("#create-workspace").click(function(t){return t.stopImmediatePropagation(),f(),!1});var I=null;C.find(".collapse").on("shown",function(){i(),e.set("filter-open",!0),C.find(".caret").removeClass().addClass("caret-up"),C.find("input").removeAttr("tabindex"),window.clearInterval(I),I=null}).on("hidden",function(){i(),e.set("filter-open",!1),C.find(".caret-up").removeClass().addClass("caret"),C.find("input").attr("tabindex","-1"),window.clearInterval(I),I=null}).on("show hide",function(){I=window.setInterval(function(){i()},20)}),C.find("button").click(function(){C.find(".collapse").collapse("toggle")});var j=e.get("filter-open");j&&C.find(".collapse").addClass("in");var D=C.find("#ws-filter-owner").change(p),S=C.find("#ws-filter-admin").change(p),P=C.find("#ws-filter-write").change(p),B=C.find("#ws-filter-read").change(p);_.append(C);var T=$('<input type="text" class="search-query" style="margin-bottom: 5px;" placeholder="Filter Workspaces">');_.append(T),T.keyup(p);var L=e.get("filter");null!==L?(D.prop("checked",L.owner),S.prop("checked",L.admin),P.prop("checked",L.write),B.prop("checked",L.read),T.val(L.search)):(D.prop("checked",!1),S.prop("checked",!0),P.prop("checked",!0),B.prop("checked",!0));var F=$('<div id="ws-table-div" tabindex="0">');_.append(F);var M=$('<table id="ws-table" class="table table-bordered table-condensed">');F.append(M),F.click(function(){F.focus()}),F.keydown(d);var W=$.Callbacks();this.getHtml=function(){return _},this.onselect=function(t){W.add(t);for(var e=[],i=0;i<k.length;i++)e.push(k[i].getWorkspace())},this.setLoaded=function(t){var e=y[t.id];e&&e.loaded()},this.reload=n,this.resizeTable=i;var E=!1,O=$('<div class="modal base-modal hide" style="width: auto;" tabindex="-1" role="dialog">            <div class="modal-header">              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>              <h3>Modal</h3>            </div>            <div class="alert base-modal-alert hide"></div>            <div class="base-modal-cover hide">              <div class="base-modal-cover-table">                <div class="base-modal-cover-cell">                  <span class="base-modal-cover-box">                  </span>                </div>              </div>            </div>            <div class="modal-body"></div>            <div class="modal-footer">              <button data-dismiss="modal" class="btn">Cancel</button>              <button class="btn btn-primary">Submit</button>            </div>          </div>');return this},function(t,e){t.KBWidget({name:"kbaseAuthenticatedWidget",version:"1.0.0",_accessors:[{name:"auth",setter:"setAuth"},"sessionId","authToken","user_id","loggedInCallback","loggedOutCallback","loggedInQueryCallback"],options:{auth:e},init:function(i){return this._super(i),t(document).on("loggedIn.kbase",t.proxy(function(t,e){console.log("LI"),this.setAuth(e),this.loggedInCallback&&this.loggedInCallback(t,e)},this)),t(document).on("loggedOut.kbase",t.proxy(function(t){console.log("LO"),this.setAuth(e),this.loggedOutCallback&&this.loggedOutCallback(t)},this)),t(document).trigger("loggedInQuery",t.proxy(function(e){console.log("CALLS LIQ"),this.setAuth(e),e.kbase_sessionid&&this.callAfterInit(t.proxy(function(){this.loggedInQueryCallback&&this.loggedInQueryCallback(e)},this))},this)),this},setAuth:function(t){this.setValueForKey("auth",t),t==e&&(t={}),this.sessionId(t.kbase_sessionid),this.authToken(t.token),this.user_id(t.user_id),console.log("SETS AUTH TO "),console.log(t),console.log(this)},loggedInQueryCallback:function(t){this.loggedInCallback&&this.loggedInCallback(e,t)}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseButtonControls",version:"1.0.0",options:{controls:[],onMouseover:!0},init:function(e){return this._super(e),this._controls={},this.appendUI(t(this.$elem)),this},appendUI:function(e){return e.css("position","relative").prepend(t("<div></div>").addClass("btn-group").attr("id","control-buttons").css("right","0px").css("top","0px").css("position","absolute").css("margin-right","3px")),this._rewireIds(e,this),this.options.onMouseover&&e.mouseover(function(){t(this).children().first().show()}).mouseout(function(){t(this).children().first().hide()}).children().first().hide(),this.setControls(this.options.controls),this},controls:function(t){return t?this._controls[t]:this._controls},setControls:function(i){this.data("control-buttons").empty();for(control in this._controls)this._controls[control]=e;var n=this;t.each(i,t.proxy(function(i,a){if(!a.condition||0!=a.condition.call(this,a,n.options.context,this.$elem)){var s="btn btn-default btn-xs";a.type&&(s=s+" btn-"+a.type),tooltip=a.tooltip,"string"==typeof a.tooltip&&(tooltip={title:a.tooltip}),tooltip!=e&&tooltip.container==e;var o=t("<button></button>").attr("href","#").css("padding-top","1px").css("padding-bottom","1px").attr("class",s).append(t("<i></i>").addClass(a.icon)).tooltip(tooltip).bind("click",function(e){e.preventDefault(),e.stopPropagation(),a["icon-alt"]&&(t(this).children().first().toggleClass(a.icon),t(this).children().first().toggleClass(a["icon-alt"])),a.callback.call(this,e,n.options.context)});a.id&&(this._controls[a.id]=o),this.options.id&&o.data("id",this.options.id),this.data("control-buttons").append(o)}},this))}})}(jQuery),function(t){t.KBWidget({name:"KBaseCardManager",parent:"kbaseWidget",version:"1.0.0",options:{},cardIndex:0,cards:{},init:function(e){this._super(e),t.ui.dialog.prototype._makeDraggable=function(){this.uiDialog.draggable({containment:!1})},t.widget("ui.dialog",t.extend({},t.ui.dialog.prototype,{_title:function(t){this.options.title?t.html(this.options.title):t.html("&#160;")}}));var i=this;return t(document).on("kbaseCardClosed",function(t,e){i.cardClosed(e)}),this},cardClosed:function(t){delete this.cards[t]},addNewCard:function(e,i,n){var a="kblpc"+this.cardIndex;null===n&&(n={my:"center",at:"center",of:"window"}),this.$elem.append("<div id='"+a+"'/>");var s=t("#"+a)[e](i),o=s.getData(),r=o.title?o.title:"",l=o.id?o.id:"",d=s.options.width?s.options.width:300,c=o.workspace?o.workspace:"KBase Central Store",p=t("#"+a).LandingPageCard({position:n,title:"<div>"+r+"</div>"+"<div style='font-size: 14px; font-weight: normal'>"+l+"<span class='label label-primary pull-right'>"+c+"</span></div>",width:d,id:a});this.cards[a]={card:p,widget:s},this.cardIndex++},destroy:function(){this.listDataObjects();for(var e in this.cards)this.cards[e].card.LandingPageCard("close");t(document).off("kbaseCardClosed"),this.$elem.empty(),this.cards={},this.$elem.remove()},listDataObjects:function(){for(var t in this.cards)console.log(this.cards[t].widget.getData())},exportAllCardsToWorkspace:function(t){for(var e in this.cards)sendCardToWorkspace(e,t)},exportCardToWorkspace:function(t,e){this.cards[t].widget.exportToWorkspace(e)}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseDataBrowser",parent:"kbaseAuthenticatedWidget",version:"1.0.0",options:{title:"Data Browser",canCollapse:!0,height:"200px",types:{file:{icon:"icon-file-alt"},folder:{icon:"icon-folder-close-alt","icon-open":"icon-folder-open-alt",expandable:!0}},content:[]},init:function(t){return this.targets={},this.openTargets={},this._super(t),this.appendUI(this.$elem),this},sortByName:function(t,e){return t.name.toLowerCase()<e.name.toLowerCase()?-1:t.name.toLowerCase()>e.name.toLowerCase()?1:0},appendContent:function(i,n){return t.each(i,t.proxy(function(i,a){var s=a.icon,o=a["icon-open"];s==e&&a.type!=e&&(s=this.options.types[a.type].icon,o=this.options.types[a.type]["icon-open"]),a.expandable==e&&a.type!=e&&(a.expandable=this.options.types[a.type].expandable);var r=t("<i></i>").addClass(a.open?o:s).css("color","gray"),l=t("<li></li>").attr("id",a.id).append(t("<a></a>").css("padding","3px 5px 3px 5px").append(r).append(" ").append(a.label));if(a.data&&l.data("data",a.data),a.id&&(l.data("id",a.id),this.targets[a.id]=l),n.append(l),a.expandable){var d=t("<ul></ul>").addClass("databrowser-nav list-group").css("margin-bottom","0px");a.open||d.hide(),a.children!=e&&this.appendContent(a.children,d),n.append(d);var c=a.childrenCallback;a.children==e&&c==e&&a.type!=e&&(c=this.options.types[a.type].childrenCallback),l.bind("click",t.proxy(function(i){i.preventDefault(),i.stopPropagation(),r.toggleClass(o),r.toggleClass(s),d.is(":hidden")&&c!=e?c.call(this,a.id,t.proxy(function(t){d.empty(),this.appendContent(t,d),d.show("collapse"),this.openTargets[a.id]=!0},this)):d.is(":hidden")?(d.show("collapse"),this.openTargets[a.id]=!0):(d.hide("collapse"),this.openTargets[a.id]=!1)},this)),a.open&&a.children==e&&c!=e&&(r.toggleClass(o),r.toggleClass(s),d.hide(),l.trigger("click"))}var p=a.controls;p==e&&a.type!=e&&(p=this.options.types[a.type].controls),p&&l.kbaseButtonControls({controls:p,id:a.id,context:this})},this)),this._rewireIds(n,this),n},prepareRootContent:function(){return t("<ul></ul>").addClass("databrowser-nav list-group").css("margin-bottom","0px").css("height",this.options.height).css("overflow","auto").attr("id","ul-nav")},appendUI:function(t){var e=this.prepareRootContent();return this._rewireIds(e,this),this.appendContent(this.options.content,this.data("ul-nav")),t.kbaseBox({title:this.options.title,canCollapse:this.options.canCollapse,content:e,postcontent:this.options.postcontent}),t}})}(jQuery),function(t){t.KBWidget({name:"kbaseDeletePrompt",parent:"kbasePrompt",version:"1.0.0",options:{controls:["cancelButton","okayButton"]},init:function(e){return this._super(e),t("<div></div>").kbasePrompt({title:"Confirm deletion",body:"Really delete <strong>"+this.options.name+"</strong>?",controls:["cancelButton",{name:"Delete",type:"primary",callback:this.options.callback}]})}})}(jQuery),function(t){t.KBWidget({name:"kbaseErrorPrompt",parent:"kbasePrompt",version:"1.0.0",options:{controls:["cancelButton","okayButton"]},init:function(e){return this._super(e),t("<div></div>").kbasePrompt({title:e.title,body:t("<div></div>").attr("class","alert alert-error").append(t("<div></div>").append(t("<div></div>").addClass("pull-left").append(t("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(t("<div></div>").append(t("<strong></strong>").append(e.message)))),controls:["okayButton"]})}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseFormBuilder",version:"1.0.0",options:{elements:[],dispatch:{text:"buildTextField",textarea:"buildTextArea",password:"buildSecureTextField",checkbox:"buildCheckbox",select:"buildSelectbox",multiselect:"buildSelectbox",radio:"buildRadioButton",string:"buildTextField",secure:"buildSecureTextField","enum":"buildSelectbox","boolean":"buildCheckbox"},canSubmit:!1},init:function(t){return this._super(t),this.$elem.append(this._buildForm(this.options.elements)),this
},getFormValuesAsObject:function(){var e=this.getFormValuesAsArray(),i={};return t.each(e,function(t,e){i[e[0]]=e.slice(1),1==e.length&&(i[e[0]]=!0)}),i},getFormValuesAsArray:function(){var t=[],i=this.data("formValues"),n=this.data("form").get(0);for(key in i){var a=i[key],s=a.name,o=a.type,r=[];if("[object NodeList]"==n[s])for(var l=0;l<n[s].length;l++)r.push(n[s][l]);else r=[n[s]];if("checkbox"==o)n[s].checked&&t.push([key]);else if("multiselect"==o){var d=[key],c=d;a.asArray&&(c=[],d.push(c));for(var p=0,l=0;l<n[s].length;l++)n[s][l].selected&&(p=1,c.push(n[s][l].value));p&&t.push(d)}else if("radio"==o){for(var d=[key],p=0,l=0;l<n[s].length;l++)n[s][l].checked&&(p=1,d.push(n[s][l].value));p&&t.push(d)}else{for(var u=[],l=0;l<r.length;l++)if(a.json){var h=JSON.parse(r[l].value);a.asArray&&(h=[h]),u.push(h)}else u.push(this.carve(r[l].value,a.split,a.asArray));if(u.length>0){if(1==u.length&&(u=u[0],0==u.length))continue;t.push([key,u])}}}if(this.options.returnArrayStructure!=e){for(var f=[],g={},l=0;l<t.length;l++)g[t[l][0]]=t[l][1];for(var l=0;l<this.options.returnArrayStructure.length;l++)f.push(g[this.options.returnArrayStructure[l]]);t=f}return t},carve:function(i,n,a){n=n==e?[]:"string"==typeof n?[n]:n.slice(0);var s=n.shift();if(s==e)return a&&"string"==typeof i&&(i=[i]),i;var o=new RegExp(" *"+s+" *");return"string"==typeof i?this.carve(i.split(o),n,a):(n.push(s),jQuery.each(i,t.proxy(function(t,e){i[t]=this.carve(e,n,a)},this)),i)},escapeValue:function(t){return t=t.replace(/"/g,'\\"'),'"'+t+'"'},getFormValuesAsString:function(){var t=this.getFormValuesAsArray();if(this.options.returnArrayStructure!=e)return JSON.stringify(t);for(var i=[],n=0;n<t.length;n++){var a=t[n];if(1==a.length)i.push(a[0]);else for(var s=1;s<a.length;s++)this.data("formValues")[a[0]].valOnly?i.push(a[s]):"string"==typeof a[s]?i.push(a[0]+" "+this.escapeValue(a[s])):i.push(a[0]+" "+this.escapeValue(JSON.stringify(a[s])))}return i.join(" ")},_buildForm:function(i){var n=t.jqElem("form").addClass("form-horizontal");i.action&&form.attr("action",i.action),i.method&&form.attr("method",i.method),i.canSubmit||n.bind("submit",function(){return!1}),this.data("form",n);var a=this.data("formValues",{}),s=e;return t.each(i,t.proxy(function(i,o){if(o.key==e&&(o.key=o.name),a[o.key]!=e){var r="FORM ERROR. KEY "+o.key+" IS DOUBLE DEFINED";return n=r,!1}a[o.key]=o,o.fieldset?(s==e||s.attr("name")!=o.fieldset)&&(s=t.jqElem("fieldset").attr("name",o.fieldset).append(t.jqElem("legend").append(o.fieldset)),n.append(s)):s=n;var l=o.label!=e?o.label:o.name,d=t.jqElem("label").addClass("control-label col-lg-2").append(t.jqElem("span").attr("title",l).append(l)).bind("click",function(){t(this).next().children().first().focus()});this.options.values[o.key]!=e&&(o.value=o.checked=o.selected=this.options.values[o.key]);var c;o.type==e&&(o.type="text"),c=this.options.dispatch[o.type]?this[this.options.dispatch[o.type]](o):this.buildTextField(o);var p,u=t("<div></div>").addClass("col-lg-10");o.description&&(p=t.jqElem("span").addClass("help-block").append(o.description)),o.multi?u.append(t.jqElem("div").addClass("input-group").append(c).append(t.jqElem("span").addClass("input-group-btn").append(t("<button></button>").addClass("btn btn-default").attr("title","Add more").append(t("<i></i>").addClass("icon-plus")).bind("click",function(t){u.append(c.clone()),t.stopPropagation()})))).append(p):u.append(c).append(p),o.disabled&&c.prop("disabled",!0),n.append(t("<div></div>").addClass("form-group").append(d).append(u))},this)),n},buildTextField:function(e){return t.jqElem("input").attr("type","text").attr("value",e.value).attr("name",e.name).addClass("form-control")},buildTextArea:function(e){var i=t.jqElem("textarea").attr("name",e.name).addClass("form-control").append(e.value);return e.rows&&i.attr("rows",e.rows),i},buildSecureTextField:function(e){return t.jqElem("input").attr("type","password").attr("value",e.value).attr("name",e.name).addClass("form-control")},buildCheckbox:function(e){var i=t.jqElem("input").attr("type","checkbox").addClass("form-control").attr("name",e.name).attr("value",e.value);return e.checked&&i.prop("checked",!0),i},buildRadioButton:function(e){var i=t.jqElem("div");return t.each(e.values,t.proxy(function(n,a){var s=a,o=a;"string"!=typeof a&&(s=a.value,o=a.name);var r=t.jqElem("div").addClass("radio"),l=t.jqElem("input").attr("type","radio").attr("name",e.name).attr("value",s);e.checked==s&&l.prop("checked",!0);var d=t.jqElem("label").addClass("control-label").append(l).append(o);r.append(d),i.append(r)},this)),i},buildSelectbox:function(i){var n=t.jqElem("select").attr("name",i.name).addClass("form-control");return"multiselect"==i.type&&(n.prop("multiple",!0),i.size&&n.attr("size",i.size)),i.names==e&&(i.names=[]),t.each(i.values,function(e,a){var s=a,o=a;"string"!=typeof a&&(s=a.value,o=a.name);var r=t.jqElem("option").attr("value",s).append(o);"string"==typeof i.selected&&i.selected==s?r.prop("selected",!0):"object"==typeof i.selected&&t.each(i.selected,function(t,e){e==s&&r.prop("selected",!0)}),n.append(r)}),n}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseIrisCommands",parent:"kbaseAccordion",version:"1.0.0",options:{link:function(e){alert("clicked on "+t(e.target).text())},englishCommands:0,fontSize:"90%",overflow:!0,sectionHeight:"300px"},init:function(t){return this._super(t),t.client&&(this.client=t.client),this.commands=[],this.commandCategories={},this},completeCommand:function(t){for(var e=[],i=new RegExp("^"+t+".*"),n=0;n<this.commands.length;n++)this.commands[n].match(i)&&e.push(this.commands[n]);return e},commonPrefix:function(t,e){for(var i="",n=0;n<t.length&&n<e.length;n++){var a=t.charAt(n),s=e.charAt(n);if(a!=s)break;i+=a}return i},commonCommandPrefix:function(t){var e="";if(t.length>1){e=this.commonPrefix(t[0],t[1]);for(var i=2;i<t.length;i++)e=this.commonPrefix(e,t[i])}else e=t[0];return e},commandsMatchingRegex:function(t){for(var e=[],i=0;i<this.commands.length;i++)this.commands[i].match(t)&&e.push(this.commands[i]);return e.sort()},appendUI:function(i){this.client.valid_commands(t.proxy(function(n){var a=0,s=[];t.each(n,t.proxy(function(i,n){a+=n.items.length,n.title;var o=t("<ul></ul>").addClass("unstyled").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible");t.each(n.items,t.proxy(function(t,i){var a=i.cmd;if(this.options.englishCommands){var s=MetaToolInfo(i.cmd);if(s!=e){var r=s(i.cmd);a=r.label}}this.commands.push(i.cmd),this.commandCategories[n.name]==e&&(this.commandCategories[n.name]=[]),this.commandCategories[n.name].push(i.cmd),o.append(this.createLI(i.cmd,a))},this)),s.push({title:n.title,category:n.name,body:o})},this)),console.log("NUM "+a),this.loadedCallback(i,s)},this))},createLI:function(i,n,a){n==e&&(n=i),a==e&&(a=this.options.link);var s=t("<li></li>").append(t("<a></a>").attr("href","#").attr("title",i).data("type","invocation").text(n).bind("click",a));return s.kbaseButtonControls({context:this,controls:[{icon:"icon-question",callback:function(t,n){n.options.terminal!=e&&n.options.terminal.run(i+" -h")},id:"helpButton"}]}),s},loadedCallback:function(i,n){var a=this;t("input,textarea").on("focus.kbaseIrisCommands",t.proxy(function(){t(":focus").get(0)!=e&&t(":focus").get(0)!=this.data("searchField").get(0)&&this.data("focused",t(":focus"))},this)),this.data("focused",t(":focus"));var s=t.jqElem("form").css("margin-bottom","2px").append(t("<div></div>").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible").append(t("<div></div>").addClass("input-group").addClass("pull-right").addClass("input-group-sm").attr("id","searchFieldBox").append(t("<input></input>").attr("type","text").attr("name","search").addClass("form-control").attr("id","searchField").attr("size","50").keyup(t.proxy(function(e){if(e.preventDefault(),e.stopPropagation(),!(e.metaKey||e.altKey||e.ctrlKey)){var i=this.data("searchField").val();if(i.length<3)return 0==i.length&&this.data("test").animate({left:"-100%"},150),void 0;this.data("test").animate({left:"0px"},150);var n=new RegExp(i,"i"),s=this.commandsMatchingRegex(n),o=t.jqElem("ul").css("font-size",this.options.fontSize).css("padding-left","15px").addClass("unstyled");t.each(s,t.proxy(function(t,e){o.append(this.createLI(e,e,function(t){a.options.link.call(this,t)}))},this)),s.length||o.append(t("<li></li>").css("font-style","italic").text("No matching commands found")),this.data("searchResults").empty(),this.data("searchResults").append(o),this.data("searchResults").prepend(t.jqElem("div").css("position","relative").css("top","2px").css("left","90%").append(t.jqElem("button").addClass("btn btn-default btn-xs").append(t.jqElem("i").addClass("icon-remove")).on("click",t.proxy(function(){this.data("searchField").val(""),this.data("searchField").trigger("keyup")},this))))}},this))).append(t.jqElem("span").addClass("input-group-btn").css("height","30px").append(t.jqElem("button").addClass("btn btn-default").attr("id","search-button").append(t.jqElem("i").attr("id","search-button-icon").addClass("icon-search")).on("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.data("searchField").trigger("keyup")},this)))))),o=t.jqElem("div").kbaseBox({title:"Command list",content:t.jqElem("div").append(t.jqElem("div").attr("id","command-container").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible").append(t.jqElem("div").attr("id","test").css("position","relative").css("left","-100%").css("width","200%").append(t.jqElem("div").text("This is my left div right here").css("width","50%").css("float","left").attr("id","searchResults")).append(t.jqElem("div").css("width","50%").css("float","right").append(t.jqElem("div").attr("id","all-commands").css("white-space","nowrap"))))).append(s)});i.append(o.$elem),this._rewireIds(o.$elem,this),this._superMethod("appendUI",this.data("all-commands"),n),this.data("accordion").css("margin-bottom","0px")}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseIrisFileBrowser",parent:"kbaseDataBrowser",version:"1.0.0",_accessors:["invocationURL","client","addFileCallback","editFileCallback","singleFileSize","chunkSize","stalledUploads"],options:{stalledUploads:{},uploadDir:".uploads",concurrentUploads:4,singleFileSize:15e6,chunkSize:5e6,title:"File Browser",root:"/",types:{file:{controls:[{icon:"icon-minus",callback:function(e,i){i.deleteFile(t(this).data("id"),"file")},id:"removeButton"},{icon:"icon-download-alt",callback:function(e,i){i.openFile(t(this).data("id"))},id:"viewButton"},{icon:"icon-pencil",callback:function(i,n){n.editFileCallback()!=e&&n.editFileCallback()(t(this).data("id"),n)},id:"editButton",condition:function(t,i){var n=this.$elem.data("data").size;return n>i.singleFileSize()?!1:i.editFileCallback()==e?!1:!0}},{icon:"icon-arrow-right",callback:function(i,n){n.addFileCallback()!=e&&n.addFileCallback()(t(this).data("id"),n)},id:"addButton"}]},folder:{childrenCallback:function(t,e){this.listDirectory(t,function(t){e(t)})},controls:[{icon:"icon-minus",callback:function(e,i){i.deleteFile(t(this).data("id"),"folder")},id:"removeDirectoryButton"},{icon:"icon-plus",callback:function(e,i){i.addDirectory(t(this).data("id"))},id:"addDirectoryButton"},{icon:"icon-arrow-up",callback:function(e,i){i.data("active_directory",t(this).data("id")),i.data("fileInput").trigger("click")},id:"uploadFileButton"}]}}},uploadFile:function(){this.data("fileInput").trigger("click")},init:function(e){return this._super(e),this.listDirectory(this.options.root,t.proxy(function(t){this.appendContent(t,this.data("ul-nav"))},this)),this},checkStalledUploads:function(){this.client().list_files(this.sessionId(),"/",this.options.uploadDir).done(t.proxy(function(e){var i=e[0];t.each(i,t.proxy(function(e,i){this.client().get_file(this.sessionId(),"chunkMap","/"+this.options.uploadDir+"/"+i.name).done(t.proxy(function(t){var e;try{var e=JSON.parse(t)}catch(i){this.dbg("Could not load chunk map"),this.dbg(i)}for(;e.chunks.length>0;){var n=e.chunks.shift();e.chunksByName[n.name]=n,e.doneChunks.push(n)}this.checkAndMergeChunks(e)},this))},this))},this))},loggedInCallback:function(e,i){i.success&&(this.refreshDirectory("/"),this.client().make_directory(this.sessionId(),"/",this.options.uploadDir).always(t.proxy(function(){this.checkStalledUploads()},this)))},loggedOutCallback:function(){this.data("ul-nav").empty()},prepareRootContent:function(){var e=this._super();e.css("height",parseInt(this.options.height)-25+"px");var i=t("<div></div>").css("margin-top","2px");return i.kbaseButtonControls({onMouseover:!1,context:this,controls:[{icon:"icon-plus",callback:function(t,e){e.addDirectory("/")}},{icon:"icon-arrow-up",callback:function(e,i){i.data("active_directory",t(this).data("id")),i.data("fileInput").trigger("click")}}]}),t("<div></div>").css("height",this.options.height).append(e).append(i).append(t("<input></input>").attr("type","file").attr("id","fileInput").css("display","none").attr("multiple","multiple").bind("change",t.proxy(this.handleFileSelect,this)))},refreshDirectory:function(i){if(this.sessionId()==e)return this.data("ul-nav").empty(),void 0;var n;if("/"==i)n=this.data("ul-nav");else{var a=this.targets[i];if(a==e)return;n=a.next()}var s=new RegExp("^"+i),o=[];for(var r in this.targets)r.match(s)&&!this.targets[r].next().is(":hidden")&&this.targets[r].next().is("ul")&&o.push(r);n.is(":hidden")||this.listDirectory(i,t.proxy(function(t){n.empty(),this.appendContent(t,n)},this),o),t.each(o,t.proxy(function(e,i){var n=this.targets[i].next();this.listDirectory(i,t.proxy(function(t){n.empty(),this.appendContent(t,n),n.show()},this))},this))},listDirectory:function(e,i){this.client().list_files(this.sessionId(),"/",e,jQuery.proxy(function(e){var n=e[0],a=e[1],s=[],o=this;jQuery.each(n,t.proxy(function(t,e){e.full_path=e.full_path.replace(/\/+/g,"/"),s.push({type:"folder",id:e.full_path,label:e.name,open:o.openTargets[e.full_path]})},this)),jQuery.each(a,t.proxy(function(t,e){e.full_path=e.full_path.replace(/\/+/g,"/"),s.push({type:"file",id:e.full_path,label:e.name,data:e})},this)),s=s.sort(this.sortByKey("label","insensitively")),i(s)},this),t.proxy(function(t){this.dbg(t)},this))},handleFileSelect:function(i){i.preventDefault();var n=i.target.files||i.originalEvent.dataTransfer.files||i.dataTransfer.files;t.each(n,jQuery.proxy(function(i,n){var a="/";this.data("active_directory")&&(a=this.data("active_directory"));var s=n.name;this.data("override_filename")&&(s=this.data("override_filename"),this.data("override_filename",e));var o=a+"/"+s;o=o.replace(/\/\/+/g,"/");var r=this.uuid();if(this.trigger("updateIrisProcess",{pid:r,msg:"Uploading "+o+" ... 0%"}),n.size<=this.singleFileSize()){var l=new FileReader;l.onprogress=t.proxy(function(t){this.trigger("updateIrisProcess",{pid:r,msg:"Uploading "+o+" ... "+(100*t.loaded/t.total).toFixed(2)+"%"}),this.dbg("progress "+t.loaded/t.total),this.dbg(t)},this),l.onload=jQuery.proxy(function(t){this.client().put_file(this.sessionId(),s,t.target.result,a,jQuery.proxy(function(){this.trigger("removeIrisProcess",r),this.refreshDirectory(a)},this),jQuery.proxy(function(t){this.trigger("removeIrisProcess",r),this.dbg(t)},this))},this),l.readAsBinaryString(n)}else{var d=o;d=d.replace(/\//g,"::");var c=n.size,p=this.chunkSize(),u=1,h=0,f={chunks:[],doneChunks:[],chunksByName:{},size:0,fileName:s,upload_dir:a,fullFilePath:o,chunkUploadPath:d,fullUploadPath:this.options.uploadDir+"/"+d,pid:r};if(this.stalledUploads()[f.fullFilePath]!=e&&(this.data("resumed_chunkMap",this.stalledUploads()[f.fullFilePath]),this.stalledUploads()[f.fullFilePath]=e),this.data("resumed_chunkMap")!=e){f=this.data("resumed_chunkMap"),this.trigger("removeIrisProcess",r);var g=(100*f.doneChunks.length/(f.doneChunks.length+f.chunks.length)).toFixed(2);g>=100&&(g=99),this.trigger("updateIrisProcess",{pid:f.pid,msg:"Uploading "+f.fullFilePath+" ... "+g+"%"}),this.data("resumed_chunkMap",e)}else for(;c>0;){p>c&&(p=c),c-=p;var m="00000000",v=(m+u).slice(-8);f.chunks.push({chunk:u,name:"chunk."+v,start:h,end:h+p,size:p,complete:!1}),f.size+=p,h+=p,u++}var b=t.proxy(function(){t.each(f.chunks,function(t,e){f.chunksByName[e.name]=e});for(var e=this.makeChunkUploader(n,f),i=0;i<this.options.concurrentUploads;i++)e()},this);this.client().make_directory(this.sessionId(),"/"+this.options.uploadDir,f.chunkUploadPath).always(t.proxy(function(){this.client().put_file(this.sessionId(),"chunkMap",JSON.stringify(f,e,2),"/"+f.fullUploadPath).done(b).fail(t.proxy(function(t){this.dbg(t)},this))},this))}},this)),this.data("fileInput").val("")},makeChunkUploader:function(t,e){e.jobs=0;var i=this;return function(){var n=arguments.callee;if(e.chunks.length>0){var a=e.chunks.shift(),s=t.slice||t.webkitSlice||t.mozSlice,o=s.call(t,a.start,a.end),r=new FileReader;r.onloadend=function(t){t.target.readyState==FileReader.DONE&&i.client().put_file(i.sessionId(),a.name,t.target.result,"/"+e.fullUploadPath,function(){e.doneChunks.push(a);var t=(100*e.doneChunks.length/(e.jobs-1+e.doneChunks.length+e.chunks.length)).toFixed(2);t>=100&&(t=99),i.trigger("updateIrisProcess",{pid:e.pid,msg:"Uploading "+e.fullFilePath+" ... "+t+"%"}),e.jobs--,n()},function(){e.jobs--,e.chunks.push(a),n()})},e.jobs++,r.readAsBinaryString(o)}else 0==e.jobs&&i.checkAndMergeChunks(e,n)}},checkAndMergeChunks:function(i,n){this.client().list_files(this.sessionId(),"/"+this.options.uploadDir,i.chunkUploadPath,t.proxy(function(a){a[0];var s=a[1],o=!0,r=0,l={};jQuery.each(s,t.proxy(function(t,e){l[e.name]=e.size},this));var d=l.upload||0,c=[];if(i.doneChunks=i.doneChunks.sort(this.sortByKey("name")),t.each(i.doneChunks,t.proxy(function(t,n){var a=n.size;a==l[n.name]?(n.complete=!0,r++,c.push(n)):l[n.name]==e&&d>0?(d-=a,n.complete=!0,r++):(n.complete=!1,i.chunks.push(n),o=!1)},this)),i.doneChunks=c,0!=d){o=!1;var p=Object.keys(l).sort()[0],u=l[p];if(0!=d-u){var h=t("<div></div>").text("Uploading "+i.fullFilePath+" failed. Please start over");return h.kbaseButtonControls({onMouseover:!0,context:this,controls:[{icon:"icon-ban-circle",tooltip:"Cancel",callback:function(t,e){e.client().remove_directory(e.sessionId(),"/","/"+i.fullUploadPath,function(){e.trigger("removeIrisProcess",i.pid)})}}]}),this.trigger("updateIrisProcess",{pid:i.pid,content:h}),void 0}for(var c=[],f=0;f<i.doneChunks.length;f++){var g=i.doneChunks[f];g.name!=p&&c.push(g)}i.doneChunks=c,o=!0}if(o){var m=this.makeChunkMerger(i);m()}else if(n)n();else{var v=(100*i.doneChunks.length/(i.doneChunks.length+i.chunks.length)).toFixed(2);v>=100&&(v=99);var h=t("<div></div>").text("Uploading "+i.fullFilePath+" ...stalled at "+v+"%");h.kbaseButtonControls({onMouseover:!0,context:this,controls:[{icon:"icon-refresh",callback:function(t,e){e.data("resumed_chunkMap",i),e.data("fileInput").trigger("click")}},{icon:"icon-ban-circle",callback:function(t,e){e.client().remove_directory(e.sessionId(),"/","/"+i.fullUploadPath,function(){e.trigger("removeIrisProcess",i.pid),e.refreshDirectory("/"+target_dir)})}}]}),this.trigger("updateIrisProcess",{pid:i.pid,content:h}),this.stalledUploads()[i.fullFilePath]=i}},this))},makeChunkMerger:function(e){var i=this,n=e.fullUploadPath+"/upload",a=e.doneChunks.length?1/e.doneChunks.length:0,s=1;return function(){if(0==e.doneChunks.length)return i.client().rename_file(i.sessionId(),"/",n,e.fullFilePath,function(){i.client().remove_directory(i.sessionId(),"/",e.fullUploadPath,function(){i.trigger("removeIrisProcess",e.pid),i.refreshDirectory(e.upload_dir)})},function(t){this.dbg("rename file failure"),this.dbg(t)}),void 0;var o=e.doneChunks.shift(),r=arguments.callee;i.client().run_pipeline(i.sessionId(),"cat "+e.fullUploadPath+"/"+o.name+" >> "+n,[],0,"/",t.proxy(function(n){if(n){n[0];var l=n[1],d=(99+s++*a).toFixed(2);i.trigger("updateIrisProcess",{pid:e.pid,msg:"Uploading "+e.fullFilePath+" ... "+d+"%"}),l.length||i.client().remove_files(i.sessionId(),"/"+e.fullUploadPath,o.name,t.proxy(function(){r()},i))}},this),function(t){this.dbg("OMFG ERR"),this.dbg(t)})}},openFile:function(t){var e=this.options.invocationURL+"/download/"+t+"?session_id="+this.sessionId();window.location.href=e},deleteFile:function(i,n){var a="file"==n?"remove_files":"remove_directory";i=i.replace(/\/+$/,"");var s=i.match(/(.+)\/[^/]+$/),o="/";s!=e&&s.length>1&&(o=s[1]);var r=this,l=i.replace(this.options.root,""),d=t("<div></div>").kbaseDeletePrompt({name:l,callback:function(t,e){e.closePrompt(),r.client()[a](r.sessionId(),"/",i,function(){r.refreshDirectory(o)})}});d.openPrompt()},addDirectory:function(e){var i=this,n=e.replace(this.options.root,"/"),a=t("<div></div>").kbasePrompt({title:"Create directory",body:t("<p></p>").append("Create directory ").append(t("<span></span>").css("font-weight","bold").text(n)).append(" ").append(t("<input></input>").attr("type","text").attr("name","dir_name").attr("size","20")),controls:["cancelButton",{name:"Create directory",type:"primary",callback:function(t,n){n.closePrompt(),i.client().make_directory(i.sessionId(),e,a.dialogModal().find("input").val(),function(){i.refreshDirectory(e)},function(){})}}]});a.openPrompt()}})}(jQuery),function(t){t.KBWidget({name:"kbaseIrisFileEditor",parent:"kbaseAuthenticatedWidget",version:"1.0.0",_accessors:["client",{name:"file",setter:"setFile"},"rows","cols","content","loadedContent","saveFileCallback","cancelSaveFileCallback"],options:{rows:50,cols:85},init:function(t){return this._super(t),this.appendUI(this.$elem),this},setFile:function(t){this.setValueForKey("file",t),this.appendUI(this.$elem)},save:function(){var t=this.file().split("/"),e=t.pop(),i=t.join("/");this.content()!=this.loadedContent()&&this.client().put_file(this.sessionId(),e,this.content(),i,jQuery.proxy(function(){this.dbg("saved file")},this),jQuery.proxy(function(t){throw"Could not save file "+t.error.message},this))},appendUI:function(e){e.empty(),e.append("Loading file "+this.file()+"...<br>please wait...").append(t.jqElem("br")).append(t.jqElem("div").attr("align","center").append(t.jqElem("i").addClass("icon-spinner").addClass("icon-spin icon-4x"))),this.client().get_file(this.sessionId(),this.file(),"/",t.proxy(function(i){var n=t.jqElem("textarea").attr("rows",this.rows()).attr("cols",this.cols()).css("width","720px").kb_bind(this,"content");this.content(i),this.loadedContent(this.content()),e.empty(),e.append(n)},this),t.proxy(function(t){this.dbg("FILE FAILURE"),this.dbg(t),this.dbg(this)},this))},savePrompt:function(){if(this.content()==this.loadedContent())return this.saveFileCallback&&this.saveFileCallback()(this.file()),void 0;var e=t.jqElem("div").kbasePrompt({title:"Save changes",body:"Save changes to <strong>"+this.file()+"</strong> before closing?",controls:[{name:"Close without save",callback:t.proxy(function(t,e){e.closePrompt(),this.cancelSaveFileCallback&&this.cancelSaveFileCallback()(this.file())},this)},{name:"Close and save",type:"primary",callback:t.proxy(function(t,e){e.closePrompt(),this.save(),this.saveFileCallback&&this.saveFileCallback()(this.file())},this)}]});e.openPrompt()}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseIrisGrammar",version:"1.0.0",options:{defaultGrammarURL:"http://www.prototypesite.net/iris-dev/grammar.json"},init:function(i){return this._super(i),this.options.$loginbox!=e&&(this.$loginbox=this.options.$loginbox),this.appendUI(t(this.$elem)),this.retrieveGrammar(this.options.defaultGrammarURL),this},appendUI:function(){},tokenize:function(t){for(var i=[],n="",a=e,s=!1,o=0;o<t.length;o++){var r=t.charAt(o);a==e&&r.match(/[?;]/)||(r.match(/\S/)||a!=e?(n+=r,a==e||r!=a||s?(a==e&&('"'==r||"'"==r)&&(a=r),s="\\"==r?!0:!1):(n=n.substring(1,n.length-1),i.push(n),n="",a=e)):n.length&&(i.push(n),n=""))}return n.length&&i.push(n),i},evaluate:function(i,n){var a=this.tokenize(i),s=this.grammar;if(s==e)return this.retrieveGrammar(this.options.defaultGrammarURL,t.proxy(function(){this.evaluate(i,n)},this)),void 0;var o={},r={parsed:"",string:i,grammar:s._root};"explain"==a[0]&&(a.shift(),r.explain=1);for(var l=0;l<a.length;l++){var d=a[l],c=!1;for(child in r.grammar.children){var p=r.grammar.children[child];if(p.regex&&d.match(p.regex))r.grammar=r.grammar.children[child],c=!0;else if(child.match(/^\$/))r.grammar=r.grammar.children[child],c=!0;else if(d==child)r.grammar=r.grammar.children[child],c=!0;else if(!p.caseSensitive){var u=new RegExp("^"+child+"$","i");d.match(u)&&(r.grammar=r.grammar.children[child],c=!0)}if(c){child.match(/^\$/)&&(o[child]=d),r.parsed=r.parsed.length?r.parsed+" "+d:d,r.grammar=p,r.execute=p.execute;break}}if(!c&&!r.grammar.childrenOptional){r.tail=a.splice(l,a.length-l).join(" ");break}}if(r.grammar.children!=e&&Object.keys(r.grammar.children).length&&!r.grammar.childrenOptional){r.error="Parse error at "+d,r.fail=1,delete r.execute,r.token=d,r.tail=a.splice(l,a.length-l).join(" ");var h=[];if(r.grammar.children!=e)for(prop in r.grammar.children)h.push(this.nextForGrammar(prop,r.grammar.children));return r.next=h.sort(),n&&n(r),r}r.rawExecute=r.execute;for(var f in o)r.execute=r.execute.replace(f,o[f]);if(r.tail){var g;(g=r.tail.match(/^into\s+(\S+)/))?r.execute=r.execute+" > "+g[1]:(r.fail=1,r.error="Extra characters - "+r.tail)}return n&&n(r),r},nextForGrammar:function(t,i){t==e&&(t="");for(var n=i[t].children,a=1e3;n!=e&&a-->0;)if(1==Object.keys(n).length){var s=Object.keys(n)[0];t=t.length?t+" "+s:s,n=n[s].children}return t},allQuestions:function(t){var i=["Display the dna sequence of contig $contig_id from $max to $min","Display the dna sequence of gene $gene_id","What type of family is $family","What is the function of family $family","What fids are in family $family","Display sequences in family $family as fasta","Display sequences in family $family","What is the function of feature $feature_id","What fids in k12 have attached publications","What publications have been connected to gene thrB","Show the DNA sequence of fid thrB","Display the protein sequence of fid thrB","Which protein families contain gene $gene_id","Is fid thrB in an atomic regulon","Which fids appear to have correlated expression with gene thrB","What is the location of feature thrB","What protein sequence corresponds to fid $fid","Which contigs are in genome $genome","What is the size of genome $genome","What is the KBase id of SEED genome $genome","What is the KBase id of SEED feature $feature","What is the source of genome $genome","Which are the closest genomes to $genome","What is the name of genome $genome","Which genomes have models","Which models exist for genome $genome","Which reactions exist in genome $genome","Which reactions are in model $model","What reactions connect to role $role","What roles relate to reaction $reaction","What complexes implement reaction $reaction","What reactions does complex $complex implement","Describe the biomass reaction for model kb|fm.0","What compounds are connected to model $model","What media are known","What compounds are considered part of media $media","show reactions that connect to compound $compound","How many otus exist","What otus exist","What otu contains $otu","What genomes are in OTU $otu","What annotations are known for protein sequence $sequence","What roles are used in models","What roles are used in subsystem $subsystem","What subsystems include role $role","What features in $feature implement role $role","What families implement role $role","What roles occur in subsystem $subsystem","What roles are in subsystem $subsystem","What genomes are in subsystem $subsystem","What subsystems are in genome $genome","what is the taxonomy of genome $genome","What is the taxonomic group id of $group_id","What genomes are in taxonomic group $group"];if(t==e)return i;for(var n=[],a=new RegExp(t),s=0;s<i.length;s++){var o=i[s];o.match(a)&&n.push(o)}return n},XXXallQuestionsBOGUS:function(i,n){if(n==e&&(n=""),i==e){if(this.grammar==e)return this.retrieveGrammar(this.options.defaultGrammarURL,t.proxy(function(){this.allQuestions()},this)),void 0;i=this.grammar._root.children}for(var a in i)n.length?n+" "+a:a},retrieveGrammar:function(i,n){var a=e;t.ajax({async:!0,dataType:"text",url:i,crossDomain:!0,beforeSend:function(t){a&&t.setRequestHeader("Authorization",a)},success:t.proxy(function(t){var e=JSON.parse(t);this.grammar=e,n&&n()},this),error:t.proxy(function(t,e){this.dbg(e)},this),type:"GET"})}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseIrisProcessList",version:"1.0.0",_accessors:["processList"],options:{processList:{}},init:function(e){return this._super(e),t(document).on("updateIrisProcess.kbaseIris",t.proxy(function(t,e){this.updateProcess(t,e)},this)),t(document).on("removeIrisProcess.kbaseIris",t.proxy(function(t,e){this.removeProcess(t,e)},this)),t(document).on("clearIrisProcesses.kbaseIris",t.proxy(function(t){this.clearProcesses(t)},this)),this.appendUI(this.$elem),this},clearProcesses:function(e){var i=Object.keys(this.processList());t.each(i,t.proxy(function(t,i){this.removeProcess(e,i)},this))},updateProcess:function(i,n){var a=n.pid;if(a==e)throw"Cannot update process w/o pid";this.pendingLi().remove();var s=this.processList()[a]!=e?this.processList()[a]:t.jqElem("li");return s.empty(),n.msg?s.text(n.msg):n.content&&s.append(n.content),this.processList()[a]==e&&(this.$elem.find("ul").append(s),this.processList()[a]=s),s},removeProcess:function(t,i){if(i==e)throw"Cannot update process w/o pid";var n=this.processList()[i];if(n!=e)return n.remove(),0==this.$elem.find("ul").children().length&&this.$elem.find("ul").append(this.pendingLi()),this.processList()[i]=e,i},appendUI:function(e){return e.kbaseBox({title:"Running processes",content:t("<ul></ul>").addClass("unstyled").append(this.pendingLi())}),this},pendingLi:function(){return this.data("pendingLi")==e&&this.data("pendingLi",t("<li></li>").css("font-style","italic").text("No processes running")),this.data("pendingLi")}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseIrisTerminal",parent:"kbaseAuthenticatedWidget",version:"1.0.0",_accessors:["terminalHeight","client"],options:{invocationURL:"http://localhost:5000",searchURL:"https://kbase.us/services/search-api/search/$category/$keyword?start=$start&count=$count&format=json",searchStart:1,searchCount:10,searchFilter:{literature:"link,pid"},maxOutput:100,scrollSpeed:750,terminalHeight:"450px",promptIfUnauthenticated:1,autocreateFileBrowser:!0},init:function(i){return this._super(i),t.fn.setCursorPosition=function(e){return 0==this.length?this:t(this).setSelection(e,e)},t.fn.setSelection=function(t,e){if(0==this.length)return this;if(input=this[0],input.createTextRange){var i=input.createTextRange();i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select()}else input.setSelectionRange&&(input.focus(),input.setSelectionRange(t,e));return this},t.fn.focusEnd=function(){return this.setCursorPosition(this.val().length),this},t.fn.getCursorPosition=function(){return 0==this.length?this:(input=this[0],input.selectionEnd)},this.client()==e&&this.client(new InvocationService(this.options.invocationURL,e,t.proxy(function(){var t=this.auth()?this.auth().token:e;return t},this))),this.tutorial=t("<div></div>").kbaseIrisTutorial(),this.commandHistory=[],this.commandHistoryPosition=0,this.path=".",this.cwd="/",this.variables={},this.aliases={},this.appendUI(t(this.$elem)),this.fileBrowsers=[],this.options.fileBrowser?this.addFileBrowser(this.options.fileBrowser):this.options.autocreateFileBrowser&&this.addFileBrowser(t("<div></div>").kbaseIrisFileBrowser({client:this.client(),externalControls:!1})),t(document).on("loggedInQuery.kbase",t.proxy(function(t,i){var n=this.auth();console.log("TRIG AUTH"),console.log(n),i&&n!=e&&1==n.unauthenticated&&i(n)},this)),this},loggedInCallback:function(e,i){i.success&&(this.client().start_session(i.user_id,t.proxy(function(){this.loadCommandHistory(),i.token?this.out("Authenticated as "+i.name):this.out("Unauthenticated logged in as "+i.kbase_sessionid),this.out_line(),this.scroll()
},this),t.proxy(function(t){this.out("<i>Error on session_start:<br>"+t.error.message.replace("\n","<br>\n")+"</i>",0,1)},this)),this.input_box.focus())},loggedInQueryCallback:function(t){this.loggedInCallback(e,t),!t.success&&this.options.promptIfUnauthenticated&&this.trigger("promptForLogin")},loggedOutCallback:function(){this.cwd="/",this.commandHistory=e,this.terminal.empty(),this.trigger("clearIrisProcesses")},addFileBrowser:function(t){this.fileBrowsers.push(t)},open_file:function(t){this.fileBrowsers[0].openFile(t)},refreshFileBrowser:function(){for(var t=0;t<this.fileBrowsers.length;t++)this.fileBrowsers[t].refreshDirectory(this.cwd)},appendInput:function(t,i){if(this.input_box){var n=i==e?" ":"";0==this.input_box.val().length&&(n=""),this.input_box.val(this.input_box.val()+n+t),this.input_box.focusEnd()}},appendUI:function(e){var i=t("<div></div>").append(t("<div></div>").attr("id","terminal").css("height",this.options.terminalHeight).css("overflow","auto").css("padding","5px").css("font-family","monospace")).append(t("<textarea></textarea>").attr("id","input_box").attr("style","width : 95%;").attr("height","3")).append(t("<div></div>").attr("id","file-uploader")).append(t("<div></div>").attr("id","panel").css("display","none"));this._rewireIds(i,this),e.append(i),this.terminal=this.data("terminal"),this.input_box=this.data("input_box"),this.out("Welcome to the interactive KBase terminal!<br>\nPlease click the 'Sign in' button in the upper right to get started.<br>\nType <b>commands</b> for a list of commands.<br>\nFor usage information about a specific command, type the command name with -h or --help after it.<br>\nPlease visit <a href = 'http://kbase.us/for-users/tutorials/navigating-iris/' target = '_blank'>http://kbase.us/for-users/tutorials/navigating-iris/</a> or type <b>tutorial</b> for an IRIS tutorial.<br>\nTo find out what's new, type <b>whatsnew</b><br>\n",0,1),this.out_line(),this.input_box.bind("keypress",jQuery.proxy(function(t){this.keypress(t)},this)),this.input_box.bind("keydown",jQuery.proxy(function(t){this.keydown(t)},this)),this.input_box.bind("onchange",jQuery.proxy(function(){this.dbg("change")},this)),this.data("input_box").focus(),t(window).bind("resize",jQuery.proxy(function(){this.resize_contents(this.terminal)},this)),this.resize_contents(this.terminal)},saveCommandHistory:function(){this.client().put_file(this.sessionId(),"history",JSON.stringify(this.commandHistory),"/",function(){},function(){})},loadCommandHistory:function(){this.client().get_file(this.sessionId(),"history","/",jQuery.proxy(function(t){this.commandHistory=JSON.parse(t),this.commandHistoryPosition=this.commandHistory.length},this),jQuery.proxy(function(t){this.dbg("error on history load : "),this.dbg(t)},this))},resize_contents:function(){},keypress:function(t){if(13==t.which){t.preventDefault();var e=this.input_box.val();e=e.replace(/^ +/,""),e=e.replace(/ +$/,""),this.dbg("Run ("+e+")"),this.out_cmd(e);var i,n=e+e;(i=e.match(/^\s*(\$\S+)/))&&(n=i[1]);for(variable in this.variables)if(!variable.match(n)){var a=variable.replace(/\$/,"\\$"),s=new RegExp(a,"g");e=e.replace(s,this.variables[variable])}this.run(e),this.scroll(),this.input_box.val("")}},keydown:function(t){if(38==t.which)t.preventDefault(),this.commandHistoryPosition>0&&this.commandHistoryPosition--,this.input_box.val(this.commandHistory[this.commandHistoryPosition]);else if(40==t.which)t.preventDefault(),this.commandHistoryPosition<this.commandHistory.length&&this.commandHistoryPosition++,this.input_box.val(this.commandHistory[this.commandHistoryPosition]);else if(39==t.which&&this.options.commandsElement){var i=this.input_box.val().length,n=this.input_box.getCursorPosition();if(n!=e&&i>n)return this.selectNextInputVariable(t),void 0;t.preventDefault();var a=this.input_box.val().match(/([^\s]+)\s*$/);if(a.length){a=a[1];var s=this.options.grammar.evaluate(this.input_box.val());if(s!=e&&s.next&&s.next.length){for(var o=new RegExp("^"+a),r=[],l=0;l<s.next.length;l++){var d=s.next[l];d.match(o)&&r.push(d)}if((r.length||0==s.parsed.length)&&(s.next=r,1==s.next.length)){var c=new RegExp("s*"+a+"s*$");this.input_box.val(this.input_box.val().replace(c,""))}if(1==s.next.length){var p=" ";return this.input_box.val().match(/\s+$/)&&(p=""),this.appendInput(p+s.next[0]+" ",0),this.selectNextInputVariable(),void 0}if(s.next.length){var u=!0,h=new RegExp(a+"\\s*$");for(prop in s.next)prop.match(h)||(u=!1);return this.displayCompletions(s.next,a),void 0}}var f=this.options.commandsElement.kbaseIrisCommands("completeCommand",a);if(1==f.length){var g=f[0].replace(new RegExp("^"+a),"");this.appendInput(g+" ",0)}else f.length&&this.displayCompletions(f,a)}}},selectNextInputVariable:function(t){var i;if(this.input_box.getCursorPosition(),i=this.input_box.val().match(/(\$\S+)/)){t!=e&&t.preventDefault();var n=this.input_box.val().indexOf(i[1]),a=this.input_box.val().indexOf(i[1])+i[1].length;this.input_box.setSelection(n,a),this.input_box.setSelection(n,a)}},search_json_to_table:function(e,i){var n=t("<div></div>"),a=new RegExp(".");return i&&(a=new RegExp(i.replace(/,/g,"|"))),t.each(e,t.proxy(function(e,i){for(var s=t("<table></table>").css("border","1px solid black").css("margin-bottom","2px"),o=Object.keys(i).sort(),e=0;e<o.length;e++){var r=o[e];r.match(a)&&s.append(t("<tr></tr>").css("text-align","left").append(t("<th></th>").append(r)).append(t("<td></td>").append(i[r])))}n.append(s)},this)),n},displayCompletions:function(i,n){var a=this.options.commandsElement.kbaseIrisCommands("commonCommandPrefix",i);a!=e&&a.length?this.input_box.val(this.input_box.val().replace(new RegExp(n+"s*$"),a)):a=n;var s=t("<div></div>");this.terminal.append(s);var o=t("<table></table>").attr("border",1).css("margin-top","10px").append(t("<tr></tr>").append(t("<th></th>").text("Suggested commands")));jQuery.each(i,jQuery.proxy(function(e,i){o.append(t("<tr></tr>").append(t("<td></td>").append(t("<a></a>").attr("href","#").text(i).bind("click",jQuery.proxy(function(t){t.preventDefault(),this.input_box.val(this.input_box.val().replace(new RegExp(a+"s*$"),"")),this.appendInput(i+" ")},this)))))},this)),s.append(o),this.scroll()},out_cmd:function(e){var i=t("<div></div>").css("white-space","pre").css("position","relative").append(t("<span></span>").addClass("command").text(">"+this.cwd+" "+e)).mouseover(function(){t(this).children().first().show()}).mouseout(function(){t(this).children().first().hide()});i.kbaseButtonControls({controls:[{icon:"icon-eye-open",callback:function(){var e=window.open();e.document.open();var i=t("<div></div>").append(t("<div></div>").css("white-space","pre").css("font-family","monospace").append(t(this).parent().parent().next().clone()));t.each(i.find("a"),function(e,i){t(i).replaceWith(t(i).html())}),e.document.write(i.html()),e.document.close()}},{icon:"icon-remove",callback:function(){t(this).parent().parent().next().remove(),t(this).parent().parent().next().remove(),t(this).parent().parent().remove()}}]}),this.terminal.append(i)},out:function(t,e,i){this.out_to_div(this.terminal,t,e,i)},out_to_div:function(t,e,i,n){n||"string"!=typeof e||(e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")),t.append(e),i&&this.scroll(0)},out_line:function(){var e=t("<hr/>");this.terminal.append(e),this.scroll(0)},scroll:function(t){t==e&&(t=this.options.scrollSpeed),this.terminal.animate({scrollTop:this.terminal.prop("scrollHeight")-this.terminal.height()},t)},cleanUp:function(t){setTimeout(function(){var e=5e3;setTimeout(function(){t.prev().fadeOut(500,function(){t.prev().remove()})},e),setTimeout(function(){t.next().fadeOut(500,function(){t.next().remove()})},e),setTimeout(function(){t.fadeOut(500,function(){t.remove()})},e)},1e3)},run:function(i){if("help"==i)return this.out('There is an introductory Iris tutorial available <a target="_blank" href="http://kbase.us/developer-zone/tutorials/iris/introduction-to-the-kbase-iris-interface/">on the KBase tutorials website</a>.',0,1),void 0;var n=t("<div></div>").css("white-space","pre");this.terminal.append(n),this.out_line();var a;if(a=i.match(/^log[io]n\s*(.*)/)){var s=a[1].split(/\s+/);return this.dbg(s.length),1!=s.length?(this.out_to_div(n,"Invalid login syntax."),void 0):(sid=s[0],this.client().start_session(sid,jQuery.proxy(function(){var t={kbase_sessionid:sid,success:!0,unauthenticated:!0};this.terminal.empty(),this.trigger("logout",!1),this.trigger("loggedOut"),this.trigger("loggedIn",t)},this),jQuery.proxy(function(t){this.out_to_div(n,"<i>Error on session_start:<br>"+t.error.message.replace("\n","<br>\n")+"</i>",0,1)},this)),this.scroll(),void 0)}if(a=i.match(/^authenticate\s*(.*)/)){var s=a[1].split(/\s+/);return 1!=s.length?(this.out_to_div(n,"Invalid login syntax."),void 0):(sid=s[0],this.trigger("loggedOut"),this.trigger("promptForLogin",{user_id:sid}),void 0)}if(a=i.match(/^unauthenticate/))return this.trigger("logout"),this.scroll(),void 0;if(a=i.match(/^logout/))return this.trigger("logout",!1),this.trigger("loggedOut",!1),this.scroll(),void 0;if(a=i.match(/^whatsnew/))return n.css("white-space",""),t.ajax({async:!0,dataType:"text",url:"whatsnew.html",crossDomain:!0,success:t.proxy(function(t){n.append(t),this.scroll()},this),error:t.proxy(function(t){n.append(t.responseText),this.scroll()},this),type:"GET"}),void 0;if("next"==i&&(this.tutorial.goToNextPage(),i="show_tutorial"),"back"==i&&(this.tutorial.goToPrevPage(),i="show_tutorial"),"tutorial"==i&&(this.tutorial.currentPage=0,i="show_tutorial"),"tutorial list"==i){var o=this.tutorial.list();return 0==o.length?(this.out_to_div(n,"Could not load tutorials.<br>\n",0,1),this.out_to_div(n,"Type <i>tutorial list</i> to see available tutorials.",0,1),void 0):(t.each(o,t.proxy(function(e,i){n.append(t("<a></a>").attr("href","#").append(i.title).bind("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.out_to_div(n,"Set tutorial to <i>"+i.title+"</i><br>",0,1),this.tutorial.retrieveTutorial(i.url),this.input_box.focus()},this)).append("<br>"))},this)),this.scroll(),void 0)}if("show_tutorial"==i){var r=this.tutorial.contentForCurrentPage();if(r==e)return this.out_to_div(n,"Could not load tutorial"),void 0;r=r.clone();var l={"text-align":"left","font-size":"100%"};return r.find("h1").css(l),r.find("h2").css(l),this.tutorial.currentPage>0&&r.append("<br>Type <i>back</i> to move to the previous step in the tutorial."),this.tutorial.currentPage<this.tutorial.pages.length-1&&r.append("<br>Type <i>next</i> to move to the next step in the tutorial."),r.append("<br>Type <i>tutorial list</i> to see available tutorials."),n.css("white-space",""),this.out_to_div(n,r,0,1),this.scroll(),void 0}if("commands"==i)return this.client().valid_commands(jQuery.proxy(function(i){var a={structure:{header:[],rows:[]},sortable:!0,hover:!1};jQuery.each(i,function(t,i){a.structure.rows.push([{value:i.title,colspan:2,style:"font-weight : bold; text-align : center"}]);for(var n=0;n<i.items.length;n+=2)a.structure.rows.push([i.items[n].cmd,i.items[n+1]!=e?i.items[n+1].cmd:""])});var s=t.jqElem("div").kbaseTable(a);n.append(s.$elem),this.scroll()},this)),void 0;if(a=i.match(/^questions\s*(\S+)?/)){var c=this.options.grammar.allQuestions(a[1]),p={structure:{header:[],rows:[]},sortable:!0};t.each(c,t.proxy(function(e,i){p.structure.rows.push([{value:t.jqElem("a").attr("href","#").text(i).bind("click",jQuery.proxy(function(t){t.preventDefault(),this.input_box.val(i),this.selectNextInputVariable()},this))}])},this));var u=t.jqElem("div").kbaseTable(p);return n.append(u.$elem),this.scroll(),void 0}if("clear"==i)return this.terminal.empty(),void 0;if(!this.sessionId())return this.out_to_div(n,"You are not logged in."),this.scroll(),void 0;if(this.commandHistory.push(i),this.saveCommandHistory(),this.commandHistoryPosition=this.commandHistory.length,"history"==i){var p={structure:{header:[],rows:[]},sortable:!0};jQuery.each(this.commandHistory,jQuery.proxy(function(e,i){p.structure.rows.push([e,{value:t("<a></a>").attr("href","#").text(i).bind("click",jQuery.proxy(function(t){t.preventDefault(),this.appendInput(i+" ")},this)),style:"padding-left : 10px"}])},this));var u=t.jqElem("div").kbaseTable(p);return this.out_to_div(n,u.$elem),void 0}if((a=i.match(/^!(\d+)/))&&(i=this.commandHistory.item(a[1])),a=i.match(/^cd\s*(.*)/)){var s=a[1].split(/\s+/);return 1!=s.length?(this.out_to_div(n,"Invalid cd syntax."),void 0):(dir=s[0],this.client().change_directory(this.sessionId(),this.cwd,dir,jQuery.proxy(function(t){this.cwd=t},this),jQuery.proxy(function(t){var e=t.error.message.replace("/\n","<br>\n");this.out_to_div(n,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(n)},this)),void 0)}if(a=i.match(/^(\$\S+)\s*=\s*(\S+)/))return this.variables[a[1]]=a[2],this.out_to_div(n,a[1]+" set to "+a[2]),void 0;if(a=i.match(/^alias\s+(\S+)\s*=\s*(\S+)/))return this.aliases[a[1]]=a[2],this.out_to_div(n,a[1]+" set to "+a[2]),void 0;if(a=i.match(/^upload\s*(\S+)?$/)){var h=a[1];if(this.fileBrowsers.length){var f=this.fileBrowsers[0];h&&f.data("override_filename",h),f.data("active_directory",this.cwd),f.uploadFile()}}else{if(a=i.match(/^#\s*(.+)/))return n.prev().remove(),this.out_to_div(n,t("<i></i>").text(a[1])),void 0;if(a=i.match(/^view\s+(\S+)$/)){var h=a[1];return this.client().get_file(this.sessionId(),h,this.cwd).done(t.proxy(function(e){if(h.match(/\.(jpg|gif|png)$/)){var i=t.jqElem("img").attr("src","data:image/jpeg;base64,"+btoa(e));n.append(i)}else n.append(e);this.scroll()},this)).fail(t.proxy(function(){n.append(t.jqElem("i").text("No such file")),this.cleanUp(n)},this)),void 0}if(a=i.match(/^search\s+(\S+)\s+(\S+)(?:\s*(\S+)\s+(\S+)(?:\s*(\S+))?)?/)){var g=this.options.grammar.evaluate(i),m={},v=this.options.searchURL;m.$category=a[1],m.$keyword=a[2],m.$start=a[3]||this.options.searchStart,m.$count=a[4]||this.options.searchCount;var b=a[5]||this.options.searchFilter[m.$category];for(prop in m)v=v.replace(prop,m[prop]);return t.support.cors=!0,t.ajax({type:"GET",url:v,dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},xhrFields:{withCredentials:!0},beforeSend:function(t){t.withCredentials=!0},success:t.proxy(function(e){this.out_to_div(n,t("<br>")),this.out_to_div(n,t("<i></i>").html("Command completed.")),this.out_to_div(n,t("<br>")),this.out_to_div(n,t("<span></span>").append(t("<b></b>").html(e.found)).append(" records found.")),this.out_to_div(n,t("<br>")),this.out_to_div(n,this.search_json_to_table(e.body,b)),this.search_json_to_table(e.body,b),this.scroll()},this),error:t.proxy(function(t,e,i){this.out_to_div(n,i)},this)}),void 0}if(a=i.match(/^cp\s*(.*)/)){var s=a[1].split(/\s+/);return 2!=s.length?(this.out_to_div(n,"Invalid cp syntax."),void 0):(from=s[0],to=s[1],this.client().copy(this.sessionId(),this.cwd,from,to,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(n,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(n)},this)),void 0)}if(a=i.match(/^mv\s*(.*)/)){var s=a[1].split(/\s+/);return 2!=s.length?(this.out_to_div(n,"Invalid mv syntax."),void 0):(from=s[0],to=s[1],this.client().rename_file(this.sessionId(),this.cwd,from,to,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(n,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(n)},this)),void 0)}if(a=i.match(/^mkdir\s*(.*)/)){var s=a[1].split(/\s+/);return s.length<1?(this.out_to_div(n,"Invalid mkdir syntax."),void 0):(t.each(s,t.proxy(function(e,i){this.client().make_directory(this.sessionId(),this.cwd,i,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(n,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(n)},this))},this)),void 0)}if(a=i.match(/^rmdir\s*(.*)/)){var s=a[1].split(/\s+/);return s.length<1?(this.out_to_div(n,"Invalid rmdir syntax."),void 0):(t.each(s,t.proxy(function(e,i){this.client().remove_directory(this.sessionId(),this.cwd,i,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(n,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(n)},this))},this)),void 0)}if(a=i.match(/^rm\s+(.*)/)){var s=a[1].split(/\s+/);return s.length<1?(this.out_to_div(n,"Invalid rm syntax."),void 0):(t.each(s,t.proxy(function(e,i){this.client().remove_files(this.sessionId(),this.cwd,i,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(n,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(n)},this))},this)),void 0)}if(d=i.match(/^ls\s*(.*)/)){var s=d[1].split(/\s+/),y=this;if(0==s.length)d=".";else{if(1!=s.length)return this.out_to_div(n,"Invalid ls syntax."),void 0;d=s[0]}return this.client().list_files(this.sessionId(),this.cwd,d,jQuery.proxy(function(e){var i=e[0],a=e[1],s=[];t.each(i,function(t,e){s.push({size:"(directory)",mod_date:e.mod_date,name:e.name,nameTD:e.name})}),t.each(a,t.proxy(function(e,i){s.push({size:i.size,mod_date:i.mod_date,name:i.name,nameTD:t("<a></a>").text(i.name).attr("href","#").bind("click",jQuery.proxy(function(t){t.preventDefault(),this.open_file(i.full_path)},this)),url:this.options.invocationURL+"/download/"+i.full_path+"?session_id="+this.sessionId()})},this));var o={structure:{header:[],rows:[]},sortable:!0,bordered:!1};t.each(s.sort(this.sortByKey("name","insensitively")),t.proxy(function(t,e){o.structure.rows.push([e.size,e.mod_date,{value:e.nameTD}])},this));var r=t.jqElem("div").kbaseTable(o);n.append(r.$elem),this.scroll()},this),function(t){var e=t.error.message.replace("\n","<br>\n");y.out_to_div(n,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),y.cleanUp(n)}),void 0}var g=this.options.grammar.evaluate(i);if(g!=e)if(!g.fail&&g.execute){if(i=g.execute,g.explain)return n.append(g.execute),void 0}else if(g.parsed.length&&g.fail)return n.append(t("<i></i>").html(g.error)),void 0;var k=this.uuid(),w=t("<div></div>").text(i);w.kbaseButtonControls({onMouseover:!0,context:this,controls:[{icon:"icon-ban-circle",callback:function(t,e){n.prev().remove(),n.next().remove(),n.remove(),e.trigger("removeIrisProcess",k)}}]}),this.trigger("updateIrisProcess",{pid:k,content:w}),this.client().run_pipeline(this.sessionId(),i,[],this.options.maxOutput,this.cwd,jQuery.proxy(function(e){if(this.trigger("removeIrisProcess",k),e){var i=e[0],a=e[1];if(this.refreshFileBrowser(),i.length>0&&i[0].indexOf("	")>=0){var s=t("<table></table>");jQuery.each(i,jQuery.proxy(function(e,i){var n=i.split(/\t/),a=t("<tr></tr>");jQuery.each(n,jQuery.proxy(function(e,i){a.append(t("<td></td>").html(i)),e>0&&a.children().last().css("padding-left","15px"),e<n.length-1&&a.children().last().css("padding-right","15px")},this)),s.append(a)},this)),n.append(s)}else jQuery.each(i,jQuery.proxy(function(t,e){this.out_to_div(n,e,0)},this));a.length?(jQuery.each(a,jQuery.proxy(function(e,i){this.out_to_div(n,t("<i></i>").html(i))},this)),1==a.length&&a[0].match(/^Output truncated/)||this.cleanUp(n)):this.out_to_div(n,t("<i></i>").html("<br>Command completed."))}else this.out_to_div(n,"Error running command."),this.cleanUp(n);this.scroll()},this),t.proxy(function(){this.trigger("removeIrisProcess",k)},this))}}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseIrisTutorial",version:"1.0.0",options:{configURL:"http://www.kbase.us/docs/tutorials.cfg",tutorial:"http://www.kbase.us/docs/getstarted/getstarted_iris/getstarted_iris.html"},format_tutorial_url:function(t,e,i){var n=t;return n=n.replace(/\$repo/,e),n=n.replace(/\$filespec/,i)},list:function(){var t=[];for(key in this.repos)for(var e=0;e<this.repos[key].length;e++){var i=this.repos[key][e],n=this.format_tutorial_url(this.doc_format_string,key,i.file);t.push({title:i.title,url:n})}return t.sort(this.sortByKey("title","insensitively"))},init:function(i){return this._super(i),this.pages=[],this.currentPage=-1,t.getJSON(this.options.configURL,t.proxy(function(t){this.repos=t.repos,this.doc_format_string=t.doc_format_string,this.options.tutorial==e&&(this.options.tutorial=t.default),this.options.tutorial&&this.retrieveTutorial(this.options.tutorial)},this)),this},retrieveTutorial:function(i){this.pages=[];var n=e;t.ajax({async:!0,dataType:"text",url:i,crossDomain:!0,beforeSend:function(t){n&&t.setRequestHeader("Authorization",n)},success:t.proxy(function(e){var i=t("<div></div>").append(e);t.each(i.children(),t.proxy(function(e,i){t(i).find(".example").remove(),this.pages.push(t(i))},this)),this.renderAsHTML()},this),error:t.proxy(function(t){throw this.dbg(t),t},this),type:"GET"})},renderAsHTML:function(){this.$elem.empty(),t.each(this.pages,t.proxy(function(t,e){this.$elem.append(e)},this))},lastPage:function(){return this.pages.length-1},currentPage:function(){return page=this.currentPage,this.currentPage<0&&(page=0),this.pages[page]},goToPrevPage:function(){var t=this.currentPage-1;return 0>t&&(t=0),this.currentPage=t,t},goToNextPage:function(){var t=this.currentPage+1;return t>=this.pages.length&&(t=this.pages.length-1),this.currentPage=t,t},contentForPage:function(){return 0==this.pages.length?e:this.pages[this.currentPage]},contentForCurrentPage:function(){return this.contentForPage(this.currentPage)}})}(jQuery),function(t){t.KBWidget({name:"LandingPageCard",parent:"kbaseWidget",version:"1.0.0",options:{draggable:!0,autoOpen:!0,closeOnEscape:!1,position:null,id:0},init:function(e){this._super(e),null===this.options.position&&(this.options.position={my:"center",at:"center"});var i=this;return this.options.close=function(){i.$elem.dialog("destroy"),i.$elem.remove(),t(document).trigger("kbaseCardClosed",i.options.id)},this.$elem.addClass("kblpc"),this.$elem.dialog(this.options),this},close:function(){this.$elem.dialog("close")},destroy:function(){this.$elem.dialog("destroy"),this.$elem.remove()}})}(jQuery),function(t){t.KBWidget({name:"kbaseBioCpdTable",version:"1.0.0",options:{},init:function(e){function i(e){var i=n(e),s=["id","abbrev","formula","charge","deltaG","deltaGErr","name","aliases"],o=["id","abbrev","formula","charge","deltaG","deltaGErr","name","aliases"],r=a(s,o);c.aoColumns=r,l.append('<table id="rxn-table" class="table table-striped table-bordered"></table>');var d=t("#rxn-table").dataTable(c);d.fnAddData(i)}function n(t){for(var e in t){var i=t[e];i.id='<a class="cpd-click" data-cpd="'+i.id+'">'+i.id+"</a>",i.aliases=i.aliases.join("<br>")}return t}function a(t,e){for(var i=[],n=0;n<t.length;n++)i.push({sTitle:e[n],mData:t[n]});return i}function s(){t(".cpd-click").unbind("click"),t(".cpd-click").click(function(){var e=[t(this).data("cpd")];o.trigger("cpdClick",{rxns:e})})}this._super(e);var o=this;e.auth;var r=this.$elem.kbasePanel({title:"Biochemistry Compounds",rightLabel:ws}),l=r.body(),d=new fbaModelServices("https://kbase.us/services/fba_model_services/");new workspaceService("http://kbase.us/services/workspace_service/");var c={fnDrawCallback:s,sPaginationType:"full_numbers",iDisplayLength:20,aaData:[],oLanguage:{sSearch:"Search all:"}},p=250,u=d.get_biochemistry({});return l.append('<div class="progress">              <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 3%;">              </div>            </div>'),k=1,t.when(u).done(function(e){for(var n=e.compounds,a=n.length,s=parseInt(a/p),o=[],r=0;s>r;r++){var l=n.slice(r*p,(r+1)*p-1),c=d.get_compounds({compounds:l});t.when(c).done(function(e){k+=1,o=o.concat(e);var n=100*(o.length/a)+"%";t(".progress-bar").css("width",n),k==s&&(t(".progress").remove(),i(o))})}}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseBioRxnTable",version:"1.0.0",options:{},init:function(e){function i(e){var i=n(e),s=["id","abbrev","definition","deltaG","deltaGErr","enzymes","name"],o=["id","abbrev","definition","deltaG","deltaGErr","enzymes","name"],r=a(s,o);c.aoColumns=r,l.append('<table id="rxn-table" class="table table-striped table-bordered"></table>');var d=t("#rxn-table").dataTable(c);d.fnAddData(i)}function n(t){for(var e in t){var i=t[e];i.id='<a class="rxn-click" data-rxn="'+i.id+'">'+i.id+"</a>",i.enzymes=i.enzymes.join("<br>")}return t}function a(t,e){for(var i=[],n=0;n<t.length;n++)i.push({sTitle:e[n],mData:t[n]});return i}function s(){t(".rxn-click").unbind("click"),t(".rxn-click").click(function(){var e=[t(this).data("rxn")];o.trigger("rxnClick",{rxns:e})})}this._super(e);var o=this;e.auth,o.reaction_data=[];var r=this.$elem.kbasePanel({title:"Biochemistry Reactions"}),l=r.body(),d=new fbaModelServices("https://kbase.us/services/fba_model_services/");new workspaceService("http://kbase.us/services/workspace_service/");var c={fnDrawCallback:s,sPaginationType:"full_numbers",iDisplayLength:20,aaData:[],oLanguage:{sSearch:"Search all:"}},p=500,u=d.get_biochemistry({});return l.append('<div class="progress">              <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 3%;">              </div>            </div>'),o.reaction_data.length>0?(t(".progress").remove(),i(o.reaction_data)):(k=1,t.when(u).done(function(e){for(var n=e.reactions,a=n.length,s=parseInt(a/p),r=0;s>r;r++){var l=n.slice(r*p,(r+1)*p-1),c=d.get_reactions({reactions:l});t.when(c).done(function(e){k+=1,o.reaction_data=o.reaction_data.concat(e);var n=100*(o.reaction_data.length/a)+"%";t(".progress-bar").css("width",n),k==s&&(t(".progress").remove(),i(o.reaction_data))})}})),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseRxnModal",version:"1.0.0",options:{},init:function(e){function i(e,i){e.find(".ajax-loader").remove();for(var n in i){var s=i[n],o=a(s.equation),r=t('<div id="'+s.id+'" class="tab-pane in"></div>');0!=n&&r.hide(),r.append("<h4>"+s.name+"</h4>");for(var n=0;n<o.left.length;n++){var l=o.left[n],d="http://bioseed.mcs.anl.gov/~chenry/jpeg/"+l+".jpeg";r.append('<div class="pull-left text-center">                                        <img src="'+d+'" width=150 ><br>'+l+"</div>");var c=t('<div class="pull-left text-center">+</div>');c.css("margin","30px 0 0 0"),n<o.left.length-1&&r.append(c)}var p=t('<div class="pull-left text-center"><=></div>');p.css("margin","25px 0 0 0"),r.append(p);for(var n=0;n<o.right.length;n++){var l=o.right[n],d="http://bioseed.mcs.anl.gov/~chenry/jpeg/"+l+".jpeg";r.append('<div class="pull-left text-center">                                        <img src="'+d+'" width=150 ><br>'+l+"</div>");var c=t('<div class="pull-left text-center">+</div>');c.css("margin","25px 0 0 0"),n<o.right.length-1&&r.append(c)}r.append("<br>");var u=t('<table class="table table-striped table-bordered">');for(var h in s)if("id"!=h){if("aliases"==h)var f=s[h].join("<br>");else var f=s[h];u.append("<tr><td>"+h+"</td><td>"+f+"</td></tr>")}r.append(u),e.append(r)}}function n(){}function a(t){var e={},i=t.split("=");return e.left=i[0].match(/cpd\d*/g),e.right=i[1].match(/cpd\d*/g),e}this._super(e);var s=this,o=e.auth,r=new fbaModelServices("https://kbase.us/services/fba_model_services/");new workspaceService("http://kbase.us/services/workspace_service/");var l=s.$elem.kbaseModal({title:"Reaction Info",subText:"Note: this view is currently under development."});l.loading();var d=l.body();return this.show=function(e){var a=e.rxns,s=e.model_id;l.show();var c=t('<ul id="rxn-tabs" class="sub-nav nav nav-tabs">');for(var p in a){var u=t('<a href="#'+a[p]+'" data-toggle="tab" >'+a[p]+"</a>"),h=t("<li>");0==p&&h.addClass("active"),h.append(u),c.append(h)}d.append(c);var f=r.get_reactions({reactions:a,auth:o});t.when(f).done(function(t){s?n(d,t):i(d,t)})},t("#rxn-tabs a").click(function(e){e.preventDefault(),t(this).tab("show")}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseFbaTabs",version:"1.0.0",options:{},init:function(e){function i(t){for(var e in t){var i=t[e],n=i[0].split("_")[0],a=i[0].split("_")[1];i[0]='<a class="rxn-click" data-rxn="'+n+'">'+n+"</a> ("+a+")"}return t}function n(t){var e=[];for(var i in t)e.push({sTitle:t[i]});return e}function a(){t(".rxn-click").unbind("click"),t(".rxn-click").click(function(){var e=[t(this).data("rxn")];s.trigger("rxnClick",{rxns:e})})}this._super(e);var s=this,o=e.ids,r=e.workspaces;e.auth,this.$elem.append('<div id="kbase-fba-tabs" class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">FBA Details</h4>'+o[0]+'<span class="label label-primary pull-right">'+r[0]+'</span><br>                                </div>                                <div class="panel-body"></div>                           </div>');for(var l=t("#kbase-fba-tabs .panel-body"),d=new fbaModelServices("https://kbase.us/services/fba_model_services/"),c=["Reactions","Compounds"],p=["reaction","compound"],u=t('<ul id="table-tabs" class="nav nav-tabs">                         <li class="active" >                         <a href="#'+p[0]+'" data-toggle="tab" >'+c[0]+"</a>                       </li></ul>"),h=1;h<p.length;h++)u.append('<li><a href="#'+p[h]+'" data-toggle="tab">'+c[h]+"</a></li>");l.append(u);var f=t('<div id="tab-content" class="tab-content">');f.append('<div class="tab-pane in active" id="'+p[0]+'">                             <table cellpadding="0" cellspacing="0" border="0" id="'+p[0]+'-table"                             class="table table-bordered table-striped" style="width: 100%;"></table>                        </div>');for(var h=1;h<p.length;h++){var g=t('<div class="tab-pane in" id="'+p[h]+'"> '),m=t('<table cellpadding="0" cellspacing="0" border="0" id="'+p[h]+'-table"                             class="table table-striped table-bordered">');g.append(m),f.append(g)}l.append(f),t("#table-tabs a").click(function(e){e.preventDefault(),t(this).tab("show")});var v={sPaginationType:"full_numbers",iDisplayLength:10,oLanguage:{sSearch:"Search all:"}},b=d.get_fbas({fbas:o,workspaces:r});return t(".tab-pane").append('<p class="muted loader-tables">                                   <img src="assets/img/ajax-loader.gif"> loading...</p>'),t.when(b).done(function(e){console.log(e);var s=e[0];console.log(s);var o=i(s.reactionFluxes),r=["id","Flux","lower","upper","min","max","basd","Equation"],d=n(r),c=t.extend({},v,{fnDrawCallback:a});c.aoColumns=d,c.aaData=o,l.append('<table id="reaction-table" class="table table-striped table-bordered"></table>'),t("#reaction-table").dataTable(c);var o=i(s.compoundFluxes),r=["id","Flux","lower","upper","min","max","Equation"],d=n(r),p=t.extend({},v,{fnDrawCallback:a});p.aoColumns=d,p.aaData=o,l.append('<table id="compound-table" class="table table-striped table-bordered"></table>'),t("#compound-table").dataTable(p),t(".loader-tables").remove()}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseFormulationForm",version:"1.0.0",options:{},init:function(e){function i(e){var i=t('<form class="form-horizontal" role="form">');console.log(e);for(var n in e){var a=e[n];if("input"==a.tag){var s=t('<div class="form-group">'),o=t('<label for="'+a.id+'" class="col-lg-4 control-label">'+a.label+"</label>");s.append(o);var r=t('<div class="col-lg-8">');a.required?r.append('<input type="'+a.type+'" id="'+a.id+'" class="form-control"  value="'+a.val+'" required>'):r.append('<input type="'+a.type+'" id="'+a.id+'" class="form-control" placeholder="'+a.placeholder+'">'),s.append(r),i.append(s)}else if("checkbox"==a.tag){var s=t('<div class="form-group">'),o=t('<label for="'+a.id+'" class="col-lg-4 control-label">'+a.label+"</label>");s.append(o);var r=t('<div class="col-lg-8">');r.append('<input type="'+a.type+'" id="'+a.id+'" class="form-control" placeholder="'+a.placeholder+'">'),s.append(r),i.append(s)}}return i}this._super(e);var n=this;e.auth,e.id,e.ws;var a=e.title?e.title:"Set formulation";new fbaModelServices("http://140.221.85.73:4043/"),new workspaceService("http://kbase.us/services/workspace_service/");
var s=t('<div id="kbase-formulation-form" class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">'+a+'</h4>                                </div>                                <div class="panel-body"></div>                           </div>');n.$elem.append(s);var o=s.find(".panel-body"),r=[{label:"media",tag:"input",type:"text",placeholder:"optional",id:"media"},{label:"additionalcpds",tag:"input",type:"text",placeholder:"optional",id:"additionalcpds"},{label:"prommodel",tag:"input",type:"text",placeholder:"optional",id:"prommodel"},{label:"prommodel_workspace",tag:"input",type:"text",placeholder:"optional",id:"prommodel_workspace"},{label:"media_workspace",tag:"input",type:"text",placeholder:"optional",id:"media_workspace"},{label:"objfraction",tag:"input",type:"text",placeholder:"optional",id:"objfraction"},{label:"defaultmaxflux",tag:"input",type:"text",placeholder:"required",val:"100",id:"defaultmaxflux",required:!0},{label:"defaultminuptake",tag:"input",type:"text",placeholder:"required",val:"-100",id:"defaultminuptake",required:!0},{label:"defaultmaxuptake",tag:"input",type:"text",placeholder:"required",val:"0",id:"defaultmaxuptake",required:!0},{label:"simplethermoconst",tag:"checkbox",type:"checkbox",placeholder:"optional",id:"simplethermoconst"},{label:"thermoconst",tag:"checkbox",type:"checkbox",placeholder:"optional",id:"thermoconst"},{label:"nothermoerror",tag:"checkbox",type:"checkbox",placeholder:"optional",id:"nothermoerror"},{label:"minthermoerror",tag:"checkbox",type:"checkbox",placeholder:"optional",id:"minthermoerror"}],l=i(r);return o.append(l),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseRunFba",version:"1.0.0",options:{},init:function(e){this._super(e);var i=this,n=e.ws,a=e.id,s=e.formulation,o=new fbaModelServices("http://140.221.85.73:4043/");new workspaceService("http://kbase.us/services/workspace_service/");var r=t('<div id="kbase-run-fba">'),l=t('<div class="fba-run-info"><b>Model:</b> '+a+"<br><br></div>"),d=t('<button type="button" class="btn btn-primary run-fba-btn" disabled="disabled">Run FBA</button>');return l.append(d),r.kbasePanel({title:"Run FBA",body:l.html()}),i.$elem.append(r),t(".run-fba-btn").click(function(){var e=o.queue_runfba({model:a,formulation:s,workspace:n});i.$elem.append('<p class="muted loader-rxn">                 <img src="assets/img/ajax-loader.gif"> loading...</p>'),t.when(e).done(function(t){console.log(t)})}),this}})}(jQuery),function(t,e){t.KBWidget({name:"KBaseContigBrowser",parent:"kbaseWidget",version:"1.0.0",options:{contig:null,centerFeature:null,onClickUrl:null,allowResize:!0,svgWidth:500,svgHeight:100,trackMargin:5,trackThickness:15,leftMargin:5,topMargin:20,arrowSize:10,start:1,length:1e4,embedInCard:!1,showButtons:!1,cardContainer:null,onClickFunction:null,width:550},cdmiURL:"http://kbase.us/services/cdmi_api",proteinInfoURL:"http://kbase.us/services/protein_info_service",workspaceURL:"http://kbase.us/services/workspace",tooltip:null,operonFeatures:[],$messagePane:null,init:function(e){this._super(e),null===this.options.contig,this.$messagePane=t("<div/>").addClass("kbwidget-message-pane").addClass("kbwidget-hide-message"),this.$elem.append(this.$messagePane),this.cdmiClient=new CDMI_API(this.cdmiURL),this.entityClient=new CDMI_EntityAPI(this.cdmiURL),this.proteinInfoClient=new ProteinInfo(this.proteinInfoURL),this.workspaceClient=new workspaceService(this.workspaceURL),this.render();var i=this;return this.options.showButtons&&this.$elem.KBaseContigBrowserButtons({browser:i}),this.options.onClickFunction=function(t,e){i.trigger("featureClick",{feature:e,featureElement:t})},this},render:function(){this.loading(!1),this.tooltip=d3.select("body").append("div").classed("kbcb-tooltip",!0),this.svg=d3.select(this.$elem[0]).append("svg").attr("width",this.options.svgWidth).attr("height",this.options.svgHeight).classed("kbcb-widget",!0),this.trackContainer=this.svg.append("g"),this.xScale=d3.scale.linear().domain([this.options.start,this.options.start+this.options.length]).range([0,this.options.svgWidth]),this.xAxis=d3.svg.axis().scale(this.xScale).orient("top").tickFormat(d3.format(",.0f")),this.axisSvg=this.svg.append("g").attr("class","kbcb-axis").attr("transform","translate(0, "+this.options.topMargin+")").call(this.xAxis);var e=this;return t(window).on("resize",function(){e.resize()}),null!=this.options.centerFeature&&this.setCenterFeature(this.options.centerFeature),this.setContig(),this},track:function(){var t={};return t.regions=[],t.min=1/0,t.max=-1/0,t.numRegions=0,t.addRegion=function(t){for(var e=0;e<t.length;e++){var i=Number(t[e][1]),n=Number(t[e][3]),a="+"===t[e][2]?i+n-1:i-n+1;if(i>a){var s=a;a=i,i=s}this.regions.push([i,a]),i<this.min&&(this.min=i),a>this.max&&(this.max=a),this.numRegions++}},t.hasOverlap=function(t){for(var e=0;e<t.length;e++){var i=Number(t[e][1]),n=Number(t[e][3]),a="+"===t[e][2]?i+n-1:i-n+1;if(i>a){var s=a;a=i,i=s}for(var o=0;o<this.regions.length;o++){var r=this.regions[o];if(!(i<=r[0]&&a<=r[0]||i>=r[1]&&a>=r[1]))return!0}}return!1},t},setContig:function(t){t&&this.options.contig!==t&&(this.options.centerFeature=null,this.operonFeatures=[],this.options.contig=t);var e=this;this.cdmiClient.contigs_to_lengths([this.options.contig],function(t){e.contigLength=parseInt(t[e.options.contig]),e.options.start=0,e.options.length>e.contigLength&&(e.options.length=e.contigLength)}),this.options.centerFeature?this.setCenterFeature():this.update()},setCenterFeature:function(t){t&&(this.options.centerFeature=t);var e=this;this.proteinInfoClient.fids_to_operons([this.options.centerFeature],function(t){e.operonFeatures=t[e.options.centerFeature],e.update()},function(t){e.throwError(t)})},setGenome:function(t){this.options.genomeId=t,cdmiAPI.genomes_to_contigs([t],function(){setContig(this.genomeList[t][0])})},setRange:function(t,e){this.options.start=t,this.options.length=e,this.update()},processFeatures:function(t){var i=[];i[0]=this.track();var n=[];for(fid in t)n.push(t[fid]);t=n,t.sort(function(t,e){return t.feature_location[0][1]-e.feature_location[0][1]});for(var a=0;a<t.length;a++){for(var s=t[a],o=0;o<i.length;o++)if(!i[o].hasOverlap(s.feature_location)){i[o].addRegion(s.feature_location),s.track=o;break}if(s.track===e){var r=i.length;i[r]=this.track(),i[r].addRegion(s.feature_location),s.track=r}}return this.numTracks=i.length,t},update:function(t){var e=this,i=function(t){t?(t=t[e.options.centerFeature],e.options.start=Math.max(0,Math.floor(parseInt(t.feature_location[0][1])+parseInt(t.feature_location[0][3])/2-e.options.length/2))):window.alert("Error: fid '"+e.options.centerFeature+"' not found! Continuing with original range..."),e.cdmiClient.region_to_fids([e.options.contig,e.options.start,"+",e.options.length],n)},n=function(t){e.cdmiClient.fids_to_feature_data(t,a)},a=function(t){if(e.options.centerFeature)for(var i in t)for(var n in e.operonFeatures)t[i].feature_id===e.operonFeatures[n]&&(t[i].isInOperon=1);e.renderFromRange(t)};e.options.centerFeature&&t?e.cdmiClient.fids_to_feature_data([e.options.centerFeature],i):e.cdmiClient.region_to_fids([e.options.contig,e.options.start,"+",e.options.length],n)},adjustHeight:function(){var t=this.numTracks*(this.options.trackThickness+this.options.trackMargin)+this.options.topMargin+this.options.trackMargin;t>this.svg.attr("height")&&this.svg.attr("height",t)},renderFromRange:function(t){t=this.processFeatures(t);var e=this;this.options.allowResize&&this.adjustHeight();var i=this.trackContainer.selectAll("path").data(t,function(t){return t.feature_id});i.enter().append("path").classed("kbcb-feature",!0).classed("kbcb-operon",function(t){return e.isOperonFeature(t)}).classed("kbcb-center",function(t){return e.isCenterFeature(t)}).attr("id",function(t){return t.feature_id}).on("mouseover",function(t){return d3.select(this).style("fill",d3.rgb(d3.select(this).style("fill")).darker()),e.tooltip=e.tooltip.text(t.feature_id+": "+t.feature_function),e.tooltip.style("visibility","visible")}).on("mouseout",function(){return d3.select(this).style("fill",d3.rgb(d3.select(this).style("fill")).brighter()),e.tooltip.style("visibility","hidden")}).on("mousemove",function(){return e.tooltip.style("top",d3.event.pageY+15+"px").style("left",d3.event.pageX-10+"px")}).on("click",function(t){e.options.onClickFunction?e.options.onClickFunction(this,t):e.highlight(this,t)}),i.exit().remove(),i.attr("d",function(t){return e.featurePath(t)}),e.xScale=e.xScale.domain([e.options.start,e.options.start+e.options.length]),e.xAxis=e.xAxis.scale(e.xScale),e.axisSvg.call(e.xAxis),e.resize(),this.loading(!0)},featurePath:function(t){for(var e="",i=[],n=0;n<t.feature_location.length;n++){var a=t.feature_location[n],s=this.calcXCoord(a),o=this.calcYCoord(a,t.track),r=this.calcHeight(a),l=this.calcWidth(a);i.push([s,s+l]),e+="+"===a[2]?this.featurePathRight(s,o,r,l)+" ":this.featurePathLeft(s,o,r,l)+" "}if(t.feature_location.length>1){i.sort(function(t,e){return t[0]-e[0]});for(var d=this.calcYCoord(t.feature_location[0],t.track)+this.calcHeight(t.feature_location[0])/2,n=0;n<i.length-1;n++)e+="M"+i[n][1]+" "+d+" L"+i[n+1][0]+" "+d+" Z "}return e},featurePathRight:function(t,e,i,n){var a="M"+t+" "+e;return a+=n>this.options.arrowSize?" L"+(t+(n-this.options.arrowSize))+" "+e+" L"+(t+n)+" "+(e+i/2)+" L"+(t+(n-this.options.arrowSize))+" "+(e+i)+" L"+t+" "+(e+i)+" Z":" L"+(t+n)+" "+(e+i/2)+" L"+t+" "+(e+i)+" Z"},featurePathLeft:function(t,e,i,n){var a="M"+(t+n)+" "+e;return a+=n>this.options.arrowSize?" L"+(t+this.options.arrowSize)+" "+e+" L"+t+" "+(e+i/2)+" L"+(t+this.options.arrowSize)+" "+(e+i)+" L"+(t+n)+" "+(e+i)+" Z":" L"+t+" "+(e+i/2)+" L"+(t+n)+" "+(e+i)+" Z"},calcXCoord:function(t){var e=t[1];return"-"===t[2]&&(e=t[1]-t[3]+1),(e-this.options.start)/this.options.length*this.options.svgWidth},calcYCoord:function(t,e){return this.options.topMargin+this.options.trackMargin+this.options.trackMargin*e+this.options.trackThickness*e},calcWidth:function(t){return Math.floor((t[3]-1)/this.options.length*this.options.svgWidth)},calcHeight:function(){return this.options.trackThickness},isCenterFeature:function(t){return t.feature_id===this.options.centerFeature},isOperonFeature:function(t){return t.isInOperon},calcFillColor:function(t){return t.feature_id===this.options.centerFeature?"#00F":1===t.isInOperon?"#0F0":"#F00"},highlight:function(t,e){this.recenter(e)},recenter:function(t){centerFeature=t.feature_id,this.options.onClickUrl?this.options.onClickUrl(t.feature_id):this.update(!0)},resize:function(){var t=Math.min(this.$elem.parent().width(),this.options.svgWidth);this.svg.attr("width",t)},moveLeftEnd:function(){this.options.start=0,this.update()},moveLeftStep:function(){this.options.start=Math.max(0,this.options.start-Math.ceil(this.options.length/2)),this.update()},zoomIn:function(){this.options.start=Math.min(this.contigLength-Math.ceil(this.options.length/2),this.options.start+Math.ceil(this.options.length/4)),this.options.length=Math.max(1,Math.ceil(this.options.length/2)),this.update()},zoomOut:function(){this.options.length=Math.min(this.contigLength,2*this.options.length),this.options.start=Math.max(0,this.options.start-Math.ceil(this.options.length/4)),this.options.start+this.options.length>this.contigLength&&(this.options.start=this.contigLength-this.options.length),this.update()},moveRightStep:function(){this.options.start=Math.min(this.options.start+Math.ceil(this.options.length/2),this.contigLength-this.options.length),this.update()},moveRightEnd:function(){this.options.start=this.contigLength-this.options.length,this.update()},loading:function(t){t?this.hideMessage():this.showMessage("<img src='"+this.options.loadingImage+"'/>")},showMessage:function(e){var i=t("<span/>").append(e);this.$messagePane.append(i),this.$messagePane.removeClass("kbwidget-hide-message")},hideMessage:function(){this.$messagePane.addClass("kbwidget-hide-message"),this.$messagePane.empty()},getData:function(){return{type:"Contig",id:this.options.contig,workspace:this.options.workspaceID,title:"Contig Browser"}}})}(jQuery),function(t){t.KBWidget({name:"KBaseContigBrowserButtons",parent:"kbaseWidget",version:"1.0.0",options:{direction:"horizontal",browser:null},init:function(e){if(this._super(e),null===this.options.browser)return console.log("No browser exists for the button set!"),void 0;var i=this,n=t("<div/>").addClass("btn-group").append(t("<button/>").attr("type","button").addClass("btn btn-default").append("First").click(function(){i.options.browser.moveLeftEnd()})).append(t("<button/>").attr("type","button").addClass("btn btn-default").append("Previous").click(function(){i.options.browser.moveLeftStep()})).append(t("<button/>").attr("type","button").addClass("btn btn-default").append("Zoom In").click(function(){i.options.browser.zoomIn()})).append(t("<button/>").attr("type","button").addClass("btn btn-default").append("Zoom Out").click(function(){i.options.browser.zoomOut()})).append(t("<button/>").attr("type","button").addClass("btn btn-default").append("Next").click(function(){i.options.browser.moveRightStep()})).append(t("<button/>").attr("type","button").addClass("btn btn-default").append("Last").click(function(){i.options.browser.moveRightEnd()}));return this.$elem.append(t("<div align='center'/>").append(n)),this},render:function(){return this}})}(jQuery),function(t){t.KBWidget({name:"KBaseGeneInfo",parent:"kbaseWidget",version:"1.0.0",options:{featureID:null,embedInCard:!1,auth:null},cdmiURL:"https://kbase.us/services/cdmi_api",workspaceURL:"https://kbase.us/services/workspace",init:function(t){return this._super(t),null===this.options.featureID?this:(this.cdmiClient=new CDMI_API(this.cdmiURL),this.entityClient=new CDMI_EntityAPI(this.cdmiURL),this.workspaceClient=new workspaceService(this.workspaceURL),this.render())},render:function(){var e=this;return this.$table=t("<table />").addClass("kbgo-table"),this.entityClient.get_entity_Feature([this.options.featureID],["feature_type","function","alias"],function(t){t=t[e.options.featureID],e.$table.append("<tr><td>ID</td><td>"+t.id+"</td></tr>"),e.$table.append("<tr><td>Function</td><td>"+(t.function?t.function:"Unknown function")+"</td></tr>"),t.alias&&e.$table.append("<tr><td>Alias</td><td>"+t.alias+"</td></tr>"),e.cdmiClient.fids_to_feature_data([t.id],function(t){if(t=t[e.options.featureID],t.feature_publications&&t.feature_publications.length>0){var i;if(1===t.feature_publications.length)i=e.buildPublicationString(t.feature_publications[0]);else{i="<ol>";for(var n=0;n<t.feature_publications.length;n++)i+="<li>"+e.buildPublicationString(t.feature_publications[n])+"</li>";i+="</ol>"}e.$table.append("<tr><td>Publications</td><td>"+i+"</td></tr>")}e.$elem.append(e.$table)},e.clientError)},this.clientError),this},getData:function(){return{type:"Feature",id:this.options.featureID,workspace:this.options.workspaceID,title:"Gene Info"}},buildPublicationString:function(t){return t.length<3?"":"<a href='"+t[1]+"' target='_new'>"+t[2]+"</a>"},clientError:function(){}})}(jQuery),function(t){t.KBWidget({name:"KBaseGeneInstanceInfo",parent:"kbaseWidget",version:"1.0.0",options:{featureID:null,workspaceID:null,auth:null},cdmiURL:"https://kbase.us/services/cdmi_api",workspaceURL:"https://kbase.us/services/workspace",init:function(t){return this._super(t),null===this.options.featureID?this:(this.cdmiClient=new CDMI_API(this.cdmiURL),this.entityClient=new CDMI_EntityAPI(this.cdmiURL),this.workspaceClient=new workspaceService(this.workspaceURL),this.render())},render:function(){var e=this;this.$table=t("<table />").addClass("kbgo-table"),this.cdmiClient.fids_to_feature_data([e.options.featureID],function(i){i=i[e.options.featureID],e.$table.append(e.makeRow("Function",i.feature_function)),e.$table.append(e.makeRow("Length",i.feature_length+" bp")),e.$table.append(e.makeRow("Location",t("<div/>").append(e.parseLocation(i.feature_location)).append(e.makeContigButton(i.feature_location)))),e.cdmiClient.fids_to_dna_sequences([e.options.featureID],function(t){e.$table.append(e.makeRow("GC Content",e.calculateGCContent(t[e.options.featureID]).toFixed(2)+"%")),e.cdmiClient.fids_to_protein_families([e.options.featureID],function(t){t=t[e.options.featureID],t?e.cdmiClient.protein_families_to_functions(t,function(t){var i="";if(t&&0!=t.length)for(var n in t)t.hasOwnProperty(n)&&(i+=n+": "+t[n]+"<br/>");e.$table.append(e.makeRow("Protein Families",i))},e.clientError):e.$table.append(e.makeRow("Protein Families","None found"))},e.clientError)},e.clientError)},this.clientError),this.$elem.append(this.$table);var i=t("<button/>").attr("type","button").addClass("btn btn-default").append("Domains").on("click",function(t){e.trigger("showDomains",{event:t,featureID:e.options.featureID})}),n=t("<button/>").attr("type","button").addClass("btn btn-default").append("Operons").on("click",function(t){e.trigger("showOperons",{event:t,featureID:e.options.featureID})}),a=t("<button/>").attr("type","button").addClass("btn btn-default").append("Biochemistry").on("click",function(t){e.trigger("showBiochemistry",{event:t,featureID:e.options.featureID})}),s=t("<div/>").attr("align","center").append(t("<div/>").addClass("btn-group").append(i).append(n).append(a));return this.$elem.append(s),this},makeRow:function(e,i){var n=t("<tr/>").append(t("<td />").append(e)).append(t("<td />").append(i));return n},makeContigButton:function(e){if(null===e||null===e[0][0])return"";var i=e[0][0],n=this,a=t("<button />").addClass("btn btn-default").append("Show Contig").on("click",function(t){n.trigger("showContig",{contig:i,centerFeature:n.options.featureID,event:t})});return a},calculateGCContent:function(t){var e=0;t=t.toLowerCase();for(var i=0;i<t.length;i++){var n=t[i];("g"===n||"c"===n)&&e++}return 100*(e/t.length)},parseLocation:function(t){if(0===t.length)return"Unknown";for(var e="",i=0;i<t.length;i++){var n=Number(t[i][1]),a=Number(t[i][3]),s=0;s="+"===t[i][2]?n+a-1:n-a+1,e+=n+" to "+s+" ("+t[i][2]+")<br/>"}return e},getData:function(){return{type:"Feature",id:this.options.featureID,workspace:this.options.workspaceID,title:"Gene Instance"}},clientError:function(){}})}(jQuery),function(t){t.KBWidget({name:"KBaseGenomeCardManager",parent:"KBaseCardManager",version:"1.0.0",options:{template:null,data:{}},init:function(t){return this._super(t),this.registerEvents(),this.showInitialCards(),this},showInitialCards:function(){"genome"===this.options.template&&this.showGenomeCards()},showGenomeCards:function(){return this.addNewCard("KBaseGenomeOverview",{genomeID:this.options.data.genomeID,loadingImage:"../../widgets/images/ajax-loader.gif",isInCard:!0},{my:"left top",at:"left bottom",of:"#app"}),this.addNewCard("KBaseWikiDescription",{genomeID:this.options.data.genomeID,loadingImage:"../../widgets/images/ajax-loader.gif"},{my:"left top",at:"left+330 bottom",of:"#app"}),this},registerEvents:function(){var e=this;this.registeredEvents=["featureClick","showContig","showDomains","showOperons","showBiochemistry"],t(document).on("showDomains",function(t,i){e.addNewCard("KBaseGeneDomains",{featureID:i.featureID},{my:"left top",at:"center",of:i.event})}),t(document).on("showOperons",function(t,i){e.addNewCard("KBaseGeneOperon",{featureID:i.featureID},{my:"left top",at:"center",of:i.event})}),t(document).on("showBiochemistry",function(t,i){e.addNewCard("KBaseGeneBiochemistry",{featureID:i.featureID},{my:"left top",at:"center",of:i.event})}),t(document).on("featureClick",function(t,i){e.addNewCard("KBaseGeneInfo",{featureID:i.feature.feature_id},{my:"left top",at:"center",of:i.featureElement}),e.addNewCard("KBaseGeneInstanceInfo",{featureID:i.feature.feature_id},{my:"left top",at:"center",of:i.featureElement})}),t(document).on("showContig",function(t,i){e.addNewCard("KBaseContigBrowser",{contig:i.contig,showButtons:!0,loadingImage:"../../widgets/images/ajax-loader.gif",centerFeature:i.centerFeature},{my:"left top",at:"center",of:i.event})})},destroy:function(){this._super();for(var e=0;e<this.registeredEvents.length;e++)t(document).off(registeredEvents[e])}})}(jQuery),function(t){t.KBWidget({name:"KBaseGenomeOverview",parent:"kbaseWidget",version:"1.0.0",options:{genomeID:null,workspaceID:null,loadingImage:"../../widgets/images/ajax-loader.gif",isInCard:!1},cdmiURL:"https://kbase.us/services/cdmi_api",workspaceURL:"https://kbase.us/services/workspace",init:function(e){return this._super(e),null!==this.options.genomeID?(this.$messagePane=t("<div/>").addClass("kbwidget-message-pane").addClass("kbwidget-hide-message"),this.$elem.append(this.$messagePane),this.cdmiClient=new CDMI_API(this.cdmiURL),this.entityClient=new CDMI_EntityAPI(this.cdmiURL),this.workspaceClient=new workspaceService(this.workspaceURL),this.render()):void 0},render:function(){this.showMessage("<img src='"+this.options.loadingImage+"'/>");var e=this;return this.entityClient.get_entity_Genome([this.options.genomeID],["id","scientific_name","domain","complete","dna_size","source_id","contigs","gc_content","pegs","rnas"],function(i){i=i[e.options.genomeID],e.genome=i;var n=t("<div />").append(t("<table/>").addClass("kbgo-table").append(t("<tr/>").append("<td>ID</td><td>"+i.id+"</td>")).append(t("<tr/>").append("<td>Name</td><td>"+i.scientific_name+"</td>")).append(t("<tr/>").append("<td>Domain</td><td>"+i.domain+"</td>")).append(t("<tr/>").append("<td>Complete?</td><td>"+(i.complete?"Yes":"No")+"</td>")).append(t("<tr/>").append("<td>DNA Length</td><td>"+i.dna_size+"</td>")).append(t("<tr/>").append("<td>Source ID</td><td>"+i.source_id+"</td>")).append(t("<tr/>").append("<td>Number of Contigs</td><td>"+i.contigs+"</td>")).append(t("<tr/>").append("<td>GC Content</td><td>"+Number(i.gc_content).toFixed(2)+" %"+"</td>")).append(t("<tr/>").append("<td>Protein encoding genes</td><td>"+i.pegs+"</td>")).append(t("<tr/>").append("<td>RNAs</td><td>"+i.rnas+"</td>")));e.$elem.append(n),e.options.isInCard&&e.cdmiClient.genomes_to_contigs([e.options.genomeID],function(i){e.cdmiClient.contigs_to_lengths(i[e.options.genomeID],function(i){var n=t("<select />");for(var a in i)n.append("<option id='"+a+"'>"+a+" - "+i[a]+" bp</option>");e.$elem.append(n),e.$elem.append(t("<button class='btn btn-default'>Show Contig</button>").on("click",function(i){t(e.$elem.selector+" > select option:selected").each(function(){e.trigger("showContig",{contig:t(this).attr("id"),event:i})})}))},e.rpcError)},e.rpcError)},e.rpcError),this.hideMessage(),this},getData:function(){return{type:"Genome",id:this.options.genomeID,workspace:this.options.workspaceID,title:"Genome Overview"}},showMessage:function(e){var i=t("<span/>").append(e);this.$messagePane.append(i),this.$messagePane.removeClass("kbwidget-hide-message")},hideMessage:function(){this.$messagePane.addClass("kbwidget-hide-message"),this.$messagePane.empty()},rpcError:function(t){console.log("An error occurred: "+t)}})}(jQuery),function(t){t.KBWidget({name:"KBaseWikiDescription",parent:"kbaseWidget",version:"1.0.0",options:{genomeID:null,workspaceID:null,title:"Description",maxNumChars:500,width:500,loadingImage:null},wikiScraperURL:"http://140.221.85.80:7051",cdmiURL:"https://kbase.us/services/cdmi_api",workspaceURL:"https://kbase.us/services/workspace",init:function(e){return this._super(e),null===this.options.featureID?this:(this.$messagePane=t("<div/>").addClass("kbwidget-message-pane").addClass("kbwidget-hide-message"),this.$elem.append(this.$messagePane),this.cdmiClient=new CDMI_API(this.cdmiURL),this.entityClient=new CDMI_EntityAPI(this.cdmiURL),this.workspaceClient=new workspaceService(this.workspaceURL),this.wikiClient=new WikiScraper(this.wikiScraperURL),this.render())},render:function(){this.showMessage("<img src='"+this.options.loadingImage+"'/>");var e=this;if(null!==this.options.genomeID)return this.cdmiClient.genomes_to_taxonomies([this.options.genomeID],function(i){i=i[e.options.genomeID];var n=[],a=i.pop();n.push(a);var s=a.split(" ");s.length>2,n.push(s[0]+" "+s[1]),n.concat(i.reverse()),e.wikiClient.scrape_first_hit(n,{endpoint:"dbpedia.org"},function(i){if(i.hasOwnProperty("description")&&null!=i.description){if(i.description.length>e.options.maxNumChars){i.description=i.description.substr(0,e.options.maxNumChars);var n=i.description.lastIndexOf(" ");i.description=i.description.substr(0,n)+"..."}var s,o="<p style='text-align:justify;'>"+i.description+"</p>";s=i.term===a||a===i.redirect_from?o+e.descFooter(i.wiki_uri):e.notFoundHeader(a,i.term)+o+e.descFooter(i.wiki_uri);var r="Unable to find an image. If you have one, you might consider <a href='"+i.wiki_uri+"' target='_new'>adding it to Wikipedia</a>.";null!=i.image_uri&&(r="<img src='"+i.image_uri+"' />");var l=e.uid(),d=e.uid(),c=t("<div />").addClass("tab-content").append(t("<div />").attr("id",l).addClass("tab-pane fade active in").append(s)).append(t("<div />").attr("id",d).addClass("tab-pane fade").append(r)),p=t("<a />").attr("href","#"+l).attr("data-toggle","tab").append("Description"),u=t("<a />").attr("href","#"+d).attr("data-toggle","tab").append("Image"),h=t("<ul />").addClass("nav nav-tabs").append(t("<li />").addClass("active").append(p)).append(t("<li />").append(u));e.$elem.append(h).append(c),e.hideMessage()}},e.clientError)},this.clientError),this},uid:function(){for(var t="",e=0;32>e;e++)t+=Math.floor(16*Math.random()).toString(16).toUpperCase();return t},descFooter:function(t){return"<p>[<a href='"+t+"'' target='_new'>more at Wikipedia</a>]</p>"},notFoundHeader:function(t,e){var i=t.replace(/\s+/g,"_"),n="<p><b><i>"+t+"</i> not found. You can start a new page for this genome on <a href='http://en.wikipedia.org/wiki/"+i+"' target='_new'>Wikipedia</a>.</b></p>";return e&&(n+="<p><b>Showing description for <i>"+e+"</i></b></p>"),n},showMessage:function(e){var i=t("<span/>").append(e);this.$messagePane.append(i),this.$messagePane.removeClass("kbwidget-hide-message")},hideMessage:function(){this.$messagePane.addClass("kbwidget-hide-message"),this.$messagePane.empty()},getData:function(){return{type:"Description",id:this.options.genomeID,workspace:this.options.workspaceID,title:"Organism Description"}},clientError:function(t){console.debug(t)}})}(jQuery),function(t){t.KBWidget({name:"kbaseMediaEditor",version:"1.0.0",options:{},init:function(e){function i(e,i){t(".loader-rxn").remove(),e.append("<b>Name: </b>"+i.id+" <b>pH: </b>"+i.pH+'<button class="btn btn-default pull-right edit-media">Edit</button><br><br>');var a=t('<table class="table table-striped table-bordered">');a.append("<tr><th>Compound</th><th>Concentration</th><th>min_flux</th><th>max_flux</th></tr>");for(var s in i.media_compounds)a.append("<tr><td>"+i.media_compounds[s].name+"</td>                    <td>"+i.media_compounds[s].concentration+"</td>                    <td>"+i.media_compounds[s].min_flux+"</td>                    <td>"+i.media_compounds[s].max_flux+"</td></tr>");e.append(a),t(".edit-media").click(function(){e.html(""),n(e,i)})}function n(e,n){t(".loader-rxn").remove(),e.append("<b>Name: </b>"+n.id+" <b>pH: </b>"+n.pH+'<button class="btn btn-default pull-right cancel-edit-media">Cancel</button><br><br>');var s=t('<table class="table table-striped table-bordered">');s.append("<tr><th>Compound</th><th>Concentration</th><th>min_flux</th><th>max_flux</th><th>Delete/Add</th></tr>");for(var o in n.media_compounds)s.append('<tr><td><input id="cmpds'+o+'" class="form-control" value='+n.media_compounds[o].name+'></input></td>                    <td><input id="conc'+o+'" class="form-control" value='+n.media_compounds[o].concentration+'></input></td>                    <td><input id="minflux'+o+'" class="form-control" value='+n.media_compounds[o].min_flux+'></input></td>                    <td><input id="maxflux'+o+'" class="form-control" value='+n.media_compounds[o].max_flux+'></input></td>                    <td><button id="del'+o+'" onclick="$(this).closest(&#39;tr&#39).remove()" class="form-control"><span class="glyphicon glyphicon-trash"></span></button></tr>');s.append('<tr><td><input id="addCmpds" class="form-control" placeholder="add Compound"></input></td>                    <td><input id="addConc" class="form-control" placeholder="add Concentration"></input></td>                    <td><input id="addMinflux" class="form-control" placeholder="add Minflux"></input></td>                    <td><input id="addMaxflux" class="form-control" placeholder="add Maxflux"></input></td>                    <td><button id="addRow" class="form-control"><span class="glyphicon glyphicon-plus"></span></button></tr>'),e.append(s),t("#addRow").click(function(e){e.preventDefault();var i=t("#addCmpds").val(),n=t("#addConc").val(),a=t("#addMinflux").val(),o=t("#addMaxflux").val(),r=t("[id^=cmpds]").length,l='<tr><td><input id="cmpds'+r+'" class="form-control" value="'+i+'"></input></td>                        <td><input id="conc'+r+'" class="form-control" value="'+n+'"></input></td>                        <td><input id="minflux'+r+'" class="form-control" value="'+a+'"></input></td>                        <td><input id="maxflux'+r+'" class="form-control" value="'+o+'"></input></td>                        <td><button id="del'+r+'" onclick="$(this).closest(&#39;tr&#39).remove()" class="form-control"><span class="glyphicon glyphicon-trash"></span></button></tr>';s.append(l);var d=t(this).closest("tr");d.next().after(d)}),e.append('<a class="btn btn-primary save-to-ws-btn">Save to a workspace -></a>'),a(),t(".cancel-edit-media").click(function(){e.html(""),i(e,n)})}function a(){t(".save-to-ws-btn").unbind("click"),t(".save-to-ws-btn").click(function(){var e=t("[id^=cmpds]"),i=t("[id^=conc]"),n=t("[id^=minflux]"),a=t("[id^=maxflux]"),o={media:"testSave",workspace:"jko",name:"testSave",isDefined:0,isMinimal:0,type:"unknown",compounds:[e],concentrations:[i],maxflux:[n],minflux:[a]};s.trigger("saveToWSClick",o)})}this._super(e);var s=this;e.auth;var o=e.id,r=e.ws,l=new fbaModelServices("http://140.221.85.73:4043");new workspaceService("http://kbase.us/services/workspace_service/");var d=s.$elem.kbasePanel({title:"Media Info",subText:o}),c=d.body();c.append('<p class="muted loader-rxn">                 <img src="assets/img/ajax-loader.gif"> loading...</p>');var p=l.get_media({medias:[o],workspaces:[r]});return t.when(p).done(function(t){o=t[0],i(c,o)}),t("#rxn-tabs a").click(function(e){e.preventDefault(),t(this).tab("show")}),this}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseSeqSearch",version:"1.0.0",options:{},init:function(i){function n(){if(t(".target-gnomes").show(),l==e){t(".target-genome-tbl").append('<p class="muted s-loader">                          <img src="assets/img/ajax-loader.gif"></img> loading...</p>');var i=d.all_entities_Genome(0,1e4,["scientific_name"]);t.when(i).done(function(e){t(".target-genomes").show();var i=[];for(var n in e)i.push([e[n].scientific_name,n]);p.aaData=i,l=t(".genome-selection").dataTable(p),t(".dataTables_filter input").attr("placeholder","Type a genome"),a(),t(".s-loader").remove()})}}function a(){t(".genome-selection tr").unbind("click"),t(".genome-selection tr").click(function(){var e=t(this).children("td");e.hasClass("row-selected")?e.removeClass("row-selected"):e.addClass("row-selected");var i,n,a=e.first().text(),o=e.eq(1).text();for(var r in u)u[r][0]==a&&(i=!0,n=r);i?1==u.length?u=[]:console.log(u.splice(n,n)):u.push([a,o]),s(u)})}function s(e){var i=t(".selected-genomes");i.html(""),0==i.children().length&&i.append("<h5>Selected Genomes:</h5>");for(var n in e)i.append('<div><span class="badge badge-important selected-genome">'+e[n][0]+' <a href="*">                            <i class="icon-remove"></i></a></span></div>');t(".selected-genomes").html(i.html())}function o(i){if(f==e){f=t(".results-tbl").dataTable(h).rowGrouping({iGroupingColumnIndex:1,sGroupBy:"name",bExpandableGrouping:!0,asExpandedGroups:[]});for(var n in i[0]){var a=i[0][n];a.genome=r(a.feature)}f.fnAddData(i[0])}else{f=e,f=t(".results-tbl").dataTable(h).rowGrouping({iGroupingColumnIndex:1,sGroupBy:"name",bExpandableGrouping:!0,asExpandedGroups:[]});
for(var n in i[0]){var a=i[0][n];a.genome=r(a.feature)}f.fnAddData(i[0])}}function r(t){var e=t.indexOf("."),t=t.slice(0,t.indexOf(".",e+1));return t}this._super(i);var l,d=new CDMI_EntityAPI("http://kbase.us/services/cdmi_api/"),c=new seq_search("http://140.221.85.75:7080/"),p={fnDrawCallback:a,sPaginationType:"full_numbers",iDisplayLength:10,aaData:[],bScrollInfinite:!0,bScrollCollapse:!0,sScrollY:"200px",aoColumns:[{sTitle:"Genome"},{sTitle:"KBid"}],oLanguage:{sSearch:"",sInfo:"Loaded _END_ of _TOTAL_ genomes"},fnInitComplete:function(){var e;e=t(".dataTables_scrollHeadInner").css("position","relative"),t("body.admin.selections_index").find(".dataTables_scrollBody").bind("jsp-scroll-x",function(t,i){e.css("right",i)}).jScrollPane()}};t(".target-db").change(function(){"Select KBase Genomes"==t(this).val()?n():t(".target-gnomes").hide()});var u=[],h={sPaginationType:"full_numbers",iDisplayLength:10,aoColumns:[{mData:"e_value",sTitle:"e_value"},{mData:"genome",sTitle:"genome"},{mData:"feature",sTitle:"feature"},{mData:"feature_end",sTitle:"feature_end"},{mData:"feature_length",sTitle:"feature_length"},{mData:"feature_start",sTitle:"feature_start"},{mData:"query_end",sTitle:"query_end"},{mData:"query_length",sTitle:"query_length"},{mData:"query_start",sTitle:"query_start"},{mData:"strand",sTitle:"strand"}],oLanguage:{sSearch:""},bLengthChange:!1,bPaginate:!1};t(".submit-btn").click(function(){var i=t(".seq-input").val(),n=[];for(var a in u)n.push(u[a][1]);if(f!==e&&f.fnDestroy(),t(".results-container").html(""),t(".results-container").append('<table class="results-tbl table-striped table-bordered"></table>'),t(".results-container").append('<p class="muted results-loader">                      <img src="assets/img/ajax-loader.gif"></img> loading...</p>'),console.log(n),n.length>0)var s=c.blast_one_sequence_against_a_genome(i,n);else var s=c.blast_one_sequence_against_a_genome(i,["NR"]);t.when(s).done(function(e){o(e),t(".group-item-expander").prepend('<span class="caret"></span>'),t(".results-loader").remove()})});var f;return this}})}(jQuery),function(t){t.KBWidget({name:"kbaseModelCore",version:"1.0.0",options:{},init:function(e){function i(t){n(t)}function n(e){var i=t.getJSON("assets/data/core.json"),n=f.get_models({models:c,workspaces:p,auth:u});t.when(i,n).done(function(t,i){var n=a(t[0],i,e);o(n,!0),h.rmLoading()})}function a(e,i,n,a){var o=[];for(var r in i)o.push(i[r].name);for(var r in e){var d=e[r];d.kbids={};for(var c in n){kbid=n[c];var p=l(kbid);d.kbids[p]=[]}}for(var u in i){var h=i[u];rxn_list=h.reactions;var f=[];for(var g in a)l(a[g].id)==l(h.id)&&(f=a[g]);for(var r in rxn_list){var m=rxn_list[r],v=m.reaction,b=s(e,v);if(b)for(var c in b){d=b[c];var y=t.extend({},m);y.reaction_id=v,y.gene_present=!0,y.org_name=o[u];for(var k in f.reactionFluxes){var w=f.reactionFluxes[k];w[0].slice(0,w[0].indexOf("_"))==v&&(y.flux=parseFloat(w[1]))}d.kbids[l(h.id)].push(y)}}}return e}function s(t,e){var i=[];for(var n in t){var a=t[n],s=a.rxns;if(s)for(var o in s){var r=s[o];r==e&&i.push(a)}}return i.length>0?i:void 0}function o(e,i){var n=Raphael("core-model",1e3,1500);for(var a in e){var s=e[a],o=(s.x-2)*b,r=(s.y-2)*b;if("rect"==s.shape)n.core_rect(s,o,r,y,k,i);else if("circ"==s.shape)if(n.circle(o+y/2,r+k/2,w),s.textPos){if("left"==s.textPos){var l=n.text(o,r+k/2,s.text),c=-1*l.getBBox().width/2+(w+3);l.translate(c,0)}else if("above"==s.textPos)var l=n.text(o,r-k/2,s.text);else if("below"==s.textPos)var l=n.text(o,r+k/2+k,s.text)}else{var l=n.text(o+y/2,r+k/2,s.text),c=l.getBBox().width/2+w+3;l.translate(c,0)}}for(var a=0;a<e.length;a++){var s=e[a];if("circ"==s.shape){var p=s.connects;if(p)if(p instanceof Array)for(var u=0;u<p.length;u++)for(var h=p[u],f=0;f<e.length;f++){var g=e[f];g.id==h&&n.draw_arrow(s,g)}else if(p instanceof Object)for(var m in p){if("curve"==m&&n.draw_curve(s),"dashed"==m)for(var u=0;u<p.dashed.length;u++)for(var h=p.dashed[u],f=0;f<e.length;f++){var g=e[f];g.id==h&&n.draw_arrow(s,g,"--")}if("conns"==m)for(var u=0;u<p.conns.length;u++)for(var h=p.conns[u],f=0;f<e.length;f++){var g=e[f];g.id==h&&n.draw_arrow(s,g)}}}}return t(".model-rxn").unbind("click"),t(".model-rxn").click(function(){var e=t(this).data("rxns").split(",");d.trigger("rxnClick",{rxns:e})}),n}function r(t,e){var i="";return i+="<b>Rxn:</b> "+t.reaction+"<br>",i+="<b>Eq:</b> "+t.definition+"<br>",i+="<b>Flux Value:</b> "+e+"<br><br>"}function l(t){var e=t.indexOf("."),t=t.slice(0,t.indexOf(".",e+1));return t}this._super(e);var d=this,c=e.ids,p=e.workspaces,u=e.auth,h=this.$elem.kbasePanel({title:"Model Info",rightLabel:p[0],subText:c[0],body:'<div id="core-model"></div>'});h.loading(),h.body();var f=new fbaModelServices("https://kbase.us/services/fba_model_services/");new workspaceService("http://kbase.us/services/workspace_service/");var g=.001,m=["#731d1d","#8a2424","#b35050","#d05060","#f28e8e"],v="#8bc7e5",b=50,y=.8*b,k=.2*b,w=5;return i(c),Raphael.fn.core_rect=function(e,i,n,a,s,o){var l=e.kbids,d=0;for(var c in l)d++;var p=a/d;if(l){var c=0;for(var u in l){var h=this.rect(i+c*p,n,p,s);h.node.setAttribute("class","model-rxn"),h.node.setAttribute("data-rxns",e.rxns.join(","));var f=l[u],b=!1,y=0,k=!1,w="";for(var x in f){var _=f[x];if(1==_.gene_present)var k=!0;y+=_.flux,w+=r(_,_.flux)}if(Math.abs(y)>g)var b=!0;if(l[u][0])var C=l[u][0].org_name;else var C="";if(t(h.node).popover({content:w,title:C,trigger:"hover",html:!0,container:"body",placement:"bottom"}),b&&o){if(!f[0])continue;if(Math.abs(y)>=100)var I=m[0];else if(Math.abs(y)>=50)var I=m[1];else if(Math.abs(y)>=10)var I=m[2];else if(Math.abs(y)>=5)var I=m[3];else var I=m[4];h.attr({fill:I})}else k?h.attr({fill:v}):h.attr({fill:"white","stroke-width":.5});h.data("rxns",e.rxns),c++}}},Raphael.fn.draw_curve=function(t){var e=t.connects.curve.path;if("below"==t.pathPos){var i=(e[0][0]-2)*b+y/2,n=(e[0][1]-2)*b+3*w;(e[1][0]-2)*b+y/2;var a=(e[1][1]-2)*b+y/2,s=(e[2][0]-2)*b+y/2,o=(e[2][1]-2)*b+3*w}else if("above"==t.pathPos){var i=(e[0][0]-2)*b+y/2,n=(e[0][1]-2)*b-w;(e[1][0]-2)*b+y/2;var a=(e[1][1]-2)*b,s=(e[2][0]-2)*b+y/2,o=(e[2][1]-2)*b-w}var r=this.path("M"+i+","+n+"C"+i+","+a+" "+s+","+a+" "+s+","+o);return r.toBack(),r},Raphael.fn.draw_curved_arrow=function(t){var e=t.connects.curve.path;if("below"==t.pathPos)var i=e[0][0]*b-2+y/2,n=e[0][1]*b-2+3*w,a=e[1][0]*b-2+y/2,s=e[1][1]*b-2+y/2,o=e[2][0]*b-2+y/2,r=e[2][1]*b-2+3*w;else if("above"==t.pathPos)var i=(e[0][0]-2)*b+y/2,n=(e[0][1]-2)*b-w,a=(e[1][0]-2)*b+y/2,s=(e[1][1]-2)*b,o=(e[2][0]-2)*b+y/2,r=(e[2][1]-2)*b-w;var l=Math.atan2(i-a,s-n);l=360*(l/(2*Math.PI));var d=this.path("M"+a+" "+s+" L"+(a-size)+" "+(s-size)+" L"+(a-size)+" "+(s+size)+" L"+a+" "+s).rotate(90+l,a,s),c=this.path("M"+i+" "+n+" L"+a+" "+s);return c.attr({stroke:"#444","stroke-dasharray":style}),d.attr({stroke:"#444",fill:"#666","stroke-dasharray":style}),c.data("type","path"),d.data("type","path"),c.toBack(),d.toBack(),this.path("M"+i+","+n+"C"+i+","+s+" "+o+","+s+" "+o+","+r)},Raphael.fn.draw_arrow=function(t,e,i){if(e.y<t.y)var n=(t.x-2)*b+y/2,a=(t.y-2)*b+k/2-10,s=(e.x-2)*b+y/2,o=(e.y-2)*b+k/2+10;else if(e.y>t.y)var n=(t.x-2)*b+y/2,a=(t.y-2)*b+k/2+10,s=(e.x-2)*b+y/2,o=(e.y-2)*b+k/2-10;if(e.x<t.x&&e.y>t.y)var n=(t.x-2)*b+y/2-10,a=(t.y-2)*b+k/2+10,s=(e.x-2)*b+y/2+10,o=(e.y-2)*b+k/2-10;else if(e.x<t.x&&e.y<t.y)var n=(t.x-2)*b+y/2-10,a=(t.y-2)*b+k/2-10,s=(e.x-2)*b+y/2+10,o=(e.y-2)*b+k/2+10;else if(e.x>t.x&&e.y>t.y)var n=(t.x-2)*b+y/2+10,a=(t.y-2)*b+k/2+10,s=(e.x-2)*b+y/2-10,o=(e.y-2)*b+k/2-10;else if(e.x>t.x&&e.y<t.y)var n=(t.x-2)*b+y/2+10,a=(t.y-2)*b+k/2-10,s=(e.x-2)*b+y/2-10,o=(e.y-2)*b+k/2+10;else if(e.x<t.x&&e.y==t.y)var n=(t.x-2)*b+y/2-10,a=(t.y-2)*b+k/2,s=(e.x-2)*b+y/2+10,o=(e.y-2)*b+k/2;else if(e.x>t.x&&e.y==t.y)var n=(t.x-2)*b+y/2+10,a=(t.y-2)*b+k/2,s=(e.x-2)*b+y/2-10,o=(e.y-2)*b+k/2;return i?this.arrow(n,a,s,o,4,i):this.arrow(n,a,s,o,4)},Raphael.fn.arrow=function(t,e,i,n,a,s){var o=Math.atan2(t-i,n-e);o=360*(o/(2*Math.PI));var r=this.path("M"+i+" "+n+" L"+(i-a)+" "+(n-a)+" L"+(i-a)+" "+(n+a)+" L"+i+" "+n).rotate(90+o,i,n),l=this.path("M"+t+" "+e+" L"+i+" "+n);return l.attr({stroke:"#444","stroke-dasharray":s}),r.attr({stroke:"#444",fill:"#666","stroke-dasharray":s}),l.data("type","path"),r.data("type","path"),l.toBack(),r.toBack(),l},d}})}(jQuery),function(t){t.KBWidget({name:"kbaseModelMeta",version:"1.0.0",options:{},init:function(e){this._super(e);var i=e.ids,n=e.workspaces;e.auth;var a=this.$elem.kbasePanel({title:"Model Info",rightLabel:n[0],subText:i[0]});a.loading();var s=a.body();new fbaModelServices("https://kbase.us/services/fba_model_services/");var o=new workspaceService("http://kbase.us/services/workspace_service/"),r=o.get_objectmeta({type:"Model",workspace:n[0],id:i[0]});return t.when(r).done(function(e){console.log(e);for(var i=["ID","Type","Moddate","Instance","Command","Last Modifier","Owner","Workspace","Ref"],n=t('<table class="table table-striped table-bordered"                                   style="margin-left: auto; margin-right: auto;"></table>'),o=0;o<e.length-2;o++)n.append("<tr><td>"+i[o]+"</td>                               <td>"+e[o]+"</td></tr>");a.rmLoading(),s.append(n)}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseModelOpts",version:"1.0.0",options:{},init:function(t){this._super(t);var e=t.id,i=t.workspace;t.auth;var n=this.$elem.kbasePanel({title:"Model Options",rightLabel:i,subText:e}),a=n.body();return a.append('<a class="app-icon" href="http://140.221.84.128/#models?tab=model-selection&kbids='+e+"&ws="+i+'" target="_blank">                        <img src="http://www.kbase.us/files/6313/6148/9465/model_icon.png" width=30 >                    </a>                    <a href="http://140.221.84.128/#models?tab=model-selection&kbids='+e+"&ws="+i+'" target="_blank">Add to Model Viewer</a>'),a.append("<br><br>"),a.append('<a href="#/run-fba/'+i+"/"+e+'">Run FBA</a> <span class="glyphicon glyphicon-arrow-right"></span>'),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseModelTable",version:"1.0.0",options:{},init:function(e){function i(t){for(var e in t){var i=t[e];i[0]='<a class="model-click" data-model="'+i[0]+'">'+i[0]+"</a>"}return t}function n(t){var e=[];for(var i in t)e.push({sTitle:t[i]});return e}function a(){t(".model-click").unbind("click"),t(".model-click").click(function(){var e=t(this).data("model");s.trigger("modelClick",{model:e})})}this._super(e);var s=this,o=e.auth,r=e.ws,l=this.$elem.kbasePanel({title:"Model Info",rightLabel:r});l.loading();var d=l.body();new fbaModelServices("https://kbase.us/services/fba_model_services/");var c=new workspaceService("http://kbase.us/services/workspace_service/"),p={fnDrawCallback:a,sPaginationType:"full_numbers",iDisplayLength:20,aaData:[],oLanguage:{sSearch:"Search all:"}},u=c.list_workspace_objects({workspace:r,type:"Model",auth:o});return d.append('<p class="muted loader-table">                                   <img src="assets/img/ajax-loader.gif"> loading...</p>'),t.when(u).done(function(e){var a=i(e),s=["id","Type","Modified","Command","Something?","Owner"],o=n(s);p.aoColumns=o,d.append('<table id="rxn-table" class="table table-striped table-bordered"></table>');var r=t("#rxn-table").dataTable(p);r.fnAddData(a),t(".loader-table").remove()}),this}})}(jQuery),function(t,e){t.KBWidget({name:"kbaseModelTabs",version:"1.0.0",options:{},init:function(i){function n(t){for(var e in t){var i=t[e];i.reaction='<a class="rxn-click" data-rxn="'+i.reaction+'">'+i.reaction+"</a> ("+i.compartment+")",i.features=i.features.join("<br>")}return t}function a(t,e){for(var i=[],n=0;n<t.length;n++)i.push({sTitle:e[n],mData:t[n]});return i}function s(){t(".rxn-click").unbind("click"),t(".rxn-click").click(function(){var e=[t(this).data("rxn")];r.trigger("rxnClick",{rxns:e})})}function o(i){function n(){t(".show-gap").tooltip({html:!0,title:'show more info                     <i class="icon-list-alt icon-white history-icon"></i>',placement:"right"}),t(".show-gap").unbind("click"),t(".show-gap").click(function(){var e=t(this).data("ref"),i=t(this).closest("tr")[0];s.fnIsOpen(i)?s.fnClose(i):(s.fnOpen(i,"","info_row"),t(this).closest("tr").next("tr").children(".info_row").append('<p class="muted loader-gap-sol">                             <img src="assets/img/ajax-loader.gif"> loading possible solutions...</p>'),a(i,e))})}function a(e,i){var n=u.get_gapfills({gapfills:[i],workspaces:["NO_WORKSPACE"],auth:USER_TOKEN});t.when(n).done(function(n){var n=n[0],a=n.solutions,s=t('<div class="gap-selection-list">');for(var o in a){var r=a[o],l=r.id;"1"==r.integrated?s.append('<div> <a type="button" class="gap-sol"                                data-toggle="collapse" data-target="#'+i+l.replace(/\./g,"_")+'" >'+l+'</a> <span class="caret" style="vertical-align: middle;"></span>                                <div class="radio inline gapfill-radio">                                     <input type="radio" name="gapfillRadios" id="gapfillRadio'+o+'" value="integrated" checked>                                </div> <span class="label integrated-label">Integrated</span>                                    <button data-gapfill="'+i+l+'"                                     class="hide btn btn-primary btn-mini integrate-btn">Integrate</button>                                  </div>'):s.append('<div> <a type="button" class="gap-sol"                                data-toggle="collapse" data-target="#'+i+l.replace(/\./g,"_")+'" >'+l+'</a> <span class="caret" style="vertical-align: middle;"></span>                                <div class="radio inline gapfill-radio">                                     <input type="radio" name="gapfillRadios" id="gapfillRadio'+o+'" value="unitegrated">                                </div>                                <button data-gapfill="'+i+l+'"                                 class="hide btn btn-primary btn-mini integrate-btn">Integrate</button>                                 </div>');var d=r.reactionAdditions;if(0==d.length)var c=t("<p>No reaction additions in this solution</p>");else{var c=t('<table class="gapfill-rxn-info">'),p=t("<tr><th>Reaction</th>                                                <th>Equation</th></tr>");c.append(p);for(var h in d){var f=d[h],g=t("<tr>");g.append('<td><a class="gap-rxn" data-rxn="'+f[0]+'" >'+f[0]+"</a></td>"),g.append("<td>"+f[4]+"</td>"),c.append(g)}}var m=t('<div id="'+i+l.replace(/\./g,"_")+'" class="collapse">');m.append(c),s.append(m)}t(e).next().children("td").append(s.html()),t(".loader-gap-sol").remove(),t("input[name='gapfillRadios']").unbind("change"),t("input[name='gapfillRadios']").change(function(){t(".integrate-btn").hide(),t(this).parent().next(".integrate-btn").show()}),t(".gap-sol").unbind("click"),t(".gap-sol").click(function(){var e=t(this).next("span");e.hasClass("caret")?(e.removeClass("caret"),e.addClass("caret-up")):(e.removeClass("caret-up"),e.addClass("caret"))}),t(".integrate-btn").unbind("click"),t(".integrate-btn").click(function(){t(this).after('<span class="muted loader-integrating" >                               <img src="assets/img/ajax-loader.gif"> loading...</span>');var e=t(this).data("gapfill"),i=modelspace.active_kbids()[0],n=u.integrate_reconciliation_solutions({model:i,model_workspace:ws,gapfillSolutions:[e],gapgenSolutions:[""],auth:USER_TOKEN,workspace:ws});t.when(n).done(function(e){alert("NOTE: This functionality is still under development\n",e),t(".loader-integrating").remove()})}),t(".gap-rxn").click(function(){var e=t(this).data("rxn");reaction_view([e])})})}var s=e,o={sPaginationType:"full_numbers",fnDrawCallback:n,iDisplayLength:20,aoColumns:[{sTitle:"Integrated",sWidth:"10%"},{bVisible:!1},{sTitle:"Ref",sWidth:"40%"},{sTitle:"Media"},{sTitle:"Media WS",sWidth:"20%"},{bVisible:!1},{bVisible:!1}],oLanguage:{sSearch:"Search all:",sEmptyTable:"No gapfill objects for this model."}},r=function(e){s=e?t("#gapfill-table").dataTable(e):t("#gapfill-table").dataTable(o)};this.load_table=function(t){var e=t[0].integrated_gapfillings;for(var i in e){var n=e[i];6==n.length&&(n.splice(0,0,"Yes"),n.splice(2,1,'<a class="show-gap" data-ref="'+n[2]+'" >'+n[2]+"</a>"))}var a=t[0].unintegrated_gapfillings;for(var i in a){var l=a[i];6==l.length&&(l.splice(0,0,"No"),l.splice(2,1,'<a class="show-gap" data-ref="'+l[2]+'" >'+l[2]+"</a>"))}if(a)var d=a.concat(e);var d=e;console.log(d),o.aaData=d,r(),s.fnSort([[1,"desc"]])},this.load_table(i)}this._super(i);var r=this,l=i.ids,d=i.workspaces;i.auth;var c=this.$elem.kbasePanel({title:"Model Details",rightLabel:d[0],subText:l[0]}),p=c.body(),u=new fbaModelServices("https://kbase.us/services/fba_model_services/");new workspaceService("http://kbase.us/services/workspace_service/");for(var h=["Reactions","Compounds","Compartment","Biomass","Gapfill","Gapgen"],f=["reaction","compound","compartment","biomass","gapfill","gapgen"],g=t('<ul id="table-tabs" class="nav nav-tabs">                         <li class="active" >                         <a href="#'+f[0]+'" data-toggle="tab" >'+h[0]+"</a>                       </li></ul>"),m=1;m<f.length;m++)g.append('<li><a href="#'+f[m]+'" data-toggle="tab">'+h[m]+"</a></li>");p.append(g);var v=t('<div id="tab-content" class="tab-content">');v.append('<div class="tab-pane in active" id="'+f[0]+'">                             <table cellpadding="0" cellspacing="0" border="0" id="'+f[0]+'-table"                             class="table table-bordered table-striped" style="width: 100%;"></table>                        </div>');for(var m=1;m<f.length;m++){var b=t('<div class="tab-pane in" id="'+f[m]+'"> '),y=t('<table cellpadding="0" cellspacing="0" border="0" id="'+f[m]+'-table"                             class="table table-striped table-bordered">');b.append(y),v.append(b)}p.append(v),t("#table-tabs a").click(function(e){e.preventDefault(),t(this).tab("show")});var k={sPaginationType:"full_numbers",iDisplayLength:5,aaData:[],oLanguage:{sSearch:"Search all:"}},w=u.get_models({models:l,workspaces:d});return t(".tab-pane").not("#overview").append('<p class="muted loader-tables">                                   <img src="assets/img/ajax-loader.gif"> loading...</p>'),t.when(w).done(function(e){model=e[0],console.log(model);var i=model.compartments,r=["id","index","name","pH","potential"],l=["id","index","name","pH","potential"],d=a(r,l);k.aoColumns=d;var c=t("#compartment-table").dataTable(k);c.fnAddData(i);var i=n(model.reactions),r=["reaction","definition","features","name"],l=["reaction","equation","features","name"],d=a(r,l),p=t.extend({},k,{fnDrawCallback:s});p.aoColumns=d;var c=t("#reaction-table").dataTable(p);c.fnAddData(i);var i=model.compounds,r=["compartment","compound","name"],l=["compartment","compound","name"],d=a(r,l);k.aoColumns=d;var c=t("#compound-table").dataTable(k);c.fnAddData(i);var i=model.biomasses,r=["definition","id","name"],l=["definition","id","name"],d=a(r,l);k.aoColumns=d;var c=t("#biomass-table").dataTable(k);c.fnAddData(i),o(e),model.gapgen;var r=["id","index","name","pH","potential"],l=["id","index","name","pH","potential"],d=a(r,l);k.aoColumns=d;var c=t("#gapgen-table").dataTable(k);t(".loader-tables").remove()}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseSimpleWSSelect",version:"1.0.0",options:{},init:function(e){function i(e,i){e.find(".loader").remove();var a=t("<form>"),s=t('<div class="col-xs-6 col-md-4">                <p>Enter new name:</p>                <p><input class="form-control" placeholder="new name"></input>                <p>Enter new pH:</p><p><input class="form-control" placeholder="pH"></input></p>                <p>Save to Workspace:</p></div><br/>'),r=t('<select class="form-control simple-ws-select"></select>');for(var l in i)i[l][0]==o?r.append('<option selected="selected">'+i[l][0]+"</option>"):r.append("<option>"+i[l][0]+"</option>");a.append(s),a.append(r),e.append(a),n()}function n(){t(".select-ws-btn").unbind("click"),t(".select-ws-btn").click(function(){alert("yo");var e=t(".simple-ws-select").val(),i={ws:e,name:newMediaName};a.trigger("selectedWS",i)})}this._super(e);var a=this,s=e.auth,o=e.defaultWS,r=new workspaceService("http://kbase.us/services/workspace_service/");return this.show=function(){var e=a.$elem.kbaseModal({title:"Save to a Workspace"}),n=e.body('<p class="muted loader">                     <img src="assets/img/ajax-loader.gif"> loading...</p>');e.buttons([{text:"Close"},{text:"Save",color:"primary"}]),e.show();var o=r.list_workspaces({auth:s});t.when(o).done(function(t){i(n,t)})},this}})}(jQuery),function(t){t.KBWidget({name:"kbaseWSFbaTable",version:"1.0.0",options:{},init:function(e){function i(t){for(var e in t){var i=t[e];i[0]='<a class="fba-click" data-fba="'+i[0]+'">'+i[0]+"</a>"}return t}function n(t){var e=[];for(var i in t)e.push({sTitle:t[i]});return e}function a(){t(".fba-click").unbind("click"),t(".fba-click").click(function(){var e=t(this).data("fba");s.trigger("fbaClick",{fba:e})})}this._super(e);var s=this,o=e.auth,r=e.ws;this.$elem.append('<div id="kbase-ws-fba-table" class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">FBA Objects</h4>                                    <span class="label label-primary pull-right">'+r+'</span><br>                                </div>                                <div class="panel-body"></div>                           </div>');var l=t("#kbase-ws-fba-table .panel-body");new fbaModelServices("https://kbase.us/services/fba_model_services/");var d=new workspaceService("http://kbase.us/services/workspace_service/"),c={fnDrawCallback:a,sPaginationType:"full_numbers",iDisplayLength:20,aaData:[],oLanguage:{sSearch:"Search all:"}},p=d.list_workspace_objects({workspace:r,type:"FBA",auth:o});return l.append('<p class="muted loader-table">                                   <img src="assets/img/ajax-loader.gif"> loading...</p>'),t.when(p).done(function(e){var a=i(e),s=["id","Type","Modified","Something","Command","Owner"],o=n(s);c.aoColumns=o,l.append('<table id="ws-fba-table" class="table table-striped table-bordered"></table>');var r=t("#ws-fba-table").dataTable(c);r.fnAddData(a),t(".loader-table").remove()}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseWSMediaTable",version:"1.0.0",options:{},init:function(e){function i(t){for(var e in t){var i=t[e];i[0]='<a class="media-click" data-media="'+i[0]+'">'+i[0]+"</a>"}return t}function n(t){var e=[];for(var i in t)e.push({sTitle:t[i]});return e}function a(){t(".media-click").unbind("click"),t(".media-click").click(function(){var e=t(this).data("media");s.trigger("mediaClick",{media:e})}),t(".select-ws").unbind("click"),t(".select-ws").click(function(){var e=t(this).data("ws");s.trigger("selectWS",{ws:e})})}this._super(e);var s=this;e.auth;var o=e.ws,r=e.title?e.title:"Biochemistry Media";e.selectable;var l=t('<div id="kbase-ws-media-table" class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">'+r+'</h4>                                    <span class="label label-primary pull-right select-ws"                                     data-ws="'+o+'">'+o+'</span><br>                                </div>                                <div class="panel-body"></div>                           </div>');this.$elem.append(l);var d=l.find(".panel-body");new fbaModelServices("https://kbase.us/services/fba_model_services/");var c=new workspaceService("http://kbase.us/services/workspace_service/"),p={fnDrawCallback:a,sPaginationType:"full_numbers",iDisplayLength:20,aaData:[],oLanguage:{sSearch:"Search all:"}},u=c.list_workspace_objects({workspace:o,type:"Media"});return d.append('<p class="muted loader-table">                                   <img src="assets/img/ajax-loader.gif"> loading...</p>'),t.when(u).done(function(e){var a=i(e),s=["id","abbrev","formula","charge","deltaG","deltaGErr","name","aliases"],o=n(s);p.aoColumns=o,d.append('<table id="media-table2" class="table table-striped table-bordered"></table>');var r=t("#media-table2").dataTable(p);r.fnAddData(a),t(".loader-table").remove()}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseWSModelTable",version:"1.0.0",options:{},init:function(e){function i(t){for(var e in t){var i=t[e];i[0]='<a class="model-click" data-model="'+i[0]+'">'+i[0]+"</a>"}return t}function n(t){var e=[];for(var i in t)e.push({sTitle:t[i]});return e}function a(){t(".model-click").unbind("click"),t(".model-click").click(function(){var e=t(this).data("model");s.trigger("modelClick",{model:e})})}this._super(e);var s=this,o=e.auth,r=e.ws,l=this.$elem.kbasePanel({title:"Model Info",rightLabel:r});l.loading();var d=l.body();new fbaModelServices("https://kbase.us/services/fba_model_services/");var c=new workspaceService("http://kbase.us/services/workspace_service/"),p={fnDrawCallback:a,sPaginationType:"full_numbers",iDisplayLength:20,aaData:[],oLanguage:{sSearch:"Search all:"}},u=c.list_workspace_objects({workspace:r,type:"Model",auth:o});return t.when(u).done(function(e){var a=i(e),s=["id","Type","Modified","Command","Something?","Owner"],o=n(s);p.aoColumns=o,d.append('<table id="rxn-table" class="table table-striped table-bordered"></table>');var r=t("#rxn-table").dataTable(p);r.fnAddData(a),l.rmLoading()}),this}})}(jQuery),function(t){t.KBWidget({name:"kbaseWSObjectTable",version:"1.0.0",options:{},init:function(e){function i(t,e){e.fnSettings().aoColumns[t].bVisible,e.fnSetColumnVis(t,!0)}function n(t,e){e.fnSettings().aoColumns[t].bVisible,e.fnSetColumnVis(t,!1)}function a(){t(".view-options").unbind("click"),t(".view-options").click(function(){var e=t(this).data("workspace"),i=t(this).data("type"),n=t(this).data("id");console.log(e,i,n),"Genome"==i?window.location.hash="/genomes/"+e+"/"+n:"Model"==i?window.location.hash="/models/"+e+"/"+n:"FBA"==i?window.location.hash="/fbas/"+e+"/"+n:"Media"==i&&(window.location.hash="/media/"+e+"/"+n)})}function s(e){function i(){a.setButtons(null,"Close"),a.off("submit"),a.on("submit",function(){a.hide()}),a.unlock()}var n=e[0][2],a=new v;a.setTitle("Copy "+e.length+" Object(s)"),a.setContent('<div><h4 style="margin-top: 0px;"></h4><table style="margin-left: auto; margin-right: auto; text-align: right; width: 300px;"><tr><td>Workspace:</td><td id="clone-into-cell"></td></tr></tr></table></div>'),t("#clone-permission").css({width:"164px"});var s=t("#clone-into-cell"),o=t('<input class="form-control" type="text" id="clone-id" style="width: 150px" />'),r=t('<select class="form-control" style="width: 164px">'),d=t("#clone-permission-row");s.append(o).append(r),isNew=!1,o.hide(),d.hide(),r.show(),o.keypress(function(t){13==t.which&&a.submit()});for(var c=0;c<workspaces.length;c++){var p=workspaces[c];p!==n&&("a"===p.user_permission||"w"===p.user_permission)&&r.append('<option value="'+p.id+'">'+p.id+"</option>")}a.setButtons("Cancel","Copy"),a.on("submit",function(){for(var n in e){var s,o=e[n],d=o[0],c=o[2],p=o[3],u=l(c);s=r.find("option").filter(":selected").val(),a.alertHide(),a.lock(),a.cover('<img src="assets/img/ajax-loader.gif" /><br />This may take a while...');var h=[],f=u.copyObject(p,d,s,d);h.push(f)}t.when.apply(t,h).done(function(t){t.getAllObjectsMeta().done(function(e){t.objectData=e,a.coverAlert("<strong>Success</strong><br />Done copying objects.","success"),a.off("hidden"),a.on("hidden",function(){for(var t,e=0;e<workspaces.length;e++){var i=workspaces[e];if(i.id===s){t=i;break}}a.delete(),window.location.reload()}),i()}).fail(function(){a.coverAlert("<strong>Error</strong><br />Could not get workspace '"+u.id+"'","error"),i()})}).fail(function(){a.coverAlert("<strong>Error</strong><br />Could not clone workspace '"+u.id+"'","error"),i()})}),a.show()}function o(e){function i(){a.setButtons(null,"Close"),a.off("submit"),a.on("submit",function(){a.hide()}),a.unlock()}var n=e[0][2],a=new v;a.setTitle("Move "+e.length+" Object(s)"),a.setContent('<div><h4 style="margin-top: 0px;"></h4><table style="margin-left: auto; margin-right: auto; text-align: right; width: 300px;"><tr><td>Workspace:</td><td id="clone-into-cell"></td></tr></tr></table></div>'),t("#clone-permission").css({width:"164px"});var s=t("#clone-into-cell"),o=t('<input class="form-control" type="text" id="clone-id" style="width: 150px" />'),r=t('<select class="form-control" style="width: 164px">'),d=t("#clone-permission-row");s.append(o).append(r),isNew=!1,o.hide(),d.hide(),r.show(),o.keypress(function(t){13==t.which&&a.submit()});for(var c=0;c<workspaces.length;c++){var p=workspaces[c];p!==n&&("a"===p.user_permission||"w"===p.user_permission)&&r.append('<option value="'+p.id+'">'+p.id+"</option>")}a.setButtons("Cancel","Move"),a.on("submit",function(){for(var n in e){var s,o=e[n],d=o[0],c=o[2],p=o[3],u=l(c);s=r.find("option").filter(":selected").val(),a.alertHide(),a.lock(),a.cover('<img src="assets/img/ajax-loader.gif" /><br />This may take a while...');var h=[],f=u.moveObject(p,d,s,d);h.push(f)}t.when.apply(t,h).done(function(t){t.getAllObjectsMeta().done(function(e){t.objectData=e,a.coverAlert("<strong>Success</strong><br />Moved objects into '"+t.id+"'","success"),a.off("hidden"),a.on("hidden",function(){for(var t,e=0;e<workspaces.length;e++){var i=workspaces[e];if(i.id===s){t=i;break}}a.delete(),window.location.reload()}),i()}).fail(function(){a.coverAlert("<strong>Error</strong><br />Could not get workspace '"+u.id+"'","error"),i()})}).fail(function(){a.coverAlert("<strong>Error</strong><br />Could not clone workspace '"+u.id+"'","error"),i()})}),a.show()}function r(e){var i=new v;i.setTitle("Delete "+e.length+" object(s)?"),i.setContent("<span>Are you sure you want to delete these "+e.length+" object(s)?<br>"+"This action is irreversible.</span>"),i.alert("<strong>Warning</strong><br />All selected objects in this workspace will be deleted!","warning"),i.setButtons("No","Yes"),i.on("submit",function(){i.alertHide(),i.lock(),i.cover('<img src="assets/img/ajax-loader.gif" /><br />This may take a while...'),del_objs=[];for(var n in k){var a=e[n],s=a[0],o=a[2],r=a[3];del_objs.push(s);var d=l(o),c=[],p=d.deleteObj(r,s);c.push(p)}t.when.apply(t,c).done(function(){i.coverAlert("<strong>Success</strong><br />Deleted "+k.length+" objects","success"),i.off("hidden"),i.on("hidden",function(){i.delete(),window.location.reload()})}).fail(function(){i.coverAlert("<strong>Error</strong><br />Could not delete an object","error")}).always(function(){i.setButtons(null,"Close"),i.off("submit"),i.on("submit",function(){i.hide()}),i.unlock()})}),i.show()}function l(t){for(var e=0;e<workspaces.length;e++){var i=workspaces[e];if(i.id===t)return i}return null}function d(t,e,i){for(var n=0;n<t.objectData.length;n++){var a=t.objectData[n];if(a.type===e&&a.id===i)return a}return null}function c(){t("#object-table-container").hide();var e=[t(this).data("id")],i=[t(this).data("workspace")],n=t(this).data("type");"Model"==n&&(t("#main-right-content").append('<button class="btn back-button"                     style="float: left; margin: 0 5px 0 0;" >back</div>'),t(".back-button").unbind("click"),t(".back-button").click(function(){t("#object-table-container").show()})),"FBA"==n&&(t("#main-right-content").append('<button class="btn back-button"                     style="float: left; margin: 0 5px 0 0;" >back</div>'),fbaView=t("#main-right-content").fbaView({ids:e,workspaces:i}),t(".back-button").unbind("click"),t(".back-button").click(function(){t("#object-table-container").show()}))}function p(){t(".select-objs").length&&t(".select-objs").remove();var e=t(".obj-opts");e.append('<button type="button" class="btn btn-default select-objs pull-left">                                <div class="ncheck-btn"></div></button>'),t(".type-filter").remove(),e.append('<select class="form-control type-filter pull-left">                                           <option selected="selected">All Types</option>                                           <option>Genome</option>                                           <option>FBA</option>                                           <option>Model</option>                                           <option>PhenotypeSet</option>                                           <option>Media</option>                                     </select>'),t(".select-objs").unbind("click"),t(".select-objs").click(function(){t(this).children(".ncheck-btn").hasClass("ncheck-checked")?(t(".check-option").removeClass("ncheck-checked"),t(this).children(".ncheck-btn").removeClass("ncheck-checked"),t(".checked-opts").hide(),k=[]):(t(".checked-opts").show(),t(".check-option").addClass("ncheck-checked"),t(this).children(".ncheck-btn").removeClass("ncheck-minus"),t(this).children(".ncheck-btn").addClass("ncheck-checked"),k=[],t(".check-option").each(function(){var e=t(this).attr("data-id"),i=b(t(this).attr("data-id")),n=t(this).attr("data-workspace"),a=t(this).attr("data-type");
k.push([e,i,n,a])})),u()}),u(".check-option")}function u(e){function i(){if(0==t(".checked-opts").length){var e=t('<div class="checked-opts obj-opt">');e.append('<a class="btn btn-danger obj-btn opt-delete ">                                               <i class="glyphicon glyphicon-trash"></i></a>'),e.append('<div class="dropdown obj-opt opt-dropdown">                                         <a class="btn btn-default obj-btn dropdown-toggle" type="button" data-toggle="dropdown">                                      <i class="glyphicon glyphicon-folder-open"></i> <span class="caret"></span></a>                                     <ul class="dropdown-menu">                                       <li opt="copy"><a>Copy</a> </li>                                       <li  opt="move"><a>Move</a></li>                                       <li class="divider"><a></a></li>                                       <li><a>Download</li>                                 </ul></div>')}else 0==k.length&&(t(".checked-opts").remove(),t(".select-objs .ncheck-btn").removeClass("ncheck-minus"));t(".obj-opts").append(e)}return e?(t(e).unbind("click"),t(e).click(function(){var e=t(this).attr("data-id"),n=b(t(this).attr("data-id")),a=t(this).attr("data-workspace"),s=t(this).attr("data-type");if(t(".select-objs .ncheck-btn").addClass("ncheck-minus"),t(this).hasClass("ncheck-checked")){t(this).removeClass("ncheck-checked");for(var o=0;o<k.length;o++)k[o][0]==e&&k.splice(o,1)}else k.push([e,n,a,s]),t(this).addClass("ncheck-checked");i(),f()}),void 0):(i(),f(),void 0)}function h(e,i){t(e).tooltip({html:!0,title:'show history                 <span class="glyphicon glyphicon-list-alt history-icon"></span>',placement:"right"}),t(e).unbind("click"),t(e).click(function(){var e=this,n=t(this).attr("data-id"),a=t(this).attr("data-workspace"),s=t(this).attr("data-type"),o=l(a),r=t(this).closest("tr")[0];if(i.fnIsOpen(r))i.fnClose(r),t(e).attr("data-original-title","show history").tooltip("fixTitle");else{i.fnOpen(r,"","info_row");var d=o.getObjectHistory(s,n);t.when(d).done(function(i){t(r).next().children("td").append("<h5>History of <i>"+n+"</i></h5>");var o=t('<table class="history-table">'),l=t("<tr><th>ID</th>                                            <th>Type</th>                                            <th>WS</th>                                            <th>Vers</th>                                            <th>Owner</th>                                            <th>Last modby</th>                                            <th>Cmd</th>                                            <th>Moddate</th>");o.append(l);for(var d=0;d<i.length;d++){var c=i[d],p=t("<tr>");p.append('<td><a class="id-download" data-version="'+c[3]+'" data-id="'+n+'" data-type="'+s+'" data-workspace="'+a+'">'+c[0]+"</a></td>"+"<td>"+c[1]+"</td>"+"<td>"+c[2]+"</td>"+"<td>"+c[3]+"</td>"+"<td>"+c[4]+"</td>"+"<td>"+c[5]+"</td>"+"<td>"+c[6]+"</td>"+"<td>"+c[7]+"</td>"),o.append(p)}t(r).next().children("td").append(o.html()),t(e).attr("data-original-title","hide history").tooltip("fixTitle")})}})}function f(){t(".opt-delete").unbind("click"),t(".opt-delete").click(function(){r(k)}),t(".opt-dropdown ul li").unbind("click"),t(".opt-dropdown ul li").click(function(){"copy"==t(this).attr("opt")?s(k):"move"==t(this).attr("opt")&&o(k)})}function g(){var e=l(String(t(this).data("workspace"))),i=String(t(this).data("type")),n=d(e,i,String(t(this).data("id")));null!==i.match(/^(Genome|Model|Media|FBA|Annotation)$/)?!0:!1;var a=new v;a.setTitle(t(this).data("id")),a.setButtons(null,"Close"),a.on("submit",function(){a.hide()}),a.on("hidden",function(){a.delete(),a=null});var s=t("<div>"),o=m(e,i,n,"json");s.append('<a href="'+o+'" target="_blank">Open</a>');var r=t('<table class="table table-bordered table-condensed">');s.append("<br />Metadata<br />",r),t.isEmptyObject(n.metadata)?r.append('<tr><td><div style="text-align: center">No metadata</div></td></tr>'):t.each(n.metadata,function(t,e){r.append("<tr><td><strong>"+t+"</strong></td><td>"+e+"</td></tr>")}),s.append("<br />Properties");var c=t('<table class="table table-bordered table-condensed">');s.append(c),t.each(n,function(t,e){"metadata"!==t&&c.append("<tr><td><strong>"+t+"</strong></td><td>"+e+"</td></tr>")}),a.setContent(s),a.show({backdrop:!0})}function m(t,e,i,n){return"/objects/"+encodeURIComponent(t.id)+"/"+encodeURIComponent(e)+"/"+encodeURIComponent(i.id)+"."+n}function v(){var e=j.clone();t("body").append(e);var i=!1;e.on("hide",function(t){return i?(t.stopImmediatePropagation(),!1):!0});var n=/error|warning|info|success/,a=e.find(".modal-footer").find("button");a.eq(1).click(function(){e.trigger("submit")}),this.setTitle=function(t){e.find("modal-title").html(t)},this.setContent=function(t){e.find(".modal-body").empty().append(t)},this.setButtons=function(t,e){null===t?a.eq(0).remove():"string"==typeof t&&a.eq(0).html(t),null===e?a.eq(1).remove():"string"==typeof e&&a.eq(1).html(e)},this.on=function(){e.on.apply(e,arguments)},this.off=function(){e.off.apply(e,arguments)},this.show=function(t){e.modal(t)},this.hide=function(){e.modal("hide")},this.delete=function(){e.modal("hide"),e.remove()},this.lock=function(){i=!0,e.find(".modal-header").find("button").prop("disabled",!0),a.prop("disabled",!0)},this.unlock=function(){i=!1,e.find(".modal-header").find("button").prop("disabled",!1),a.prop("disabled",!1)},this.cover=function(t){e.find(".base-modal-cover-box").removeClass().addClass("base-modal-cover-box base-modal-cover-content").empty().append(t),e.find(".modal-body").fadeTo(0,.3),e.find(".base-modal-cover").height(e.find(".modal-body").outerHeight()).width(e.find(".modal-body").outerWidth()).removeClass("hide")},this.uncover=function(){e.find(".base-modal-cover").addClass("hide"),e.find(".modal-body").fadeTo(0,1)},this.alert=function(t,i){i=n.test(i)?"alert-"+i:"",e.find(".base-modal-alert").removeClass("hide alert-error alert-info alert-success").addClass(i).empty().append(t)},this.alertHide=function(){e.find(".base-modal-alert").addClass("hide")},this.coverAlert=function(t,i){i=n.test(i)?"alert-"+i:"",this.cover(t),e.find(".base-modal-cover-box").removeClass().addClass("base-modal-cover-box alert "+i)},this.coverAlertHide=function(){this.uncover()},this.focus=function(){e.focus()},this.submit=function(){e.trigger("submit")}}function b(t){var e=t.indexOf("fba."),t=t.slice(0,t.indexOf(".",e-4));return t}var y=this;this._super(e);var k=[];this.$elem.append('<div id="object-table-container"></div>');var w=t("#object-table-container"),x=t('<div id="object-table-loading" style="text-align: center; margin-top: 60px;"><img src="assets/img/ajax-loader.gif" /><p class="text-muted">Loading...<p></div>');w.append(x);var _=t('<div id="object-table">');w.append(_);var C=t('<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered">');_.append(C),_.addClass("hide"),C.dataTable({sScrollY:"100%",sScrollX:"100%",iDisplayLength:25,oLanguage:{sZeroRecords:'<div style="text-align: center">No objects</div>'},aoColumns:[{sTitle:""},{sTitle:"Workspace",bVisible:!1},{sTitle:"ID"},{sTitle:"Org"},{sTitle:"Type"},{sTitle:"Command"},{sTitle:"Owner"},{sTitle:"Modified"}],aoColumnDefs:[{bSortable:!1,aTargets:[0]}]}),t("thead input").keydown(function(e){13==e.keyCode&&(oTable.fnFilter(this.value,t("thead input").index(this)-1),t("tfoot input").eq(t("thead input").index(this)-4).val(this.value),this.blur())}),t("thead input").each(function(t){asInitVals[t]=this.value}),t("thead input").focus(function(){this.value==asInitVals[t("thead input").index(this)]&&(this.value="")}),t("thead input").blur(function(){""==this.value&&(this.value=asInitVals[t("thead input").index(this)],t("tfoot input").eq(t("thead input").index(this)-4).val(this.value))}),C.on("click",".view-meta",g),C.on("click",".view-obj-page",c);var I={};this.reload=function(e){function s(){window.setTimeout(function(){if(!g.cancel){var l=[],m=d+c;for(m>f&&(m=f);m>d;d++){var v=r[d];t(".ncheck").data("workspace");var b='<div class="ncheck check-option" data-workspace="'+v.workspace+'"'+' data-type="'+v.type+'"'+' data-id="'+v.id+'"></div>',k='<a class="obj-version" data-workspace="'+v.workspace+'"'+' data-type="'+v.type+'"'+' data-id="'+v.id+'">'+"("+v.instance+")</a>",w='<div class="obj-table-opts" style="white-space: nowrap;"><button class="btn btn-link view-options" style="padding-right: 5px;" data-workspace="'+v.workspace+'"'+' data-type="'+v.type+'"'+' data-id="'+v.id+'">'+v.id+"</button>"+k,x='<div style="white-space: nowrap;">'+v.moddate+"</div>";l.push([b,v.workspace,w,v.metadata.name?v.metadata.name:"",v.type,v.command,v.owner,x])}C.fnAddData(l),p(),a(),h(".obj-version",C),t(".type-filter").change(function(){"All Types"==t(this).val()?(C.fnFilter("",4),u(".check-option"),a(),h(".obj-version",C)):(C.fnFilter(t(this).val(),4),u(".check-option"),a(),h(".obj-version",C))}),C.fnFilter("",4),m===f?(y.loading(!1),y.fixColumnSize(),o.resolve()):s(),e.length>1?i(1,C):n(1,C),t(".select-objs .ncheck-btn").removeClass("ncheck-checked"),t(".select-objs .ncheck-btn").removeClass("ncheck-minus")}},0)}var o=t.Deferred();t("#object-table-container").show();for(var r=[],l=0;l<e.length;l++)r=r.concat(e[l].objectData);var d=0,c=100,f=r.length,g={};return f>1e3?c=500:f>500&&(c=200),f>c&&y.loading(!0),C.fnClearTable(),I.cancel=!0,I=g,s(),o.promise()},this.loading=function(t){t?(x.removeClass("hide"),_.addClass("hide")):(_.removeClass("hide"),x.addClass("hide"))},this.fixColumnSize=function(){C.fnAdjustColumnSizing()};var j=t('<div class="modal base-modal">                <div class="modal-dialog">                 <div class="modal-content">                   <div class="modal-header">                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                      <h3 class="modal-title">Modal</h3>                    </div>                    <div class="alert base-modal-alert hide"></div>                    <div class="base-modal-cover hide">                      <div class="base-modal-cover-table">                        <div class="base-modal-cover-cell">                          <span class="base-modal-cover-box">                          </span>                        </div>                      </div>                    </div>                    <div class="modal-body"></div>                    <div class="modal-footer">                      <button data-dismiss="modal" class="btn">Cancel</button>                      <button class="btn btn-primary">Submit</button>                    </div>                  </div>               </div>             </div>');return this}})}(jQuery),function(t){t.KBWidget({name:"kbaseWSSelector",version:"1.0.0",options:{},init:function(e){function i(t){j.workspaces=t,workspaces=j.workspaces,a(),workspaces.mysort(),j.onselect(P),j.reload(),j.resizeTable(),workspaces.onchange(function(){j.reload()})}function n(t){console.log("Error: ",t)}function a(){var e=t.Callbacks();workspaces.add=function(t){workspaces.push(t),workspaces.mysort(),e.fire()},workspaces.remove=function(i){var n=t.inArray(i,workspaces);workspaces.splice(n,1),e.fire()},workspaces.replace=function(i,n){var a=t.inArray(i,workspaces);workspaces.splice(a,1,n),e.fire()},workspaces.mysort=function(){workspaces.sort(function(t,e){if(t.isOwned){if(!e.isOwned)return-1}else if(e.isOwned&&!t.isOwned)return 1;var i=t.id.toLowerCase(),n=e.id.toLowerCase();return n>i?-1:i===n?0:1})},workspaces.onchange=function(t){e.add(t)}}function s(){N.css("top",filterCollapse.outerHeight(!0)+Q.outerHeight(!0)+"px")}function o(){z.empty();var e=t('<tr id="ws-info-row">');z.append(e);var i=t("<td>");e.append(i);var n={};if(V)for(var a=0;a<F.length;a++)n[F[a].getWorkspace().id]=!0;else{var s=S.get("selected");if("array"===t.type(s))for(var a=0;a<s.length;a++)n[s[a]]=!0}L={};for(var o=[],r=[],a=0;a<workspaces.length;a++){var l=workspaces[a],d=new g(l);n[l.id]&&o.push(d),z.append(d.getHtml()),r.push(d),L[l.id]=d}F=o,$=r,h()}function r(t){for(var e=0;e<F.length;e++)F[e].unselect();for(var i=[],n=[],e=0;e<t.length;e++){var a=t[e],s=a.getWorkspace();i.push(s),n.push(s.id),a.select()}F=t,S.set("selected",n),G.fire(i)}function l(e){return t.inArray(e,T)}function d(t){var e=l(t);return e>0?T[e-1]:null}function c(t){var e=l(t);return e<T.length-1?T[e+1]:null}function p(e,i){if(e.ctrlKey||e.metaKey){var n=t.inArray(i,F),a=F.slice();n>-1?a.splice(n,1):a.push(i),M=i,W=null,r(a)}else if(e.shiftKey){null===M&&(M=i);var s,o,d=l(M),c=l(i);if(d===c)s="none",o=d;else if(d>c){s="up",o=c;var p=d;d=c,c=p}else s="down",o=c;W={dir:s,last:T[o]};for(var a=[],u=d;c>=u;u++)a.push(T[u]);r(a)}else M=i,W=null,r([i])}function u(e){if((e.ctrlKey||e.metaKey)&&65==e.which)return r(T),!1;if(38===e.keyCode){if(0===(W?l(W.last):l(M)))return!1;if(e.shiftKey){null===M&&(M=T[T.length-1]),null===W&&(W={dir:"none",last:M});var i;if(i="down"===W.dir?W.last:d(W.last),null!==i){var n=F.slice();return l(W.last)<=l(M)?t.inArray(i,n)<0&&n.push(i):i===M?(i=d(i),n.push(i)):n.splice(t.inArray(i,n),1),W={dir:"up",last:i},r(n),!1}}else{var i;if(i=null===M?T[T.length-1]:null!==W?d(W.last):d(M),null!==i)return M=i,W=null,r([i]),!1}}else if(40===e.keyCode){if((W?l(W.last):l(M))===T.length-1)return!1;if(e.shiftKey){null===M&&(M=T[0]),null===W&&(W={dir:"none",last:M});var a;if(a="up"===W.dir?W.last:c(W.last),null!==a){var n=F.slice();return l(W.last)>=l(M)?t.inArray(a,n)<0&&n.push(a):a===M?(a=c(a),n.push(a)):n.splice(t.inArray(a,n),1),W={dir:"down",last:a},r(n),!1}}else{var a;if(a=null===M?T[0]:null!==W?c(W.last):c(M),null!==a)return M=a,W=null,r([a]),!1}}return!0}function h(){var e=R.prop("checked"),i=U.prop("checked"),n=K.prop("checked"),a=q.prop("checked"),s=Q.val();if(S.set("filter",{owner:e,admin:i,write:n,read:a,search:s}),0===$.length)return z.find("#ws-info-row").removeClass("hide").find("td").html("no workspaces"),void 0;var o=new RegExp(s,"i");T=[];for(var l=0;l<$.length;l++){var d=$[l],c=d.getWorkspace(),p=!1;if(i&&"a"===c.user_permission&&(p=!0),n&&"w"===c.user_permission&&(p=!0),a&&"r"===c.user_permission&&(p=!0),p&&e&&!c.isOwned&&(p=!1),p&&""!=s&&(p=o.test(c.id)),p)d.show(),T.push(d);else{var u=t.inArray(d,F);u>-1&&(d.unselect(),F.splice(u,1)),d.hide()}}0===T.length?z.find("#ws-info-row").removeClass("hide").find("td").html("no workspaces (change filters)"):z.find("#ws-info-row").addClass("hide"),r(F)}function f(){return'<div class="accordion" style="margin-bottom: 0px;"><div class="accordion-group"><div class="accordion-heading" style="text-align: center;"><button class="btn btn-link" title="Filter Workspaces">Workspaces <span class="caret"></span></button><button type="button" id="create-workspace" class="btn btn-default btn-xs  pull-right"><span title="Create new workspace">+</span></button></div><div id="collapseOne" class="accordion-body collapse"><div class="accordion-inner"><div class="pull-left" style="position: relative; margin-right: 10px; height: 75px;"><div style="display: table; position: static; height: 100%;"><div style="display: table-cell; vertical-align: middle; position: static"><label class="checkbox"><input id="ws-filter-owner" type="checkbox" tabindex="-1" /> owner</label></div></div></div><div class="pull-left"><label class="checkbox"><input id="ws-filter-admin" type="checkbox" tabindex="-1" /> admin</label><label class="checkbox"><input id="ws-filter-write" type="checkbox" tabindex="-1" /> write</label><label class="checkbox"><input id="ws-filter-read" type="checkbox" tabindex="-1" /> read</label></div><div class="clearfix"></div></div></div></div></div>'}function g(e){function i(){o.find(".badge").addClass("badge-success").html(e.objectData.length)}var n=this,a=t('<tr class="ws-row">'),s=t('<td class="ws-cell">');a.append(s);var o=t('<div class="ws-cell-content">');s.append(o),o.append('<span class="ws-num-objects badge">~ '+e.objects+"</span>"),o.append(e.isOwned?"<strong>"+e.id+"</strong>":e.id),s.mousedown(function(){return!1}),s.click(function(t){p(t,n)});var r=t('<button type="button" class="ws-cell-manage btn btn-default btn-sm hide" title="Manage Workspace"><span class="glyphicon glyphicon-cog"></span></button>');o.append(r),r.click(function(){return w(e),!1}),"array"===t.type(e.objectData)&&i(),s.hover(function(){r.removeClass("hide"),o.addClass("ws-cell-content-hover")},function(){r.addClass("hide"),o.removeClass("ws-cell-content-hover")}),this.getHtml=function(){return a},this.select=function(){s.addClass("ws-cell-selected")},this.unselect=function(){s.removeClass("ws-cell-selected")},this.hide=function(){a.addClass("hide")},this.show=function(){a.removeClass("hide")},this.getWorkspace=function(){return e},this.loaded=i}function m(e,i){var n=t(".manage-workspace"),a=n.find(".manage-existing-perm"),s=n.find(".manage-new-perm"),o=!1;if(s.find("input").each(function(e,n){return t(n).parent().removeClass("control-group error"),""===t(n).val()?(i.alert("Username canot be empty","error"),t(n).parent().addClass("control-group error"),t(n).focus(),o=!0,!1):C(t(n).val())?!0:(i.alert("Invalid username<br />(alphanumeric characters only)","error"),t(n).parent().addClass("control-group error"),t(n).focus().select(),o=!0,!1)}),!o){var r=t("#global-perm"),l=r.find("option").filter(":selected").val();r.data("value")===l&&(l=null);var d={};a.each(function(e,i){var n=t(i).find("td").eq(0).html(),a=t(i).find("option").filter(":selected").val();d[n]=a}),s.each(function(e,i){var n=t(i).find("input").val(),a=t(i).find("option").filter(":selected").val();d[n]=a});var c=!0;if(t.each(e.permissions,function(t,e){d[t]!==e&&(c=!1)}),t.each(d,function(t,i){e.permissions[t]!==i&&(c=!1)}),null===l&&c)return i.alert("No changes to submit","info"),void 0;i.alertHide(),i.focus(),t(".modal-body").find("input,select,button").attr("tabindex","-1");var p=[];if(null!==l){var u=e.setGlobalPermission(l);p.push(u)}if(!c){var u=e.setWorkspacePermissions(d);p.push(u)}i.lock(),i.cover('<img src="assets/img/loading.gif" />'),t.when.apply(t,p).done(function(){i.coverAlert("<strong>Success</strong><br />Changed workspace permissions","success")}).fail(function(){i.coverAlert("<strong>Error</strong><br />Failed to change workspace permissions","error")}).always(function(){i.setButtons(null,"Close"),i.off("submit"),i.on("submit",function(){i.hide()}),i.unlock()})}}function v(){var e=new b;e.setTitle("Create Workspace"),e.setContent('<table style="margin-left: auto; margin-right: auto; text-align: right;"><tr><td>Workspace Id:</td><td><input type="text" id="create-id" class="form-control" style="width: 150px" /></td></tr><tr><td>Global Permission:</td><td>'+y("create-permission","n")+"</td></tr></table>"),t("#create-permission").css({width:"164px"}),e.on("hidden",function(){e.delete()}),t("#create-id").keypress(function(t){13==t.which&&e.submit()}),e.setButtons("Cancel","Create"),e.on("submit",function(){_(e)}),e.show(),t("#create-id").focus()}function b(){var e=J.clone();t("body").append(e);var i=!1;e.on("hide",function(t){return i?(t.stopImmediatePropagation(),!1):!0});var n=/error|warning|info|success/,a=e.find(".modal-footer").find("button");a.eq(1).click(function(){e.trigger("submit")}),this.setTitle=function(t){e.find("modal-title").html(t)},this.setContent=function(t){e.find(".modal-body").empty().append(t)},this.setButtons=function(t,e){null===t?a.eq(0).remove():"string"==typeof t&&a.eq(0).html(t),null===e?a.eq(1).remove():"string"==typeof e&&a.eq(1).html(e)},this.on=function(){e.on.apply(e,arguments)},this.off=function(){e.off.apply(e,arguments)},this.show=function(t){e.modal(t)},this.hide=function(){e.modal("hide")},this.delete=function(){e.modal("hide"),e.remove()},this.lock=function(){i=!0,e.find(".modal-header").find("button").prop("disabled",!0),a.prop("disabled",!0)},this.unlock=function(){i=!1,e.find(".modal-header").find("button").prop("disabled",!1),a.prop("disabled",!1)},this.cover=function(t){e.find(".base-modal-cover-box").removeClass().addClass("base-modal-cover-box base-modal-cover-content").empty().append(t),e.find(".modal-body").fadeTo(0,.3),e.find(".base-modal-cover").height(e.find(".modal-body").outerHeight()).width(e.find(".modal-body").outerWidth()).removeClass("hide")},this.uncover=function(){e.find(".base-modal-cover").addClass("hide"),e.find(".modal-body").fadeTo(0,1)},this.alert=function(t,i){i=n.test(i)?"alert-"+i:"",e.find(".base-modal-alert").removeClass("hide alert-error alert-info alert-success").addClass(i).empty().append(t)},this.alertHide=function(){e.find(".base-modal-alert").addClass("hide")},this.coverAlert=function(t,i){i=n.test(i)?"alert-"+i:"",this.cover(t),e.find(".base-modal-cover-box").removeClass().addClass("base-modal-cover-box alert "+i)},this.coverAlertHide=function(){this.uncover()},this.focus=function(){e.focus()},this.submit=function(){e.trigger("submit")}}function y(t,e,i){var n=' selected="selected"',a=' id="'+t+'"';return"<select"+(t?a:"")+' class="input-small form-control"'+' style="margin: 0px;" data-value="'+e+'">'+(i?"":'<option value="n"'+("n"===e?n:"")+">none</option>")+'<option value="r"'+("r"===e?n:"")+">read</option>"+'<option value="w"'+("w"===e?n:"")+">write</option>"+'<option value="a"'+("a"===e?n:"")+">admin</option>"+"</select>"}function k(t){var e={n:"none",r:"read",w:"write",a:"admin"};return e[t]}function w(e){function i(){var i=t('<div class="manage-workspace">'),a=t('<table class="table table-bordered table-condensed">');i.append(a),n.setContent(i);var s;s=e.isOwned||"a"===e.user_permission?y("global-perm",e.global_permission):k(e.global_permission);for(var o=[["Id",e.id],["Objects","array"===t.type(e.objectData)?e.objectData.length:"~ "+e.objects],["Owner",e.owner],["Permission",k(e.user_permission)],["Global Permission",s]],r=0;r<o.length;r++){var l=t("<tr>");l.append('<td class="manage-modal-attribute"><strong>'+o[r][0]+"</strong></td>"+'<td class="manage-modal-value">'+o[r][1]+"</td>"),a.append(l)}if(e.isOwned||"a"===e.user_permission){var d=[];t.each(e.permissions,function(t,e){"n"!==e&&d.push([t,e])});var c=t('<table class="table table-bordered table-condensed">'),p=t('<tr><td colspan="3" style="text-align: center;">None</td></tr>');if(c.append(p),d.length>0){p.addClass("hide");for(var r=0;r<d.length;r++){var s=d[r];c.append('<tr class="manage-existing-perm"><td style="width: 100%">'+s[0]+"</td>"+"<td>"+y(null,s[1],!0)+"</td>"+'<td style="vertical-align: middle;">'+'<button type="button" class="close" aria-hidden="true">&times;</button>'+"</td></tr>")}}var u=t('<button class="btn btn-link">(add)</button>');u.click(function(){p.addClass("hide"),c.append('<tr class="manage-new-perm"><td><input type="text" class="form-control input-medium" style="margin: 0px;" placeholder="username" /></td><td>'+y(null,null,!0)+"</td>"+'<td style="vertical-align: middle;">'+'<button type="button" class="close" aria-hidden="true">&times;</button>'+"</td></tr>");var t=c.find("input");t.eq(t.length-1).focus().keypress(function(t){13==t.which&&n.submit()})}),c.on("click",".close",function(){t(this).parent().parent().remove(),1===c.find("tr").length&&p.removeClass("hide")});var h=t("<div>User Permissions </div>");h.append(u),i.append(h),i.append(c)}n.on("hidden",function(){n.delete()});var f=t('<button class="btn btn-link">Clone</button>');if(f.click(function(){x(e,n)}),e.isOwned){var g=t('<button class="btn btn-link">Delete</button>');g.click(function(){deleteWorkspace(e,n)});var v=t('<div class="pull-left"></div>');v.append(f);var b=t('<div class="pull-right"></div>');b.append(g),i.append(v).append(b).append('<div class="clearfix"></div>')}else i.append(f);e.isOwned||"a"===e.user_permission?(n.setButtons("Cancel","Save"),n.on("submit",function(){m(e,n)})):(n.setButtons(null,"Close"),n.on("submit",function(){n.hide()}))}var n=new b;n.setTitle("Manage Workspace"),n.show(null,"350px"),!e.isOwned&&"a"!==e.user_permission||"undefined"!==t.type(e.permissions)?i():(n.lock(),n.setContent('<div style="height: 250px; text-align: center; margin-top: 30px;"><img src="assets/img/loading.gif" /><br />Loading...</div>'),e.getPermissions().done(function(){i(),n.unlock()}))}function x(e,i){function n(){a.setButtons(null,"Close"),a.off("submit"),a.on("submit",function(){a.hide()}),a.unlock()}var a=new b;a.setTitle("Clone Workspace"),a.setContent('<div><h4 style="margin-top: 0px;">'+e.id+"</h4>"+'<table style="margin-left: auto; margin-right: auto; text-align: right; width: 300px;">'+'<tr style="height: 42px;"><td style="width: 100%;">Clone into:</td>'+'<td style="padding-right: 30px;">'+'<label class="radio inline" style="padding-right: 5px; padding-top: 0px;">'+'<input id="new-input" type="radio" name="clone-into" value="new" checked />new'+'</label><label class="radio inline" style="padding-right: 5px; padding-top: 0px;">'+'<input id="existing-input" type="radio" name="clone-into" value="existing" />existing'+"</label></td></tr>"+"<tr><td>Workspace:</td>"+'<td id="clone-into-cell"></td></tr>'+'<tr id="clone-permission-row"><td>Global Permission:</td>'+"<td>"+y("clone-permission",e.global_permission)+"</td></tr></table></div>"),t("#clone-permission").css({width:"164px"});var s=!0,o=t("#clone-into-cell"),r=t('<input type="text" id="clone-id" class="form-control" style="width: 150px" />'),l=t('<select class="form-control hide" style="width: 164px">'),d=t("#clone-permission-row");o.append(r).append(l),t("#new-input").click(function(){s=!0,l.hide(),r.show(),d.show()}),t("#existing-input").click(function(){s=!1,r.hide(),d.hide(),l.show()}),r.keypress(function(t){13==t.which&&a.submit()});for(var c=0;c<workspaces.length;c++){var p=workspaces[c];p!==e&&("a"===p.user_permission||"w"===p.user_permission)&&l.append('<option value="'+p.id+'">'+p.id+"</option>")}a.on("hidden",function(){i.on("hidden",function(){i.delete()}),a.delete(),i.show()}),i.off("hidden"),i.hide(),a.setButtons("Cancel","Clone"),a.on("submit",function(){var t,o;if(s){if(t=r.val(),""===t)return a.alert("Must enter a workspace id","error"),r.focus(),void 0;if(!C(t))return a.alert("Invalid workspace id<br />(alphanumeric characters only)","error"),r.focus().select(),void 0;for(var c=0;c<workspaces.length;c++)if(t===workspaces[c].id)return a.alert("Workspace already exists","error"),r.focus().select(),void 0;o=d.find("option").filter(":selected").val()}else t=l.find("option").filter(":selected").val();a.alertHide(),a.lock(),a.cover('<img src="assets/img/loading.gif" /><br />This may take a while...'),e.clone(t,o).done(function(o){o.getAllObjectsMeta().done(function(e){o.objectData=e,a.coverAlert("<strong>Success</strong><br />Cloned workspace into '"+o.id+"'","success"),a.off("hidden"),a.on("hidden",function(){if(s)workspaces.add(o);else{for(var e,n=0;n<workspaces.length;n++){var r=workspaces[n];if(r.id===t){e=r;break}}workspaces.replace(e,o)}i.delete(),a.delete()}),n()}).fail(function(){a.coverAlert("<strong>Error</strong><br />Could not get workspace '"+e.id+"'","error"),n()})}).fail(function(){a.coverAlert("<strong>Error</strong><br />Could not clone workspace '"+e.id+"'","error"),n()})}),a.show()}function _(e){var i=t("#create-id").val();if(""===i)return e.alert("Must enter a workspace id","error"),t("#create-id").focus(),void 0;if(!C(i))return e.alert("Invalid workspace id<br />(alphanumeric characters only)","error"),t("#create-id").focus().select(),void 0;var n=t("#create-permission").find("option").filter(":selected").attr("value");e.alertHide(),e.lock(),e.cover('<img src="assets/img/loading.gif" />'),e.focus(),t(".modal-body").find("input,select").attr("tabindex","-1"),B.createWorkspace(i,n).done(function(t){t.objectData=[],e.coverAlert("<strong>Success</strong><br />Created workspace '"+i+"'</div>","success"),e.setButtons(null,"Close"),e.off("submit"),e.on("submit",function(){e.hide()}),e.on("hidden",function(){workspaces.add(t)})}).fail(function(){e.alert("Workspace already in use, please try again","error"),e.uncover(),t("#create-id").focus().select()}).always(function(){e.unlock()})}function C(t){return Y.test(t)}function I(){var t;try{t="localStorage"in window&&null!==window.localStorage}catch(e){t=!1}this.get=function(e){if(!t)return null;var i=localStorage.getItem(e);try{i=JSON.parse(i)}catch(n){return null}return i},this.set=function(e,i){if(!t)return null;try{i=JSON.stringify(i)}catch(n){return null}return localStorage.setItem(e,i)}}this._super(e);var j=this,D={};D.token=e.userToken;var S=new I,P=e.selectHandler,B=new WSHandler({user:D}),$=[],T=[],L={},F=[],M=null,W=null,E=j.$elem;B.getWorkspaces().done(i).fail(n),j.workspaces,filterCollapse=t(f()),filterCollapse.find("#create-workspace").click(function(t){return t.stopImmediatePropagation(),v(),!1});var O=null;filterCollapse.find(".collapse").on("shown",function(){s(),S.set("filter-open",!0),filterCollapse.find(".caret").removeClass().addClass("caret-up"),filterCollapse.find("input").removeAttr("tabindex"),window.clearInterval(O),O=null}).on("hidden",function(){s(),S.set("filter-open",!1),filterCollapse.find(".caret-up").removeClass().addClass("caret"),filterCollapse.find("input").attr("tabindex","-1"),window.clearInterval(O),O=null}).on("show hide",function(){O=window.setInterval(function(){s()},20)}),filterCollapse.find("button").click(function(){filterCollapse.find(".collapse").length?filterCollapse.find(".collapse").collapse("toggle"):filterCollapse.find("#collapseOne").collapse("toggle")});var A=S.get("filter-open");A&&filterCollapse.find(".collapse").addClass("in");var R=filterCollapse.find("#ws-filter-owner").change(h),U=filterCollapse.find("#ws-filter-admin").change(h),K=filterCollapse.find("#ws-filter-write").change(h),q=filterCollapse.find("#ws-filter-read").change(h);E.append(filterCollapse);var Q=t('<form role="form"><input type="text" class="form-control search-query"             placeholder="Filter Workspaces"></form');E.append(Q);var Q=Q.find("input");Q.keyup(h);var H=S.get("filter");null!==H?(R.prop("checked",H.owner),U.prop("checked",H.admin),K.prop("checked",H.write),q.prop("checked",H.read),Q.val(H.search)):(R.prop("checked",!1),U.prop("checked",!0),K.prop("checked",!0),q.prop("checked",!0));var N=t('<div id="ws-table-div" tabindex="0">');E.append(N);var z=t('<table id="ws-table" class="table table-bordered table-condensed">');N.append(z),N.click(function(){N.focus()}),N.keydown(u);var G=t.Callbacks();this.getHtml=function(){return E},this.onselect=function(t){G.add(t);for(var e=[],i=0;i<F.length;i++)e.push(F[i].getWorkspace())},this.setLoaded=function(t){var e=L[t.id];e&&e.loaded()},this.reload=o,this.resizeTable=s;var V=!1,J=t('<div class="modal base-modal">            <div class="modal-dialog">             <div class="modal-content">               <div class="modal-header">                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                  <h3 class="modal-title">Modal</h3>                </div>                <div class="alert base-modal-alert hide"></div>                <div class="base-modal-cover hide">                  <div class="base-modal-cover-table">                    <div class="base-modal-cover-cell">                      <span class="base-modal-cover-box">                      </span>                    </div>                  </div>                </div>                <div class="modal-body"></div>                <div class="modal-footer">                  <button data-dismiss="modal" class="btn">Cancel</button>                  <button class="btn btn-primary">Submit</button>                </div>              </div>           </div>         </div>'),Y=/^[a-zA-Z0-9_]+$/;return this}})}(jQuery);